<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Defense Game</title>
    <style>
      * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Arial', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #2c3e50;
    padding: 20px;
    color: #ecf0f1;
    min-height: 100vh;
    overflow-x: hidden;
}

h1 {
    color: #f1c40f;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    margin-bottom: 20px;
    text-align: center;
}

.game-container {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    position: relative;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 1400px;
}

#gameCanvas {
    background-color: #27ae60;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    width: 800px;
    height: 500px;
}

.shop {
    background-color: #34495e;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    padding: 15px;
    width: 280px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    max-height: 500px;
    overflow-y: auto;
}

.shop h2 {
    margin-top: 0;
    text-align: center;
    color: #f1c40f;
    border-bottom: 2px solid #f1c40f;
    padding-bottom: 10px;
    position: sticky;
    top: 0;
    background-color: #34495e;
    z-index: 1;
}

.tower-item {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s;
    background-color: #2c3e50;
}

.tower-item:hover {
    background-color: #3d566e;
    transform: translateY(-2px);
}

.tower-preview {
    width: 24px;
    height: 24px;
    margin-right: 10px;
    border: 1px solid #777;
    flex-shrink: 0;
}

.tower-info {
    flex-grow: 1;
    min-width: 0;
}

.tower-name {
    font-weight: bold;
    color: #f1c40f;
}

.tower-stats {
    font-size: 0.8em;
    color: #bdc3c7;
}

.tower-price {
    font-weight: bold;
    color: #2ecc71;
    background-color: rgba(0, 0, 0, 0.3);
    padding: 3px 6px;
    border-radius: 4px;
    flex-shrink: 0;
    margin-left: 5px;
}

.info-panel {
    display: flex;
    justify-content: space-between;
    width: 100%;
    max-width: 1400px;
    margin-bottom: 15px;
    background-color: #34495e;
    padding: 10px 20px;
    border-radius: 8px;
    border: 2px solid #f1c40f;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}

.stats {
    font-weight: bold;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.stats span {
    color: #f1c40f;
}

.controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

button {
    padding: 8px 15px;
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s;
    white-space: nowrap;
}

button:hover {
    background-color: #c0392b;
}

#toggleRadius {
    background-color: #3498db;
}

#toggleRadius:hover {
    background-color: #2980b9;
}

#toggleIndex {
    background-color: #9b59b6;
}

#toggleIndex:hover {
    background-color: #8e44ad;
}

#restartGame {
    display: none;
    background-color: #e74c3c;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 15px 30px;
    font-size: 1.2em;
    z-index: 100;
}

.game-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 99;
}

.upgrade-option {
    margin-top: 5px;
    padding-top: 5px;
    border-top: 1px dashed #555;
    font-size: 0.8em;
    color: #e67e22;
}

.selected {
    box-shadow: 0 0 10px #f1c40f;
    border-color: #f1c40f;
}

.upgrade-menu {
    display: none;
    position: fixed;
    background-color: #34495e;
    border: 2px solid #f1c40f;
    border-radius: 8px;
    padding: 15px;
    width: 300px;
    z-index: 10;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    max-height: 80vh;
    overflow-y: auto;
}

.upgrade-menu h3 {
    margin-top: 0;
    color: #f1c40f;
    border-bottom: 1px solid #f1c40f;
    padding-bottom: 5px;
}

.upgrade-btn {
    width: 100%;
    margin-top: 10px;
    padding: 8px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.upgrade-btn:hover {
    background-color: #27ae60;
}

.upgrade-btn:disabled {
    background-color: #7f8c8d;
    cursor: not-allowed;
}

.sell-btn {
    width: 100%;
    margin-top: 10px;
    padding: 8px;
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.sell-btn:hover {
    background-color: #c0392b;
}

.range-indicator {
    position: absolute;
    pointer-events: none;
    border: 2px dashed rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 5;
}

.enemy-index {
    background-color: #34495e;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    padding: 15px;
    width: 280px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    max-height: 500px;
    overflow-y: auto;
    display: none;
}

.enemy-index h2 {
    margin-top: 0;
    text-align: center;
    color: #f1c40f;
    border-bottom: 2px solid #f1c40f;
    padding-bottom: 10px;
    position: sticky;
    top: 0;
    background-color: #34495e;
    z-index: 1;
}

.enemy-item {
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 5px;
    background-color: #2c3e50;
}

.enemy-name {
    font-weight: bold;
    color: #f1c40f;
    margin-bottom: 5px;
}

.enemy-stats {
    font-size: 0.8em;
    color: #bdc3c7;
}

.unknown {
    color: #7f8c8d;
    font-style: italic;
}

.targeting-options {
    margin-top: 10px;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.targeting-options label {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9em;
}

.setup-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 200;
}

.setup-container {
    background-color: #34495e;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    padding: 30px;
    width: 500px;
    max-width: 90%;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
}

.setup-container h2 {
    text-align: center;
    color: #f1c40f;
    margin-bottom: 20px;
}

.difficulty-options, .map-options {
    margin-bottom: 25px;
}

.difficulty-options h3, .map-options h3 {
    color: #f1c40f;
    margin-bottom: 10px;
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
}

.option-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.option-btn {
    padding: 10px 15px;
    background-color: #2c3e50;
    color: #ecf0f1;
    border: 2px solid #555;
    border-radius: 5px;
    cursor: pointer;
    flex-grow: 1;
    text-align: center;
    transition: all 0.2s;
}

.option-btn:hover {
    background-color: #3d566e;
    border-color: #f1c40f;
}

.option-btn.selected {
    background-color: #f1c40f;
    color: #2c3e50;
    border-color: #f1c40f;
}

.start-btn {
    padding: 12px 25px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: bold;
    width: 100%;
    transition: background-color 0.2s;
}

.start-btn:hover {
    background-color: #27ae60;
}

.boss-aura {
    position: absolute;
    pointer-events: none;
    border: 2px dashed rgba(255, 0, 0, 0.7);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 4;
}

.diamond-shop-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 10px 15px;
    background: linear-gradient(45deg, #2196F3, #21CBF3);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    z-index: 201;
    box-shadow: 0 0 10px rgba(33, 150, 243, 0.7);
}

.diamond-count {
    position: absolute;
    top: 20px;
    left: 20px;
    padding: 10px 15px;
    background-color: #34495e;
    color: #21CBF3;
    border: 2px solid #21CBF3;
    border-radius: 5px;
    font-weight: bold;
    z-index: 201;
    display: flex;
    align-items: center;
    gap: 5px;
}

.diamond-icon {
    color: #21CBF3;
    font-size: 1.2em;
}

.shop-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.95);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 300;
}

.shop-container {
    background-color: #34495e;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    padding: 30px;
    width: 800px;
    max-width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
}

.shop-container h2 {
    text-align: center;
    color: #f1c40f;
    margin-bottom: 20px;
}

.shop-categories {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.shop-category {
    padding: 10px 15px;
    background-color: #2c3e50;
    color: #ecf0f1;
    border: 2px solid #555;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s;
}

.shop-category:hover, .shop-category.active {
    background-color: #f1c40f;
    color: #2c3e50;
    border-color: #f1c40f;
}

.shop-items {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
}

.shop-item {
    background-color: #2c3e50;
    border: 1px solid #555;
    border-radius: 5px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.shop-item h3 {
    color: #f1c40f;
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
}

.shop-item p {
    font-size: 0.9em;
    color: #bdc3c7;
}

.shop-item-price {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
}

.shop-item-btn {
    padding: 8px 15px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}

.shop-item-btn:disabled {
    background-color: #7f8c8d;
    cursor: not-allowed;
}

.case-content {
    display: none;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px dashed #555;
}

.case-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    padding: 5px;
    border-radius: 4px;
    background-color: rgba(255, 255, 255, 0.1);
}

.case-item-chance {
    margin-left: auto;
    background-color: #9b59b6;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.8em;
}

.close-shop {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    color: #e74c3c;
    font-size: 2em;
    cursor: pointer;
}

.inventory-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 5px;
    margin-bottom: 10px;
    background-color: #2c3e50;
}

.inventory-preview {
    width: 20px;
    height: 20px;
    border: 1px solid #777;
}

@media (max-width: 1400px) {
    .game-container {
        flex-direction: column;
        align-items: center;
    }
    
    #gameCanvas {
        width: 100%;
        max-width: 800px;
        height: 400px;
    }
    
    .shop, .enemy-index {
        width: 100%;
        max-width: 800px;
    }
}

@media (max-width: 900px) {
    .info-panel {
        flex-direction: column;
        gap: 10px;
    }
    
    .stats, .controls {
        justify-content: center;
    }
    
    #gameCanvas {
        height: 350px;
    }
    
    .shop-items {
        grid-template-columns: 1fr;
    }
}

/* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–µ–π—Å–µ */
.case-info-btn {
    padding: 5px 10px;
    background-color: #9b59b6;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-bottom: 10px;
    font-size: 0.9em;
}

.case-info-btn:hover {
    background-color: #8e44ad;
}

.case-info-content {
    display: none;
    margin-top: 10px;
    padding: 10px;
    background-color: #2c3e50;
    border-radius: 5px;
    border: 1px solid #555;
}
        
        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–µ–π—Å–µ */
        .case-info-btn {
            padding: 5px 10px;
            background-color: #9b59b6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        .case-info-btn:hover {
            background-color: #8e44ad;
        }
        
        .case-info-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #2c3e50;
            border-radius: 5px;
            border: 1px solid #555;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –±–∞—à–µ–Ω –∏–∑ –∫–µ–π—Å–æ–≤ */
#doublePistolTower,
#bombTower,
#goodFarmTower,
#toxicTower,
#turretTower,
#emptyTower {
    display: flex !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–≤—å—é –±–∞—à–µ–Ω */
.tower-preview[style*="linear-gradient(to right, blue, lightblue)"] {
    background: linear-gradient(to right, blue, lightblue) !important;
    border-radius: 50% !important;
}

.tower-preview[style*="background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%)"] {
    background-color: black !important;
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%) !important;
}

.tower-preview[style*="background-color: gold"] {
    background-color: gold !important;
}

.tower-preview[style*="background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%)"] {
    background-color: green !important;
    clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%) !important;
}

.tower-preview[style*="background-color: gray"] {
    background-color: gray !important;
}

.tower-preview[style*="linear-gradient(to right, purple, black)"] {
    background: linear-gradient(to right, purple, black) !important;
}

/* –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å–µ –±–∞—à–Ω–∏ –≤–∏–¥–Ω—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ */
.tower-item {
    display: flex !important;
    opacity: 1 !important;
    visibility: visible !important;
}
       /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –±–∞—à–Ω–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ */
.tower-item {
    display: flex !important;
}

/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏–Ω–¥–µ–∫—Å–µ –≤—Ä–∞–≥–æ–≤ */
.enemy-stats .unknown {
    color: #bdc3c7 !important;
    font-style: normal !important;
}
.enemy-stats .unknown:after {
    content: " (–î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏)" !important;
} 
        
    </style>
</head>
<body>
    <div class="setup-screen" id="setupScreen">
        <div class="setup-container">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h2>
            
            <div class="diamond-count" id="diamondCount">
                <span class="diamond-icon">üíé</span>
                <span id="diamondTotal">0</span>
            </div>
            
            <button class="diamond-shop-btn" id="diamondShopBtn">–ú–∞–≥–∞–∑–∏–Ω</button>
            
            <div class="difficulty-options">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å:</h3>
                <div class="option-group">
                    <div class="option-btn selected" data-difficulty="normal">–ö–ª–∞—Å—Å–∏–∫–∞</div>
                    <div class="option-btn" data-difficulty="hard">–°–ª–æ–∂–Ω—ã–π —Ä–µ–∂–∏–º</div>
                    <div class="option-btn" data-difficulty="extreme" id="extremeDifficultyBtn">–≠–∫—Å—Ç—Ä–∏–º</div>
                </div>
            </div>
            
            <div class="map-options">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É:</h3>
                <div class="option-group">
                    <div class="option-btn selected" data-map="hills">–•–æ–ª–º—ã</div>
                    <div class="option-btn" data-map="flat">–†–æ–≤–Ω–∞—è –¥–æ—Ä–æ–≥–∞</div>
                    <div class="option-btn" data-map="mountains" id="mountainsMapBtn">–ì–æ—Ä–∫–∏</div>
                </div>
            </div>
            
            <!-- –£–±–∏—Ä–∞–µ–º —Å–µ–∫—Ü–∏—é –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
            
            <button class="start-btn" id="startGame">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
    </div>
    
    <div class="shop-screen" id="shopScreen">
        <button class="close-shop" id="closeShop">√ó</button>
        <div class="shop-container">
            <h2>–ú–∞–≥–∞–∑–∏–Ω –∞–ª–º–∞–∑–æ–≤</h2>
            
            <div class="shop-categories">
                <div class="shop-category active" data-category="difficulties">–°–ª–æ–∂–Ω–æ—Å—Ç–∏</div>
                <div class="shop-category" data-category="maps">–ö–∞—Ä—Ç—ã</div>
                <div class="shop-category" data-category="cases">–ö–µ–π—Å—ã</div>
            </div>
            
            <div class="shop-items">
                <div class="shop-item" data-category="difficulties">
                    <h3>–†–µ–∂–∏–º –≠–∫—Å—Ç—Ä–∏–º</h3>
                    <p>–û—Ç–∫—Ä–æ–π—Ç–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: +1% –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—Ä–∞–≥–æ–≤, x2 –∑–¥–æ—Ä–æ–≤—å—è, –≤—Å–µ–≥–æ 1 –∂–∏–∑–Ω—å</p>
                    <div class="shop-item-price">
                        <span class="diamond-icon">üíé</span>
                        <span>25</span>
                        <button class="shop-item-btn" data-item="extreme" data-price="25" id="buyExtremeBtn">–ö—É–ø–∏—Ç—å</button>
                    </div>
                </div>
                
                <div class="shop-item" data-category="maps">
                    <h3>–ö–∞—Ä—Ç–∞ –ì–æ—Ä–∫–∏</h3>
                    <p>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç—É —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–æ–≤–æ—Ä–æ—Ç–æ–≤ –∏ –∏–∑–≤–∏–ª–∏—Å—Ç—ã–º –ø—É—Ç–µ–º</p>
                    <div class="shop-item-price">
                        <span class="diamond-icon">üíé</span>
                        <span>20</span>
                        <button class="shop-item-btn" data-item="mountains" data-price="20" id="buyMountainsBtn">–ö—É–ø–∏—Ç—å</button>
                    </div>
                </div>
                
                <div class="shop-item" data-category="cases">
                    <h3>–û–±—ã—á–Ω—ã–π –∫–µ–π—Å</h3>
                    <p>–®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å –æ–¥–Ω—É –∏–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –±–∞—à–µ–Ω</p>
                    <button class="case-info-btn" data-case="normal">?</button>
                    <div class="case-info-content">
                        <div class="case-item">
                            <div class="inventory-preview" style="background: linear-gradient(to right, blue, lightblue);"></div>
                            <span>–î–≤–æ–π–Ω–æ–π –ø–∏—Å—Ç–æ–ª–µ—Ç</span>
                            <span class="case-item-chance">45%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
                            <span>–ë–æ–º–±—ã</span>
                            <span class="case-item-chance">30%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: gold;"></div>
                            <span>–•–æ—Ä–æ—à–∞—è —Ñ–µ—Ä–º–∞</span>
                            <span class="case-item-chance">20%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%);"></div>
                            <span>–¢–æ–∫—Å–∏—á–Ω—ã–π</span>
                            <span class="case-item-chance">4%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: gray;"></div>
                            <span>–¢—É—Ä–µ–ª—å</span>
                            <span class="case-item-chance">0.6%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background: linear-gradient(to right, purple, black);"></div>
                            <span>–ü—É—Å—Ç–æ–π</span>
                            <span class="case-item-chance">0.4%</span>
                        </div>
                    </div>
                    <button class="shop-item-btn" data-case="normal" data-price="50" id="openNormalCaseBtn">–û—Ç–∫—Ä—ã—Ç—å –∑–∞ üíé50</button>
                </div>
                
                <div class="shop-item" data-category="cases">
                    <h3>–ü—Ä–µ–º–∏—É–º –∫–µ–π—Å</h3>
                    <p>–£–ª—É—á—à–µ–Ω–Ω—ã–π —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–¥–∫–∏–µ –±–∞—à–Ω–∏</p>
                    <button class="case-info-btn" data-case="premium">?</button>
                    <div class="case-info-content">
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
                            <span>–ë–æ–º–±—ã</span>
                            <span class="case-item-chance">40%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: gold;"></div>
                            <span>–•–æ—Ä–æ—à–∞—è —Ñ–µ—Ä–º–∞</span>
                            <span class="case-item-chance">25%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%);"></div>
                            <span>–¢–æ–∫—Å–∏—á–Ω—ã–π</span>
                            <span class="case-item-chance">20%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: gray;"></div>
                            <span>–¢—É—Ä–µ–ª—å</span>
                            <span class="case-item-chance">12.5%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background: linear-gradient(to right, purple, black);"></div>
                            <span>–ü—É—Å—Ç–æ–π</span>
                            <span class="case-item-chance">2.5%</span>
                        </div>
                    </div>
                    <button class="shop-item-btn" data-case="premium" data-price="200" id="openPremiumCaseBtn">–û—Ç–∫—Ä—ã—Ç—å –∑–∞ üíé200</button>
                </div>
            </div>
        </div>
    </div>
    
    <h1>Tower Defense</h1>
    
    <div class="info-panel">
        <div class="stats">
            –î–µ–Ω—å–≥–∏: <span id="money">200</span> | 
            –ñ–∏–∑–Ω–∏: <span id="lives">20</span> | 
            –í–æ–ª–Ω–∞: <span id="wave">0</span> |
            –ê–ª–º–∞–∑—ã: <span id="diamonds">0</span>
        </div>
        <div class="controls">
            <button id="toggleRadius">–°–∫—Ä—ã—Ç—å —Ä–∞–¥–∏—É—Å</button>
            <button id="toggleIndex">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å</button>
        </div>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        
     <div class="shop">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    
    <!-- –û–°–ù–û–í–ù–´–ï –ë–ê–®–ù–ò -->
    <div class="tower-item" data-type="pistol" data-price="50">
        <div class="tower-preview" style="background-color: blue; border-radius: 50%;"></div>
        <div class="tower-info">
            <div class="tower-name">–ü–∏—Å—Ç–æ–ª–µ—Ç</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 1/—Å–µ–∫ | –†–∞–¥–∏—É—Å: 100px</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 150 –º–æ–Ω–µ—Ç ‚Üí 2 —É—Ä–æ–Ω–∞/—Å–µ–∫, —Ä–∞–¥–∏—É—Å 120px</div>
        </div>
        <div class="tower-price">50</div>
    </div>
    
    <div class="tower-item" data-type="swordsman" data-price="125">
        <div class="tower-preview" style="background-color: red; transform: rotate(45deg);"></div>
        <div class="tower-info">
            <div class="tower-name">–ú–µ—á–Ω–∏–∫</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 1/0.5—Å–µ–∫ | –†–∞–¥–∏—É—Å: 40px</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 300 –º–æ–Ω–µ—Ç ‚Üí 2 —É—Ä–æ–Ω–∞/0.5—Å–µ–∫</div>
        </div>
        <div class="tower-price">125</div>
    </div>
    
    <div class="tower-item" data-type="sniper" data-price="250">
        <div class="tower-preview" style="background-color: purple;"></div>
        <div class="tower-info">
            <div class="tower-name">–°–Ω–∞–π–ø–µ—Ä</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 10/5—Å–µ–∫ | –†–∞–¥–∏—É—Å: 1000px</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 1000 –º–æ–Ω–µ—Ç ‚Üí 25 —É—Ä–æ–Ω–∞/2.5—Å–µ–∫</div>
        </div>
        <div class="tower-price">250</div>
    </div>
    
    <div class="tower-item" data-type="freezer" data-price="600">
        <div class="tower-preview" style="background-color: lightblue; border-radius: 50%;"></div>
        <div class="tower-info">
            <div class="tower-name">–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 1/5—Å–µ–∫ | –†–∞–¥–∏—É—Å: 250px | –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ: 10%</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 1250 –º–æ–Ω–µ—Ç ‚Üí –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ 35%</div>
        </div>
        <div class="tower-price">600</div>
    </div>
    
    <div class="tower-item" data-type="knight" data-price="1000">
        <div class="tower-preview" style="background: gray; clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);"></div>
        <div class="tower-info">
            <div class="tower-name">–†—ã—Ü–∞—Ä—å</div>
            <div class="tower-stats">–í–Ω—É—Ç—Ä: 5—É—Ä/0.6—Å–µ–∫/50px | –í–Ω–µ—à: 5—É—Ä/1.9—Å–µ–∫/280px</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 2500 –º–æ–Ω–µ—Ç ‚Üí —É—Å–∏–ª–µ–Ω–∏–µ –∞—Ç–∞–∫–∏</div>
        </div>
        <div class="tower-price">1000</div>
    </div>
    
    <div class="tower-item" data-type="farm" data-price="450">
        <div class="tower-preview" style="background-color: brown; border-radius: 50%;"></div>
        <div class="tower-info">
            <div class="tower-name">–§–µ—Ä–º–∞</div>
            <div class="tower-stats">–î–æ—Ö–æ–¥: 1 –º–æ–Ω–µ—Ç–∞/—Å–µ–∫ | –õ–∏–º–∏—Ç: 5</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 900 –º–æ–Ω–µ—Ç ‚Üí 3 –º–æ–Ω–µ—Ç—ã/—Å–µ–∫</div>
        </div>
        <div class="tower-price">450</div>
    </div>
    
    <div class="tower-item" data-type="chance" data-price="777">
        <div class="tower-preview" style="background-color: pink; clip-path: polygon(50% 0%, 90% 20%, 100% 60%, 75% 100%, 25% 100%, 0% 60%, 10% 20%);"></div>
        <div class="tower-info">
            <div class="tower-name">–®–∞–Ω—Å</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 7-17/0.7—Å–µ–∫ | –†–∞–¥–∏—É—Å: 170px</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 7777 –º–æ–Ω–µ—Ç ‚Üí 17-37 —É—Ä–æ–Ω–∞/0.77—Å–µ–∫</div>
        </div>
        <div class="tower-price">777</div>
    </div>
    
    <div class="tower-item" data-type="atomic" data-price="10000">
        <div class="tower-preview" style="background-color: darkgreen; clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);"></div>
        <div class="tower-info">
            <div class="tower-name">–ê—Ç–æ–º–Ω—ã–π</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 200/60—Å–µ–∫ | –†–∞–¥–∏—É—Å: 1000px | –õ–∏–º–∏—Ç: 2</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 30000 –º–æ–Ω–µ—Ç ‚Üí 250 —É—Ä–æ–Ω–∞/50—Å–µ–∫</div>
        </div>
        <div class="tower-price">10000</div>
    </div>
    
    <div class="tower-item" data-type="omega" data-price="12500">
        <div class="tower-preview" style="background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);"></div>
        <div class="tower-info">
            <div class="tower-name">–û–ú–ï–ì–ê</div>
            <div class="tower-stats">–í–Ω—É—Ç—Ä: 10—É—Ä/0.5—Å–µ–∫/90px | –í–Ω–µ—à: 25—É—Ä/3—Å–µ–∫/300px | –õ–∏–º–∏—Ç: 2</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 40000 –º–æ–Ω–µ—Ç ‚Üí 15—É—Ä/0.4—Å–µ–∫/150px –∏ 20—É—Ä/1—Å–µ–∫/300px</div>
        </div>
        <div class="tower-price">12500</div>
    </div>
    
    <!-- –ë–ê–®–ù–ò –ò–ó –ö–ï–ô–°–û–í -->
    <div class="tower-item" data-type="doublepistol" data-price="75">
        <div class="tower-preview" style="background: linear-gradient(to right, blue, lightblue); border-radius: 50%;"></div>
        <div class="tower-info">
            <div class="tower-name">–î–≤–æ–π–Ω–æ–π –ø–∏—Å—Ç–æ–ª–µ—Ç</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 2/—Å–µ–∫ | –†–∞–¥–∏—É—Å: 100px</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 150 –º–æ–Ω–µ—Ç ‚Üí 4 —É—Ä–æ–Ω–∞/—Å–µ–∫, —Ä–∞–¥–∏—É—Å 120px</div>
        </div>
        <div class="tower-price">75</div>
    </div>
    
    <div class="tower-item" data-type="bomb" data-price="325">
        <div class="tower-preview" style="background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
        <div class="tower-info">
            <div class="tower-name">–ë–æ–º–±—ã</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 5/2.5—Å–µ–∫ | –†–∞–¥–∏—É—Å: 80px | AoE</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 650 –º–æ–Ω–µ—Ç ‚Üí 5 —É—Ä–æ–Ω–∞/1.5—Å–µ–∫, —Ä–∞–¥–∏—É—Å 130px</div>
        </div>
        <div class="tower-price">325</div>
    </div>
    
    <div class="tower-item" data-type="goodfarm" data-price="450">
        <div class="tower-preview" style="background-color: gold;"></div>
        <div class="tower-info">
            <div class="tower-name">–•–æ—Ä–æ—à–∞—è —Ñ–µ—Ä–º–∞</div>
            <div class="tower-stats">–î–æ—Ö–æ–¥: 5 –º–æ–Ω–µ—Ç/—Å–µ–∫ | –õ–∏–º–∏—Ç: 2</div>
            <div class="upgrade-option">–ù–µ—Ç —É–ª—É—á—à–µ–Ω–∏–π</div>
        </div>
        <div class="tower-price">450</div>
    </div>
    
    <div class="tower-item" data-type="toxic" data-price="1250">
        <div class="tower-preview" style="background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%);"></div>
        <div class="tower-info">
            <div class="tower-name">–¢–æ–∫—Å–∏—á–Ω—ã–π</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 1/0.1—Å–µ–∫ | –õ—É–∂–∞ –Ω–∞ –ø–æ–ª–µ | –õ–∏–º–∏—Ç: 3</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 2500 –º–æ–Ω–µ—Ç ‚Üí 2 —É—Ä–æ–Ω–∞/0.1—Å–µ–∫</div>
        </div>
        <div class="tower-price">1250</div>
    </div>
    
    <div class="tower-item" data-type="turret" data-price="2500">
        <div class="tower-preview" style="background-color: gray;"></div>
        <div class="tower-info">
            <div class="tower-name">–¢—É—Ä–µ–ª—å</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 2/0.2—Å–µ–∫ | –†–∞–¥–∏—É—Å: 150px | –õ–∏–º–∏—Ç: 8</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 5000 –º–æ–Ω–µ—Ç ‚Üí 2 —É—Ä–æ–Ω–∞/0.1—Å–µ–∫, —Ä–∞–¥–∏—É—Å 160px</div>
        </div>
        <div class="tower-price">2500</div>
    </div>
    
    <div class="tower-item" data-type="empty" data-price="7500">
        <div class="tower-preview" style="background: linear-gradient(to right, purple, black);"></div>
        <div class="tower-info">
            <div class="tower-name">–ü—É—Å—Ç–æ–π</div>
            <div class="tower-stats">–£—Ä–æ–Ω: 10/—Å–µ–∫ | –†–∞–¥–∏—É—Å: 100px | –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ 50% | –õ–∏–º–∏—Ç: 1</div>
            <div class="upgrade-option">–£–ª—É—á—à–µ–Ω–∏–µ: 17500 –º–æ–Ω–µ—Ç ‚Üí 20 —É—Ä–æ–Ω–∞/—Å–µ–∫, —Ä–∞–¥–∏—É—Å 200px, –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ 65%</div>
        </div>
        <div class="tower-price">7500</div>
    </div>
</div>

<!-- –ò–ù–î–ï–ö–° –í–†–ê–ì–û–í -->
<div class="enemy-index" id="enemyIndex">
    <h2>–ò–Ω–¥–µ–∫—Å –≤—Ä–∞–≥–æ–≤</h2>
    
    <div class="enemy-item" id="red-enemy">
        <div class="enemy-name">–ö—Ä–∞—Å–Ω—ã–π —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 3 + –≤–æ–ª–Ω–∞/3</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 1.0</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 10 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="purple-enemy">
        <div class="enemy-name">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 15</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 0.5</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 25 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="golden-enemy">
        <div class="enemy-name">–ó–æ–ª–æ—Ç–æ–π —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 35</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 2.0</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 50 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="pink-enemy">
        <div class="enemy-name">–†–æ–∑–æ–≤—ã–π —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 11</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 5.0</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 30 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="green-enemy">
        <div class="enemy-name">–ó–µ–ª–µ–Ω—ã–π —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 100</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 0.32</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 75 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="white-enemy">
        <div class="enemy-name">–ë–µ–ª—ã–π —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 120</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è (0.32-2.0)</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 100 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="boss-enemy">
        <div class="enemy-name">–ë–û–°–° (–ß–µ—Ä–Ω—ã–π —à–∞—Ä)</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 250 + 250 –∑–∞ –∫–∞–∂–¥—ã–µ 50 –≤–æ–ª–Ω</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 1.0</div>
            <div>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å: –£–º–µ–Ω—å—à–∞–µ—Ç —É—Ä–æ–Ω –±–∞—à–µ–Ω –≤ —Ä–∞–¥–∏—É—Å–µ 40px</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 500 + –≤–æ–ª–Ω–∞√ó10 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="blue-enemy">
        <div class="enemy-name">–ì–æ–ª—É–±–æ–π —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 200</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 0.2</div>
            <div>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å: –õ–µ—á–∏—Ç –¥—Ä—É–≥–∏—Ö –≤—Ä–∞–≥–æ–≤ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 150 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="sonic-enemy">
        <div class="enemy-name">–°–æ–Ω–∏–∫ —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 10</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 10.0</div>
            <div>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å: –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 200 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
    
    <div class="enemy-item" id="void-enemy">
        <div class="enemy-name">–ü—É—Å—Ç–æ—Ç–Ω—ã–π —à–∞—Ä</div>
        <div class="enemy-stats">
            <div>–ó–¥–æ—Ä–æ–≤—å–µ: 1000</div>
            <div>–°–∫–æ—Ä–æ—Å—Ç—å: 0.33</div>
            <div>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å: –£–¥–∞–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –±–∞—à–Ω—é –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥</div>
            <div>–ù–∞–≥—Ä–∞–¥–∞: 1000 –º–æ–Ω–µ—Ç</div>
        </div>
    </div>
</div>

<!-- –ú–ï–ù–Æ –£–õ–£–ß–®–ï–ù–ò–Ø -->
<div class="upgrade-menu" id="upgradeMenu">
    <h3>–£–ª—É—á—à–µ–Ω–∏–µ –±–∞—à–Ω–∏</h3>
    <div id="upgradeInfo">
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –±–∞—à–Ω—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É–ª—É—á—à–µ–Ω–∏–∏</p>
    </div>
    <div class="targeting-options" id="targetingOptions">
        <label>
            <input type="radio" name="targeting" value="first" checked> –ü–µ—Ä–≤–∞—è —Ü–µ–ª—å (–±–ª–∏–∂–∞–π—à–∞—è –∫ –∫–æ–Ω—Ü—É)
        </label>
        <label>
            <input type="radio" name="targeting" value="random"> –°–ª—É—á–∞–π–Ω–∞—è —Ü–µ–ª—å
        </label>
    </div>
    <button class="upgrade-btn" id="upgradeBtn">–£–ª—É—á—à–∏—Ç—å</button>
    <button class="sell-btn" id="sellBtn">–ü—Ä–æ–¥–∞—Ç—å (50% —Å—Ç–æ–∏–º–æ—Å—Ç–∏)</button>
</div>
    
    <button id="restartGame">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    <div class="game-overlay" id="gameOverlay"></div>
    
    <script>
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã canvas –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let money = 200;
        let lives = 20;
        let wave = 0;
        let diamonds = 0;
        let totalDiamonds = 0;
        let enemies = [];
        let towers = [];
        let bullets = [];
        let puddles = [];
        let selectedTowerType = null;
        let selectedTower = null;
        let gameActive = true;
        let enemySpawnTimer = 0;
        let enemiesToSpawn = 0;
        let showRadius = true;
        let waveActive = false;
        let redCount = 0;
        let purpleCount = 0;
        let goldenCount = 0;
        let pinkCount = 0;
        let greenCount = 0;
        let whiteCount = 0;
        let bossCount = 0;
        let blueCount = 0;
        let sonicCount = 0;
        let voidCount = 0;
        let rangeIndicator = null;
        let bossAura = null;
        let difficulty = "normal";
        let mapType = "hills";
        let farmCount = 0;
        let atomicCount = 0;
        let omegaCount = 0;
        let goodFarmCount = 0;
        let toxicCount = 0;
        let turretCount = 0;
        let emptyCount = 0;
        let waveRewardMultiplier = 1; // –ú–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –≤–æ–ª–Ω—ã
        let ownedTowers = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –±–∞—à–µ–Ω

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º—ã—à–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ canvas
        function getMousePos(canvas, evt) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            return {
                x: (evt.clientX - rect.left) * scaleX,
                y: (evt.clientY - rect.top) * scaleY
            };
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
        function loadGameData() {
            const savedData = localStorage.getItem('tdGameData');
            if (savedData) {
                const data = JSON.parse(savedData);
                totalDiamonds = data.totalDiamonds || 0;
                ownedTowers = data.ownedTowers || [];
                document.getElementById('diamondTotal').textContent = totalDiamonds;
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫—É–ø–ª–µ–Ω–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∫–∞—Ä—Ç—ã
                if (data.unlockedExtreme) {
                    document.getElementById('extremeDifficultyBtn').classList.remove('option-btn');
                    document.getElementById('extremeDifficultyBtn').classList.add('option-btn');
                    document.getElementById('buyExtremeBtn').disabled = true;
                    document.getElementById('buyExtremeBtn').textContent = '–ö—É–ø–ª–µ–Ω–æ';
                }
                
                if (data.unlockedMountains) {
                    document.getElementById('mountainsMapBtn').classList.remove('option-btn');
                    document.getElementById('mountainsMapBtn').classList.add('option-btn');
                    document.getElementById('buyMountainsBtn').disabled = true;
                    document.getElementById('buyMountainsBtn').textContent = '–ö—É–ø–ª–µ–Ω–æ';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –±–∞—à–Ω–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
                ownedTowers.forEach(towerType => {
                    document.getElementById(`${towerType}Tower`).style.display = 'flex';
                });
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        function saveGameData() {
            const data = {
                totalDiamonds: totalDiamonds,
                unlockedExtreme: document.getElementById('buyExtremeBtn').disabled,
                unlockedMountains: document.getElementById('buyMountainsBtn').disabled,
                ownedTowers: ownedTowers
            };
            
            localStorage.setItem('tdGameData', JSON.stringify(data));
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∏–ª—è –¥–ª—è –±–∞—à–Ω–∏
        function getTowerStyle(type) {
            switch(type) {
                case 'doublepistol': return 'background: linear-gradient(to right, blue, lightblue); border-radius: 50%;';
                case 'bomb': return 'background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);';
                case 'goodfarm': return 'background-color: gold;';
                case 'toxic': return 'background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%);';
                case 'turret': return 'background-color: gray;';
                case 'empty': return 'background: linear-gradient(to right, purple, black);';
                default: return '';
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –±–∞—à–Ω–∏
        function getTowerName(type) {
            switch(type) {
                case 'doublepistol': return '–î–≤–æ–π–Ω–æ–π –ø–∏—Å—Ç–æ–ª–µ—Ç';
                case 'bomb': return '–ë–æ–º–±—ã';
                case 'goodfarm': return '–•–æ—Ä–æ—à–∞—è —Ñ–µ—Ä–º–∞';
                case 'toxic': return '–¢–æ–∫—Å–∏—á–Ω—ã–π';
                case 'turret': return '–¢—É—Ä–µ–ª—å';
                case 'empty': return '–ü—É—Å—Ç–æ–π';
                default: return '';
            }
        }
        
        let enemyKnowledge = {
            'red': { health: 0, speed: 0, discovered: false },
            'purple': { health: 0, speed: 0, discovered: false },
            'golden': { health: 0, speed: 0, discovered: false },
            'pink': { health: 0, speed: 0, discovered: false },
            'green': { health: 0, speed: 0, discovered: false },
            'white': { health: 0, speed: 0, discovered: false },
            'boss': { health: 0, speed: 0, discovered: false, special: "" },
            'blue': { health: 0, speed: 0, discovered: false, special: "" },
            'sonic': { health: 0, speed: 0, discovered: false, special: "" },
            'void': { health: 0, speed: 0, discovered: false, special: "" }
        };
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const ENEMY_BASE_SPEED = 1;
        const ENEMY_SIZE = 10;
        const TOWER_SIZE = 15;
        const BULLET_SIZE = 5;
        const ST_TO_PX = 10; // 1st = 10px
        
        // –ü—É—Ç—å –¥–ª—è –≤—Ä–∞–≥–æ–≤ (–∂–µ–ª—Ç–∞—è —Ç—Ä–æ–ø–∏–Ω–∫–∞)
        let PATH = [];
        
        // –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—É—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ä—Ç—ã
        function setPath() {
            if (mapType === "hills") {
                PATH = [
                    {x: -20, y: 250},
                    {x: 150, y: 250},
                    {x: 150, y: 150},
                    {x: 400, y: 150},
                    {x: 400, y: 350},
                    {x: 650, y: 350},
                    {x: 650, y: 250},
                    {x: 820, y: 250}
                ];
            } else if (mapType === "flat") {
                PATH = [
                    {x: -20, y: 250},
                    {x: 820, y: 250}
                ];
            } else if (mapType === "mountains") {
                PATH = [
                    {x: -20, y: 250},
                    {x: 100, y: 250},
                    {x: 100, y: 100},
                    {x: 200, y: 100},
                    {x: 200, y: 400},
                    {x: 300, y: 400},
                    {x: 300, y: 150},
                    {x: 500, y: 150},
                    {x: 500, y: 350},
                    {x: 700, y: 350},
                    {x: 700, y: 200},
                    {x: 820, y: 200}
                ];
            }
        }
        
        // –ö–ª–∞—Å—Å –≤—Ä–∞–≥–∞
        class Enemy {
            constructor(type, health, speed, size, color) {
                this.type = type;
                this.health = health;
                this.maxHealth = health;
                this.baseSpeed = speed;
                this.speed = speed;
                this.size = size;
                this.color = color;
                this.x = PATH[0].x;
                this.y = PATH[0].y;
                this.pathIndex = 0;
                this.slowPercent = 0;
                this.speedChangeTimer = 0;
                this.auraRadius = 0;
                this.healTimer = 0;
                this.deleteTimer = 0;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                if (difficulty === "hard") {
                    this.health *= 1.5; // –í 1.5 —Ä–∞–∑ –±–æ–ª—å—à–µ –∑–¥–æ—Ä–æ–≤—å—è
                    this.maxHealth = this.health;
                    this.baseSpeed *= 1.05;
                    this.speed = this.baseSpeed;
                } else if (difficulty === "extreme") {
                    this.health *= 2; // –í 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –∑–¥–æ—Ä–æ–≤—å—è
                    this.maxHealth = this.health;
                    this.baseSpeed *= 1.01;
                    this.speed = this.baseSpeed;
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤—Ä–∞–≥–æ–≤
                if (type === 'boss') {
                    this.auraRadius = 4 * ST_TO_PX; // 4st = 40px (–∫–∞–∫ —É –º–µ—á–Ω–∏–∫–∞)
                } else if (type === 'blue') {
                    this.healTimer = 600; // 10 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ 60 FPS
                } else if (type === 'void') {
                    this.deleteTimer = 3600; // 60 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ 60 FPS
                }
                
                // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Ä–∞–≥–µ, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ –±—ã–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω
                if (!enemyKnowledge[type].discovered) {
                    enemyKnowledge[type].health = health;
                    enemyKnowledge[type].speed = speed;
                    
                    if (type === 'boss') {
                        enemyKnowledge[type].special = "–£–º–µ–Ω—å—à–∞–µ—Ç —É—Ä–æ–Ω –±–∞—à–µ–Ω –≤ —Ä–∞–¥–∏—É—Å–µ";
                    } else if (type === 'blue') {
                        enemyKnowledge[type].special = "–õ–µ—á–∏—Ç –¥—Ä—É–≥–∏—Ö –≤—Ä–∞–≥–æ–≤";
                    } else if (type === 'sonic') {
                        enemyKnowledge[type].special = "–û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π";
                    } else if (type === 'void') {
                        enemyKnowledge[type].special = "–£–¥–∞–ª—è–µ—Ç –±–∞—à–Ω–∏ —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É";
                    }
                    
                    enemyKnowledge[type].discovered = true;
                    updateEnemyIndex();
                }
            }
            
            update() {
                // –î–ª—è –±–µ–ª–æ–≥–æ –≤—Ä–∞–≥–∞ - –º–µ–Ω—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                if (this.type === 'white') {
                    this.speedChangeTimer++;
                    if (this.speedChangeTimer >= 60) {
                        this.speedChangeTimer = 0;
                        // –ú–µ–Ω—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–µ–ª–µ–Ω–æ–≥–æ –¥–æ –∑–æ–ª–æ—Ç–æ–≥–æ
                        const greenSpeed = ENEMY_BASE_SPEED / 3.15675434;
                        const goldenSpeed = ENEMY_BASE_SPEED * 2;
                        this.speed = greenSpeed + Math.random() * (goldenSpeed - greenSpeed);
                    }
                }
                
                // –î–ª—è –≥–æ–ª—É–±–æ–≥–æ –≤—Ä–∞–≥–∞ - –ª–µ—á–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                if (this.type === 'blue') {
                    this.healTimer--;
                    if (this.healTimer <= 0) {
                        this.healTimer = 600; // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
                        
                        // –õ–µ—á–∏–º –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤ –Ω–∞ 50% –æ—Ç –∏—Ö –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è
                        for (const enemy of enemies) {
                            if (enemy !== this) {
                                enemy.health = Math.min(enemy.maxHealth, enemy.health + enemy.maxHealth * 0.5);
                            }
                        }
                    }
                }
                
                // –î–ª—è –ø—É—Å—Ç–æ—Ç–Ω–æ–≥–æ –≤—Ä–∞–≥–∞ - —É–¥–∞–ª–µ–Ω–∏–µ –±–∞—à–Ω–∏ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
                if (this.type === 'void') {
                    this.deleteTimer--;
                    if (this.deleteTimer <= 0) {
                        this.deleteTimer = 3600; // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
                        
                        // –£–¥–∞–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é –±–∞—à–Ω—é (–∫—Ä–æ–º–µ –û–ú–ï–ì–ò)
                        const nonOmegaTowers = towers.filter(tower => tower.type !== 'omega');
                        if (nonOmegaTowers.length > 0) {
                            const randomIndex = Math.floor(Math.random() * nonOmegaTowers.length);
                            const towerToRemove = nonOmegaTowers[randomIndex];
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∞—à–µ–Ω
                            if (towerToRemove.type === 'farm') farmCount--;
                            if (towerToRemove.type === 'atomic') atomicCount--;
                            if (towerToRemove.type === 'omega') omegaCount--;
                            if (towerToRemove.type === 'goodfarm') goodFarmCount--;
                            if (towerToRemove.type === 'toxic') toxicCount--;
                            if (towerToRemove.type === 'turret') turretCount--;
                            if (towerToRemove.type === 'empty') emptyCount--;
                            
                            towers.splice(towers.indexOf(towerToRemove), 1);
                        }
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –≤—Ä–∞–≥ –≤ –ª—É–∂–µ
                let inPuddle = false;
                for (const puddle of puddles) {
                    const dx = this.x - puddle.x;
                    const dy = this.y - puddle.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < puddle.radius) {
                        inPuddle = true;
                        this.takeDamage(puddle.damage);
                        break;
                    }
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
                this.speed = this.baseSpeed * (1 - this.slowPercent / 100);
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ –ø—É—Ç–∏
                const targetX = PATH[this.pathIndex].x;
                const targetY = PATH[this.pathIndex].y;
                
                const dx = targetX - this.x;
                const dy = targetY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < this.speed) {
                    this.x = targetX;
                    this.y = targetY;
                    this.pathIndex++;
                    
                    // –ï—Å–ª–∏ –≤—Ä–∞–≥ –¥–æ—à–µ–ª –¥–æ –∫–æ–Ω—Ü–∞ –ø—É—Ç–∏
                    if (this.pathIndex >= PATH.length) {
                        lives--;
                        updateStats();
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–∏–≥—Ä—ã—à
                        if (lives <= 0) {
                            gameOver();
                        }
                        
                        return false;
                    }
                } else {
                    this.x += (dx / distance) * this.speed;
                    this.y += (dy / distance) * this.speed;
                }
                
                return true;
            }
            
            draw() {
                // –†–∏—Å—É–µ–º –≤—Ä–∞–≥–∞
                ctx.fillStyle = this.color;
                
                if (this.type === 'red' || this.type === 'purple' || this.type === 'pink' || 
                    this.type === 'green' || this.type === 'white' || this.type === 'blue') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.type === 'golden') {
                    // –ó–æ–ª–æ—Ç–æ–π –≤—Ä–∞–≥ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å–∏—è–Ω–∏—è
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    
                    // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –∑–æ–ª–æ—Ç–æ–≥–æ –≤—Ä–∞–≥–∞
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0, 
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, '#FFD700');
                    gradient.addColorStop(1, '#DAA520');
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç —Å–∏—è–Ω–∏—è
                    ctx.strokeStyle = 'rgba(255, 215, 0, 0.6)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 3, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (this.type === 'boss') {
                    // –ë–æ—Å—Å - —á–µ—Ä–Ω—ã–π —à–∞—Ä —Å –∫—Ä–∞—Å–Ω–æ–π –∞—É—Ä–∞
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // –ê—É—Ä–∞ –±–æ—Å—Å–∞
                    ctx.strokeStyle = 'rgba(255, 0, 0, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.auraRadius, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞—É—Ä—ã
                    if (bossAura) {
                        bossAura.style.left = this.x + 'px';
                        bossAura.style.top = this.y + 'px';
                        bossAura.style.width = this.auraRadius * 2 + 'px';
                        bossAura.style.height = this.auraRadius * 2 + 'px';
                    }
                } else if (this.type === 'sonic') {
                    // –°–æ–Ω–∏–∫ —à–∞—Ä (–∂–µ–ª—Ç—ã–π + —Å–∏–Ω–∏–π)
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    
                    // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Å–æ–Ω–∏–∫ —à–∞—Ä–∞
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0, 
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, '#FFFF00');
                    gradient.addColorStop(1, '#0000FF');
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.6)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 3, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (this.type === 'void') {
                    // –ü—É—Å—Ç–æ—Ç–Ω—ã–π —à–∞—Ä (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π + —á–µ—Ä–Ω—ã–π)
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    
                    // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –ø—É—Å—Ç–æ—Ç–Ω–æ–≥–æ —à–∞—Ä–∞
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0, 
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, '#8A2BE2');
                    gradient.addColorStop(1, '#000000');
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –ø—É—Å—Ç–æ—Ç—ã
                    ctx.strokeStyle = 'rgba(75, 0, 130, 0.6)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 3, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                // –†–∏—Å—É–µ–º –ø–æ–ª–æ—Å–∫—É –∑–¥–æ—Ä–æ–≤—å—è
                const healthWidth = (this.health / this.maxHealth) * (this.size * 2);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(this.x - this.size, this.y - this.size - 8, this.size * 2, 4);
                ctx.fillStyle = this.type === 'golden' ? '#00ff00' : 'red';
                ctx.fillRect(this.x - this.size, this.y - this.size - 8, healthWidth, 4);
                
                // –î–ª—è –∑–∞–º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤ –¥–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ª—å–¥–∞
                if (this.slowPercent > 0) {
                    ctx.strokeStyle = 'rgba(100, 200, 255, 0.7)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 2, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
            
            takeDamage(damage) {
                // –î–ª—è –±–æ—Å—Å–∞ - —É–º–µ–Ω—å—à–∞–µ–º —É—Ä–æ–Ω –æ—Ç –±–∞—à–µ–Ω –≤ –µ–≥–æ –∞—É—Ä–µ
                if (this.type === 'boss') {
                    let actualDamage = damage;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∞—Ç–∞–∫—É—é—â–∞—è –±–∞—à–Ω—è –≤ –∞—É—Ä–µ –±–æ—Å—Å–∞
                    for (const tower of towers) {
                        const dx = tower.x - this.x;
                        const dy = tower.y - this.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < this.auraRadius) {
                            actualDamage = damage * 0.5; // –£–º–µ–Ω—å—à–∞–µ–º —É—Ä–æ–Ω –≤–¥–≤–æ–µ
                            break;
                        }
                    }
                    
                    this.health -= actualDamage;
                } else {
                    this.health -= damage;
                }
                
                if (this.health <= 0) {
                    let reward = 0;
                    
                    switch(this.type) {
                        case 'red': reward = 10; break;
                        case 'purple': reward = 25; break;
                        case 'golden': reward = 50; break;
                        case 'pink': reward = 30; break;
                        case 'green': reward = 75; break;
                        case 'white': reward = 100; break;
                        case 'boss': reward = 500 + wave * 10; break;
                        case 'blue': reward = 150; break;
                        case 'sonic': reward = 200; break;
                        case 'void': reward = 1000; break;
                    }
                    
                    money += reward;
                    updateStats();
                    
                    // –£–¥–∞–ª—è–µ–º –∞—É—Ä—É –±–æ—Å—Å–∞, –µ—Å–ª–∏ —ç—Ç–æ –±–æ—Å—Å
                    if (this.type === 'boss' && bossAura) {
                        document.body.removeChild(bossAura);
                        bossAura = null;
                    }
                    
                    return true;
                }
                return false;
            }
            
            slowDown(percent) {
                this.slowPercent = Math.max(this.slowPercent, percent);
            }
        }
        
        // –ö–ª–∞—Å—Å –ª—É–∂–∏ (–¥–ª—è —Ç–æ–∫—Å–∏—á–Ω–æ–π –±–∞—à–Ω–∏)
        class Puddle {
            constructor(x, y, damage, radius, duration) {
                this.x = x;
                this.y = y;
                this.damage = damage;
                this.radius = radius;
                this.duration = duration; // –≤ –∫–∞–¥—Ä–∞—Ö
                this.timer = 0;
            }
            
            update() {
                this.timer++;
                return this.timer < this.duration;
            }
            
            draw() {
                ctx.fillStyle = 'rgba(0, 255, 0, 0.3)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = 'rgba(0, 200, 0, 0.7)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
        
        // –ö–ª–∞—Å—Å –±–∞—à–Ω–∏
        class Tower {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.upgraded = false;
                this.targeting = 'first'; // 'first' –∏–ª–∏ 'random'
                this.incomeTimer = 0;
                this.puddleTimer = 0;
                this.specialTimer = 0;
                
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                switch(type) {
                    case 'pistol':
                        this.radius = 10 * ST_TO_PX; // 10st = 100px
                        this.damage = 1;
                        this.fireRate = 60; // 1 –≤—ã—Å—Ç—Ä–µ–ª –≤ —Å–µ–∫—É–Ω–¥—É (60 FPS)
                        this.color = 'blue';
                        this.shape = 'circle';
                        this.upgradeCost = 150;
                        this.upgradeDamage = 2;
                        this.upgradeRadius = 12 * ST_TO_PX; // 12st = 120px
                        this.upgradeFireRate = 60;
                        break;
                    case 'swordsman':
                        this.radius = 4 * ST_TO_PX; // 4st = 40px
                        this.damage = 1;
                        this.fireRate = 30; // 2 –≤—ã—Å—Ç—Ä–µ–ª–∞ –≤ —Å–µ–∫—É–Ω–¥—É
                        this.color = 'red';
                        this.shape = 'diamond';
                        this.upgradeCost = 300;
                        this.upgradeDamage = 2;
                        this.upgradeRadius = 4 * ST_TO_PX;
                        this.upgradeFireRate = 30;
                        break;
                    case 'sniper':
                        this.radius = 100 * ST_TO_PX; // 100st = 1000px
                        this.damage = 10;
                        this.fireRate = 300; // 1 –≤—ã—Å—Ç—Ä–µ–ª –≤ 5 —Å–µ–∫—É–Ω–¥
                        this.color = 'purple';
                        this.shape = 'square';
                        this.upgradeCost = 1000;
                        this.upgradeDamage = 25;
                        this.upgradeRadius = 100 * ST_TO_PX;
                        this.upgradeFireRate = 150; // 1 –≤—ã—Å—Ç—Ä–µ–ª –≤ 2.5 —Å–µ–∫—É–Ω–¥—ã
                        break;
                    case 'freezer':
                        this.radius = 25 * ST_TO_PX; // 25st = 250px
                        this.damage = 1;
                        this.fireRate = 300; // 1 –≤—ã—Å—Ç—Ä–µ–ª –≤ 5 —Å–µ–∫—É–Ω–¥
                        this.slowPercent = 10;
                        this.color = 'lightblue';
                        this.shape = 'circle';
                        this.upgradeCost = 1250;
                        this.upgradeDamage = 1;
                        this.upgradeRadius = 25 * ST_TO_PX;
                        this.upgradeFireRate = 300;
                        this.upgradeSlowPercent = 35;
                        break;
                    case 'knight':
                        this.innerRadius = 5 * ST_TO_PX; // 5st = 50px
                        this.outerRadius = 28 * ST_TO_PX; // 28st = 280px
                        this.innerDamage = 5;
                        this.outerDamage = 5;
                        this.innerFireRate = 36; // 0.6—Å–µ–∫ = 36 –∫–∞–¥—Ä–æ–≤
                        this.outerFireRate = 114; // 1.9—Å–µ–∫ = 114 –∫–∞–¥—Ä–æ–≤
                        this.color = 'gray';
                        this.innerColor = 'red';
                        this.shape = 'pentagon';
                        this.upgradeCost = 2500;
                        this.upgradeInnerRadius = 8 * ST_TO_PX; // 8st = 80px
                        this.upgradeOuterRadius = 30 * ST_TO_PX; // 30st = 300px
                        this.upgradeInnerDamage = 5;
                        this.upgradeOuterDamage = 10;
                        this.upgradeInnerFireRate = 20; // 0.33—Å–µ–∫ = 20 –∫–∞–¥—Ä–æ–≤
                        this.upgradeOuterFireRate = 90; // 1.5—Å–µ–∫ = 90 –∫–∞–¥—Ä–æ–≤
                        break;
                    case 'farm':
                        this.radius = 0;
                        this.damage = 0;
                        this.income = 1;
                        this.incomeRate = 60; // 1 –º–æ–Ω–µ—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥—É
                        this.color = 'brown';
                        this.shape = 'circle';
                        this.upgradeCost = 900;
                        this.upgradeIncome = 3;
                        break;
                    case 'chance':
                        this.radius = 17 * ST_TO_PX; // 17st = 170px
                        this.minDamage = 7;
                        this.maxDamage = 17;
                        this.fireRate = 42; // 0.7—Å–µ–∫ = 42 –∫–∞–¥—Ä–∞
                        this.color = 'pink';
                        this.shape = 'hexagon';
                        this.upgradeCost = 7777;
                        this.upgradeMinDamage = 17;
                        this.upgradeMaxDamage = 37;
                        this.upgradeFireRate = 46; // 0.77—Å–µ–∫ = 46 –∫–∞–¥—Ä–æ–≤
                        break;
                    case 'atomic':
                        this.radius = 100 * ST_TO_PX; // 100st = 1000px
                        this.damage = 200;
                        this.fireRate = 3600; // 60—Å–µ–∫ = 3600 –∫–∞–¥—Ä–æ–≤
                        this.color = 'darkgreen';
                        this.shape = 'octagon';
                        this.upgradeCost = 30000;
                        this.upgradeDamage = 250;
                        this.upgradeFireRate = 3000; // 50—Å–µ–∫ = 3000 –∫–∞–¥—Ä–æ–≤
                        break;
                    case 'omega':
                        this.innerRadius = 9 * ST_TO_PX; // 9st = 90px
                        this.outerRadius = 30 * ST_TO_PX; // 30st = 300px
                        this.innerDamage = 10;
                        this.outerDamage = 25;
                        this.innerFireRate = 30; // 0.5—Å–µ–∫ = 30 –∫–∞–¥—Ä–æ–≤
                        this.outerFireRate = 180; // 3—Å–µ–∫ = 180 –∫–∞–¥—Ä–æ–≤
                        this.color = 'rainbow';
                        this.innerColor = 'cyan';
                        this.shape = 'square';
                        this.upgradeCost = 40000;
                        this.upgradeInnerRadius = 15 * ST_TO_PX; // 15st = 150px
                        this.upgradeOuterRadius = 30 * ST_TO_PX; // 30st = 300px
                        this.upgradeInnerDamage = 15;
                        this.upgradeOuterDamage = 20;
                        this.upgradeInnerFireRate = 24; // 0.4—Å–µ–∫ = 24 –∫–∞–¥—Ä–∞
                        this.upgradeOuterFireRate = 60; // 1—Å–µ–∫ = 60 –∫–∞–¥—Ä–æ–≤
                        break;
                    case 'doublepistol':
                        this.radius = 10 * ST_TO_PX; // 10st = 100px
                        this.damage = 2;
                        this.fireRate = 60; // 1 –≤—ã—Å—Ç—Ä–µ–ª –≤ —Å–µ–∫—É–Ω–¥—É (60 FPS)
                        this.color = 'blue';
                        this.secondColor = 'lightblue';
                        this.shape = 'circle';
                        this.upgradeCost = 150;
                        this.upgradeDamage = 4;
                        this.upgradeRadius = 12 * ST_TO_PX; // 12st = 120px
                        this.upgradeFireRate = 60;
                        break;
                    case 'bomb':
                        this.radius = 8 * ST_TO_PX; // 8st = 80px
                        this.damage = 5;
                        this.fireRate = 150; // 2.5—Å–µ–∫ = 150 –∫–∞–¥—Ä–æ–≤
                        this.aoe = true;
                        this.color = 'black';
                        this.shape = 'triangle';
                        this.upgradeCost = 650;
                        this.upgradeDamage = 5;
                        this.upgradeRadius = 13 * ST_TO_PX; // 13st = 130px
                        this.upgradeFireRate = 90; // 1.5—Å–µ–∫ = 90 –∫–∞–¥—Ä–æ–≤
                        break;
                    case 'goodfarm':
                        this.radius = 0;
                        this.damage = 0;
                        this.income = 5;
                        this.incomeRate = 60; // 5 –º–æ–Ω–µ—Ç –≤ —Å–µ–∫—É–Ω–¥—É
                        this.color = 'gold';
                        this.shape = 'square';
                        this.size = 20; // –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä
                        break;
                    case 'toxic':
                        this.radius = 0;
                        this.damage = 1;
                        this.fireRate = 6; // 0.1—Å–µ–∫ = 6 –∫–∞–¥—Ä–æ–≤
                        this.puddleRate = 180; // 3—Å–µ–∫ = 180 –∫–∞–¥—Ä–æ–≤
                        this.puddleDamage = 1;
                        this.puddleRadius = 5 * ST_TO_PX; // 5st = 50px
                        this.puddleDuration = 300; // 5—Å–µ–∫ = 300 –∫–∞–¥—Ä–æ–≤
                        this.color = 'green';
                        this.shape = 'decagon';
                        this.upgradeCost = 2500;
                        this.upgradeDamage = 2;
                        break;
                    case 'turret':
                        this.radius = 15 * ST_TO_PX; // 15st = 150px
                        this.damage = 2;
                        this.fireRate = 12; // 0.2—Å–µ–∫ = 12 –∫–∞–¥—Ä–æ–≤
                        this.color = 'gray';
                        this.shape = 'square';
                        this.size = 20; // –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä
                        this.upgradeCost = 5000;
                        this.upgradeDamage = 2;
                        this.upgradeRadius = 16 * ST_TO_PX; // 16st = 160px
                        this.upgradeFireRate = 6; // 0.1—Å–µ–∫ = 6 –∫–∞–¥—Ä–æ–≤
                        break;
                    case 'empty':
                        this.radius = 10 * ST_TO_PX; // 10st = 100px
                        this.damage = 10;
                        this.fireRate = 60; // 1—Å–µ–∫ = 60 –∫–∞–¥—Ä–æ–≤
                        this.slowPercent = 50;
                        this.color = 'purple';
                        this.auraColor = 'black';
                        this.shape = 'diamond';
                        this.specialChance = 0.041; // 4.1%
                        this.specialDamage = 25;
                        this.specialRate = 600; // 10—Å–µ–∫ = 600 –∫–∞–¥—Ä–æ–≤
                        this.upgradeCost = 17500;
                        this.upgradeDamage = 20;
                        this.upgradeRadius = 20 * ST_TO_PX; // 20st = 200px
                        this.upgradeSlowPercent = 65;
                        break;
                }
                
                this.cooldown = 0;
                this.outerCooldown = 0;
                this.size = this.size || TOWER_SIZE;
            }
            
            upgrade() {
                if (this.upgraded) return false;
                
                switch(this.type) {
                    case 'pistol':
                        this.damage = this.upgradeDamage;
                        this.radius = this.upgradeRadius;
                        break;
                    case 'swordsman':
                        this.damage = this.upgradeDamage;
                        break;
                    case 'sniper':
                        this.damage = this.upgradeDamage;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'freezer':
                        this.slowPercent = this.upgradeSlowPercent;
                        break;
                    case 'knight':
                        this.innerRadius = this.upgradeInnerRadius;
                        this.outerRadius = this.upgradeOuterRadius;
                        this.innerDamage = this.upgradeInnerDamage;
                        this.outerDamage = this.upgradeOuterDamage;
                        this.innerFireRate = this.upgradeInnerFireRate;
                        this.outerFireRate = this.upgradeOuterFireRate;
                        break;
                    case 'farm':
                        this.income = this.upgradeIncome;
                        break;
                    case 'chance':
                        this.minDamage = this.upgradeMinDamage;
                        this.maxDamage = this.upgradeMaxDamage;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'atomic':
                        this.damage = this.upgradeDamage;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'omega':
                        this.innerRadius = this.upgradeInnerRadius;
                        this.outerRadius = this.upgradeOuterRadius;
                        this.innerDamage = this.upgradeInnerDamage;
                        this.outerDamage = this.upgradeOuterDamage;
                        this.innerFireRate = this.upgradeInnerFireRate;
                        this.outerFireRate = this.upgradeOuterFireRate;
                        break;
                    case 'doublepistol':
                        this.damage = this.upgradeDamage;
                        this.radius = this.upgradeRadius;
                        break;
                    case 'bomb':
                        this.radius = this.upgradeRadius;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'toxic':
                        this.damage = this.upgradeDamage;
                        break;
                    case 'turret':
                        this.radius = this.upgradeRadius;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'empty':
                        this.damage = this.upgradeDamage;
                        this.radius = this.upgradeRadius;
                        this.slowPercent = this.upgradeSlowPercent;
                        break;
                }
                
                this.upgraded = true;
                return true;
            }
            
            update() {
                // –î–ª—è —Ñ–µ—Ä–º—ã - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ—Ö–æ–¥
                if (this.type === 'farm' || this.type === 'goodfarm') {
                    this.incomeTimer++;
                    if (this.incomeTimer >= this.incomeRate) {
                        this.incomeTimer = 0;
                        money += this.income;
                        updateStats();
                    }
                    return;
                }
                
                // –î–ª—è —Ç–æ–∫—Å–∏—á–Ω–æ–π –±–∞—à–Ω–∏ - —Å–æ–∑–¥–∞–µ–º –ª—É–∂–∏
                if (this.type === 'toxic') {
                    this.puddleTimer++;
                    if (this.puddleTimer >= this.puddleRate) {
                        this.puddleTimer = 0;
                        puddles.push(new Puddle(this.x, this.y, this.puddleDamage, this.puddleRadius, this.puddleDuration));
                    }
                    return;
                }
                
                // –î–ª—è –ø—É—Å—Ç–æ–π –±–∞—à–Ω–∏ - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∞—Ç–∞–∫–∞
                if (this.type === 'empty') {
                    this.specialTimer++;
                    if (this.specialTimer >= this.specialRate) {
                        this.specialTimer = 0;
                        if (Math.random() < this.specialChance) {
                            // –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω –≤—Å–µ–º –≤—Ä–∞–≥–∞–º –Ω–∞ –ø–æ–ª–µ
                            for (const enemy of enemies) {
                                enemy.takeDamage(this.specialDamage);
                            }
                        }
                    }
                }
                
                // –î–ª—è –∞—Ç–æ–º–Ω–æ–π –±–∞—à–Ω–∏ - –æ—Å–æ–±—ã–π —Ç–∏–ø –∞—Ç–∞–∫–∏
                if (this.type === 'atomic' && this.cooldown <= 0) {
                    // –ê—Ç–æ–º–Ω–∞—è –±–∞—à–Ω—è –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –≤—Å–µ–º –≤—Ä–∞–≥–∞–º –Ω–∞ –∫–∞—Ä—Ç–µ
                    for (const enemy of enemies) {
                        enemy.takeDamage(this.damage);
                    }
                    this.cooldown = this.fireRate;
                    return;
                }
                
                // –ù–∞—Ö–æ–¥–∏–º –≤—Ä–∞–≥–æ–≤ –≤ —Ä–∞–¥–∏—É—Å–µ
                let enemiesInRange = [];
                
                for (const enemy of enemies) {
                    const dx = enemy.x - this.x;
                    const dy = enemy.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (this.type === 'knight' || this.type === 'omega') {
                        if (distance < this.outerRadius) {
                            enemiesInRange.push(enemy);
                        }
                    } else if (this.type !== 'toxic') {
                        if (distance < this.radius) {
                            enemiesInRange.push(enemy);
                        }
                    }
                }
                
                if (enemiesInRange.length > 0) {
                    // –í—ã–±–∏—Ä–∞–µ–º —Ü–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                    let target;
                    if (this.targeting === 'first') {
                        // –ü–µ—Ä–≤–∞—è —Ü–µ–ª—å (–±–ª–∏–∂–∞–π—à–∞—è –∫ –∫–æ–Ω—Ü—É –ø—É—Ç–∏)
                        target = enemiesInRange[0];
                        for (const enemy of enemiesInRange) {
                            if (enemy.pathIndex > target.pathIndex) {
                                target = enemy;
                            }
                        }
                    } else {
                        // –°–ª—É—á–∞–π–Ω–∞—è —Ü–µ–ª—å
                        target = enemiesInRange[Math.floor(Math.random() * enemiesInRange.length)];
                    }
                    
                    // –°—Ç—Ä–µ–ª—å–±–∞ –ø–æ –≤—Ä–∞–≥—É
                    if ((this.type === 'knight' || this.type === 'omega') && target) {
                        const dx = target.x - this.x;
                        const dy = target.y - this.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞—Ç–∞–∫–∞
                        if (distance < this.innerRadius && this.cooldown <= 0) {
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.innerDamage,
                                speed: 8,
                                size: BULLET_SIZE,
                                color: this.innerColor,
                                instant: false
                            });
                            this.cooldown = this.innerFireRate;
                        }
                        
                        // –í–Ω–µ—à–Ω—è—è –∞—Ç–∞–∫–∞
                        if (distance >= this.innerRadius && this.outerCooldown <= 0) {
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.outerDamage,
                                speed: 5,
                                size: BULLET_SIZE,
                                color: this.color,
                                instant: false
                            });
                            this.outerCooldown = this.outerFireRate;
                        }
                    } else if (this.cooldown <= 0 && target) {
                        if (this.type === 'freezer') {
                            // –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—Ä–∞–≥–æ–≤
                            for (const enemy of enemiesInRange) {
                                enemy.slowDown(this.slowPercent);
                            }
                            
                            // –ò –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω —Ü–µ–ª–∏
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 5,
                                size: BULLET_SIZE,
                                color: 'lightblue',
                                instant: false
                            });
                        } else if (this.type === 'chance') {
                            // –ë–∞—à–Ω—è —à–∞–Ω—Å–∞ - —Å–ª—É—á–∞–π–Ω—ã–π —É—Ä–æ–Ω –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
                            const randomDamage = this.minDamage + Math.random() * (this.maxDamage - this.minDamage);
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: randomDamage,
                                speed: 6,
                                size: BULLET_SIZE,
                                color: 'magenta',
                                instant: false
                            });
                        } else if (this.type === 'sniper') {
                            // –°–Ω–∞–π–ø–µ—Ä - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø—É–ª–∏
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 1000, // –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è
                                size: BULLET_SIZE,
                                color: 'yellow',
                                instant: true
                            });
                        } else if (this.type === 'bomb') {
                            // –ë–æ–º–±–∞ - AoE —É—Ä–æ–Ω
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 5,
                                size: BULLET_SIZE * 1.5,
                                color: 'black',
                                instant: false,
                                aoe: true,
                                aoeRadius: this.radius / 2
                            });
                        } else if (this.type === 'empty') {
                            // –ü—É—Å—Ç–∞—è –±–∞—à–Ω—è - –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤ –≤ —Ä–∞–¥–∏—É—Å–µ
                            for (const enemy of enemiesInRange) {
                                enemy.slowDown(this.slowPercent);
                            }
                            
                            // –ò –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω —Ü–µ–ª–∏
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 5,
                                size: BULLET_SIZE,
                                color: 'purple',
                                instant: false
                            });
                        } else {
                            // –û–±—ã—á–Ω–∞—è –±–∞—à–Ω—è
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 5,
                                size: BULLET_SIZE,
                                color: this.type === 'pistol' ? 'cyan' : 
                                       this.type === 'swordsman' ? 'orange' : 
                                       this.type === 'doublepistol' ? 'lightblue' : 'yellow',
                                instant: false
                            });
                        }
                        this.cooldown = this.fireRate;
                    }
                }
                
                if (this.cooldown > 0) {
                    this.cooldown--;
                }
                
                if (this.outerCooldown > 0) {
                    this.outerCooldown--;
                }
            }
            
            draw() {
                // –†–∏—Å—É–µ–º –±–∞—à–Ω—é
                if (this.type === 'omega') {
                    // –û–ú–ï–ì–ê –±–∞—à–Ω—è —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0,
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, 'red');
                    gradient.addColorStop(0.2, 'orange');
                    gradient.addColorStop(0.4, 'yellow');
                    gradient.addColorStop(0.6, 'green');
                    gradient.addColorStop(0.8, 'blue');
                    gradient.addColorStop(1, 'violet');
                    
                    ctx.fillStyle = gradient;
                } else if (this.type === 'doublepistol') {
                    // –î–≤–æ–π–Ω—ã–π –ø–∏—Å—Ç–æ–ª–µ—Ç —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
                    const gradient = ctx.createLinearGradient(
                        this.x - this.size, this.y,
                        this.x + this.size, this.y
                    );
                    gradient.addColorStop(0, 'blue');
                    gradient.addColorStop(1, 'lightblue');
                    
                    ctx.fillStyle = gradient;
                } else {
                    ctx.fillStyle = this.color;
                }
                
                if (this.shape === 'circle') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.shape === 'diamond') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(45 * Math.PI / 180);
                    ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                    ctx.restore();
                } else if (this.shape === 'square') {
                    ctx.fillRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
                } else if (this.shape === 'pentagon') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    for (let i = 0; i < 5; i++) {
                        const angle = (i * 2 * Math.PI / 5) - Math.PI / 2;
                        const x = Math.cos(angle) * this.size;
                        const y = Math.sin(angle) * this.size;
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.fill();
                    
                    // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å
                    ctx.fillStyle = this.innerColor;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size/2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                } else if (this.shape === 'hexagon') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    for (let i = 0; i < 6; i++) {
                        const angle = (i * 2 * Math.PI / 6) - Math.PI / 2;
                        const x = Math.cos(angle) * this.size;
                        const y = Math.sin(angle) * this.size;
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                } else if (this.shape === 'octagon') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    for (let i = 0; i < 8; i++) {
                        const angle = (i * 2 * Math.PI / 8) - Math.PI / 2;
                        const x = Math.cos(angle) * this.size;
                        const y = Math.sin(angle) * this.size;
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                } else if (this.shape === 'triangle') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    ctx.moveTo(0, -this.size);
                    ctx.lineTo(-this.size, this.size);
                    ctx.lineTo(this.size, this.size);
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                } else if (this.shape === 'decagon') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    for (let i = 0; i < 10; i++) {
                        const angle = (i * 2 * Math.PI / 10) - Math.PI / 2;
                        const x = Math.cos(angle) * this.size;
                        const y = Math.sin(angle) * this.size;
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                }
                
                // –î–ª—è —Ñ–µ—Ä–º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–Ω–∞—á–æ–∫ –º–æ–Ω–µ—Ç—ã
                if (this.type === 'farm' || this.type === 'goodfarm') {
                    ctx.fillStyle = 'gold';
                    ctx.font = '12px Arial';
                    ctx.fillText('$', this.x - 4, this.y + 4);
                }
                
                // –î–ª—è –ø—É—Å—Ç–æ–π –±–∞—à–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞—É—Ä—É
                if (this.type === 'empty') {
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                // –†–∏—Å—É–µ–º —Ä–∞–¥–∏—É—Å (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
                if ((selectedTower === this || selectedTowerType === this.type) && showRadius) {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.setLineDash([5, 5]);
                    
                    if (this.type === 'knight' || this.type === 'omega') {
                        // –†–∏—Å—É–µ–º –¥–≤–∞ —Ä–∞–¥–∏—É—Å–∞ –¥–ª—è —Ä—ã—Ü–∞—Ä—è –∏ –û–ú–ï–ì–ò
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.innerRadius, 0, Math.PI * 2);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.outerRadius, 0, Math.PI * 2);
                        ctx.stroke();
                    } else if (this.type !== 'farm' && this.type !== 'goodfarm' && this.type !== 'toxic') {
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                    
                    ctx.setLineDash([]);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å —É–ª—É—á—à–µ–Ω–∏—è
                    if (this.upgraded) {
                        ctx.fillStyle = 'gold';
                        ctx.font = '10px Arial';
                        ctx.fillText('–£–ª.', this.x - 7, this.y + 4);
                    }
                }
            }
            
            getSellPrice() {
                const price = parseInt(document.querySelector(`.tower-item[data-type="${this.type}"]`).getAttribute('data-price'));
                let sellPrice = Math.floor(price * 0.5);
                
                if (this.upgraded) {
                    switch(this.type) {
                        case 'pistol': sellPrice += Math.floor(150 * 0.5); break;
                        case 'swordsman': sellPrice += Math.floor(300 * 0.5); break;
                        case 'sniper': sellPrice += Math.floor(1000 * 0.5); break;
                        case 'freezer': sellPrice += Math.floor(1250 * 0.5); break;
                        case 'knight': sellPrice += Math.floor(2500 * 0.5); break;
                        case 'farm': sellPrice += Math.floor(900 * 0.5); break;
                        case 'chance': sellPrice += Math.floor(7777 * 0.5); break;
                        case 'atomic': sellPrice += Math.floor(30000 * 0.5); break;
                        case 'omega': sellPrice += Math.floor(40000 * 0.5); break;
                        case 'doublepistol': sellPrice += Math.floor(150 * 0.5); break;
                        case 'bomb': sellPrice += Math.floor(650 * 0.5); break;
                        case 'toxic': sellPrice += Math.floor(2500 * 0.5); break;
                        case 'turret': sellPrice += Math.floor(5000 * 0.5); break;
                        case 'empty': sellPrice += Math.floor(17500 * 0.5); break;
                    }
                }
                
                return sellPrice;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('money').textContent = money;
            document.getElementById('lives').textContent = lives;
            document.getElementById('wave').textContent = wave;
            document.getElementById('diamonds').textContent = diamonds;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –≤—Ä–∞–≥–æ–≤
        function updateEnemyIndex() {
            for (const type in enemyKnowledge) {
                if (enemyKnowledge[type].discovered) {
                    const enemyElement = document.getElementById(`${type}-enemy`);
                    if (enemyElement) {
                        const statsElement = enemyElement.querySelector('.enemy-stats');
                        
                        let specialHtml = '';
                        if (type === 'boss' || type === 'blue' || type === 'sonic' || type === 'void') {
                            specialHtml = `<div>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å: ${enemyKnowledge[type].special}</div>`;
                        }
                        
                        statsElement.innerHTML = `
                            <div>–ó–¥–æ—Ä–æ–≤—å–µ: ${enemyKnowledge[type].health}</div>
                            <div>–°–∫–æ—Ä–æ—Å—Ç—å: ${enemyKnowledge[type].speed.toFixed(2)}</div>
                            ${specialHtml}
                        `;
                    }
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—á–∞–ª–∞ –≤–æ–ª–Ω—ã
        function startWave() {
            if (!gameActive || waveActive) return;
            
            wave++;
            waveActive = true;
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –∞–ª–º–∞–∑—ã –∑–∞ –≤–æ–ª–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            if (difficulty === "normal") {
                diamonds += 1;
                totalDiamonds += 1;
            } else if (difficulty === "hard") {
                diamonds += 2;
                totalDiamonds += 2;
            } else if (difficulty === "extreme") {
                diamonds += 3;
                totalDiamonds += 3;
            }
            
            // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –∫–∞–∂–¥—ã–µ 5 –≤–æ–ª–Ω
            if (wave % 5 === 0) {
                let reward = 0;
                if (difficulty === "normal") {
                    reward = 5 * waveRewardMultiplier;
                } else if (difficulty === "hard") {
                    reward = 10 * waveRewardMultiplier;
                } else if (difficulty === "extreme") {
                    reward = 15 * waveRewardMultiplier;
                }
                
                diamonds += reward;
                totalDiamonds += reward;
                waveRewardMultiplier *= 2; // –£–¥–≤–∞–∏–≤–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞–≥—Ä–∞–¥—ã
                
                alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø—Ä–æ—à–ª–∏ ${wave} –≤–æ–ª–Ω—É –∏ –ø–æ–ª—É—á–∞–µ—Ç–µ ${reward} –∞–ª–º–∞–∑–æ–≤!`);
            }
            
            document.getElementById('diamondTotal').textContent = totalDiamonds;
            updateStats();
            saveGameData();
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Ç–∏–ø –≤—Ä–∞–≥–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–ª–Ω—ã
            redCount = 2 + wave * 2; // +2 –∫—Ä–∞—Å–Ω—ã—Ö —Å –∫–∞–∂–¥–æ–π –≤–æ–ª–Ω–æ–π
            purpleCount = 0;
            goldenCount = 0;
            pinkCount = 0;
            greenCount = 0;
            whiteCount = 0;
            bossCount = 0;
            blueCount = 0;
            sonicCount = 0;
            voidCount = 0;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã—Ö –≤—Ä–∞–≥–æ–≤ –ø–æ—Å–ª–µ 5 –≤–æ–ª–Ω—ã
            if (wave >= 5) {
                purpleCount = Math.floor((wave - 5) / 2) + 1;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–æ–ª–æ—Ç—ã—Ö –≤—Ä–∞–≥–æ–≤ –ø–æ—Å–ª–µ 25 –≤–æ–ª–Ω—ã
            if (wave >= 25) {
                goldenCount = Math.floor((wave - 25) / 2) + 1;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–æ–∑–æ–≤—ã—Ö –≤—Ä–∞–≥–æ–≤ –ø–æ—Å–ª–µ 35 –≤–æ–ª–Ω—ã
            if (wave >= 35) {
                pinkCount = Math.floor((wave - 35) / 3) + 1;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–µ–ª–µ–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤ –ø–æ—Å–ª–µ 40 –≤–æ–ª–Ω—ã
            if (wave >= 40) {
                greenCount = Math.floor((wave - 40) / 3) + 1;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–µ–ª—ã—Ö –≤—Ä–∞–≥–æ–≤ –ø–æ—Å–ª–µ 70 –≤–æ–ª–Ω—ã
            if (wave >= 70) {
                whiteCount = Math.floor((wave - 70) / 5) + 1;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 50 –≤–æ–ª–Ω
            if (wave % 50 === 0) {
                bossCount = 1;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≥–æ–ª—É–±—ã—Ö –≤—Ä–∞–≥–æ–≤ –ø–æ—Å–ª–µ 55 –≤–æ–ª–Ω—ã
            if (wave >= 55) {
                blueCount = Math.floor((wave - 55) / 25) + 1;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–Ω–∏–∫ –≤—Ä–∞–≥–æ–≤ –ø–æ—Å–ª–µ 90 –≤–æ–ª–Ω—ã
            if (wave >= 90) {
                sonicCount = Math.floor((wave - 90) / 3) + 1;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ—Ç–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤ –ø–æ—Å–ª–µ 125 –≤–æ–ª–Ω—ã
            if (wave >= 125) {
                voidCount = Math.floor((wave - 125) / 25) + 1;
            }
            
            enemiesToSpawn = redCount + purpleCount + goldenCount + pinkCount + greenCount + whiteCount + 
                            bossCount + blueCount + sonicCount + voidCount;
            enemySpawnTimer = 30; // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –≤—Ä–∞–≥–æ–º
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–ø–∞–≤–Ω–∞ –≤—Ä–∞–≥–æ–≤
        function spawnEnemy() {
            if (enemiesToSpawn > 0 && enemySpawnTimer <= 0) {
                let enemy;
                
                if (voidCount > 0) {
                    enemy = new Enemy('void', 1000, ENEMY_BASE_SPEED / 3, ENEMY_SIZE * 1.5, 'purple');
                    voidCount--;
                } else if (sonicCount > 0) {
                    enemy = new Enemy('sonic', 10, ENEMY_BASE_SPEED * 10, ENEMY_SIZE, 'cyan');
                    sonicCount--;
                } else if (blueCount > 0) {
                    enemy = new Enemy('blue', 200, ENEMY_BASE_SPEED / 5, ENEMY_SIZE * 1.2, 'blue');
                    blueCount--;
                } else if (bossCount > 0) {
                    enemy = new Enemy('boss', 250 + (Math.floor(wave / 50) * 250), ENEMY_BASE_SPEED, ENEMY_SIZE * 2, 'black');
                    bossCount--;
                    
                    // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞—É—Ä—ã –±–æ—Å—Å–∞
                    bossAura = document.createElement('div');
                    bossAura.className = 'boss-aura';
                    bossAura.style.width = enemy.auraRadius * 2 + 'px';
                    bossAura.style.height = enemy.auraRadius * 2 + 'px';
                    document.body.appendChild(bossAura);
                } else if (whiteCount > 0) {
                    enemy = new Enemy('white', 120, ENEMY_BASE_SPEED, ENEMY_SIZE, 'white');
                    whiteCount--;
                } else if (greenCount > 0) {
                    enemy = new Enemy('green', 100, ENEMY_BASE_SPEED / 3.15675434, ENEMY_SIZE, 'green');
                    greenCount--;
                } else if (pinkCount > 0) {
                    enemy = new Enemy('pink', 11, ENEMY_BASE_SPEED * 5, ENEMY_SIZE, 'pink');
                    pinkCount--;
                } else if (goldenCount > 0) {
                    enemy = new Enemy('golden', 35, ENEMY_BASE_SPEED * 2, ENEMY_SIZE, 'gold');
                    goldenCount--;
                } else if (purpleCount > 0) {
                    enemy = new Enemy('purple', 15, ENEMY_BASE_SPEED * 0.5, ENEMY_SIZE, 'purple');
                    purpleCount--;
                } else {
                    enemy = new Enemy('red', 3 + Math.floor(wave / 3), ENEMY_BASE_SPEED, ENEMY_SIZE, 'red');
                    redCount--;
                }
                
                enemies.push(enemy);
                enemiesToSpawn--;
                enemySpawnTimer = 30; // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≤—Ä–∞–≥–∞–º–∏
            }
            
            if (enemySpawnTimer > 0) {
                enemySpawnTimer--;
            }
            
            // –ï—Å–ª–∏ –≤—Å–µ –≤—Ä–∞–≥–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –≤—Å–µ —É–±–∏—Ç—ã - –Ω–∞—á–∏–Ω–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –≤–æ–ª–Ω—É
            if (enemiesToSpawn === 0 && enemies.length === 0) {
                waveActive = false;
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –≤–æ–ª–Ω—É
                setTimeout(startWave, 2000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—É–ª—å
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                // –ï—Å–ª–∏ —Ü–µ–ª—å —É–∂–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞, —É–¥–∞–ª—è–µ–º –ø—É–ª—é
                if (!enemies.includes(bullet.target)) {
                    bullets.splice(i, 1);
                    continue;
                }
                
                // –î–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –ø—É–ª—å (—Å–Ω–∞–π–ø–µ—Ä) - —Å—Ä–∞–∑—É –Ω–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω
                if (bullet.instant) {
                    if (bullet.target.takeDamage(bullet.damage)) {
                        enemies.splice(enemies.indexOf(bullet.target), 1);
                    }
                    bullets.splice(i, 1);
                    continue;
                }
                
                // –î–ª—è AoE –ø—É–ª—å (–±–æ–º–±—ã) - –Ω–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω –≤—Å–µ–º –≤—Ä–∞–≥–∞–º –≤ —Ä–∞–¥–∏—É—Å–µ
                if (bullet.aoe && bullet.target) {
                    const dx = bullet.target.x - bullet.x;
                    const dy = bullet.target.y - bullet.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < bullet.speed) {
                        // –ü–æ–ø–∞–¥–∞–Ω–∏–µ –ø–æ –≤—Ä–∞–≥—É - –Ω–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω –≤—Å–µ–º –≤—Ä–∞–≥–∞–º –≤ —Ä–∞–¥–∏—É—Å–µ
                        for (const enemy of enemies) {
                            const enemyDx = enemy.x - bullet.target.x;
                            const enemyDy = enemy.y - bullet.target.y;
                            const enemyDistance = Math.sqrt(enemyDx * enemyDx + enemyDy * enemyDy);
                            
                            if (enemyDistance < bullet.aoeRadius) {
                                if (enemy.takeDamage(bullet.damage)) {
                                    enemies.splice(enemies.indexOf(enemy), 1);
                                }
                            }
                        }
                        bullets.splice(i, 1);
                        continue;
                    }
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –ø—É–ª–∏ –∫ —Ü–µ–ª–∏
                const dx = bullet.target.x - bullet.x;
                const dy = bullet.target.y - bullet.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < bullet.speed) {
                    // –ü–æ–ø–∞–¥–∞–Ω–∏–µ –ø–æ –≤—Ä–∞–≥—É
                    if (bullet.target.takeDamage(bullet.damage)) {
                        enemies.splice(enemies.indexOf(bullet.target), 1);
                    }
                    bullets.splice(i, 1);
                } else {
                    bullet.x += (dx / distance) * bullet.speed;
                    bullet.y += (dy / distance) * bullet.speed;
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª—É–∂
        function updatePuddles() {
            for (let i = puddles.length - 1; i >= 0; i--) {
                if (!puddles[i].update()) {
                    puddles.splice(i, 1);
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
        function gameOver() {
            gameActive = false;
            waveRewardMultiplier = 1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞–≥—Ä–∞–¥—ã
            document.getElementById('restartGame').style.display = 'block';
            document.getElementById('gameOverlay').style.display = 'block';
        }
        
        // –†–∏—Å—É–µ–º –ø—É—Ç—å (–∂–µ–ª—Ç–∞—è —Ç—Ä–æ–ø–∏–Ω–∫–∞)
        function drawPath() {
            ctx.strokeStyle = '#f1c40f'; // –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç
            ctx.lineWidth = 30;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(PATH[0].x, PATH[0].y);
            
            for (let i = 1; i < PATH.length; i++) {
                ctx.lineTo(PATH[i].x, PATH[i].y);
            }
            
            ctx.stroke();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É —Ç—Ä–æ–ø–∏–Ω–∫–∏
            ctx.strokeStyle = '#d35400';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 15]);
            ctx.beginPath();
            ctx.moveTo(PATH[0].x, PATH[0].y);
            
            for (let i = 1; i < PATH.length; i++) {
                ctx.lineTo(PATH[i].x, PATH[i].y);
            }
            
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —É–ª—É—á—à–µ–Ω–∏—è
        function showUpgradeMenu(tower, x, y) {
            const menu = document.getElementById('upgradeMenu');
            const upgradeInfo = document.getElementById('upgradeInfo');
            const upgradeBtn = document.getElementById('upgradeBtn');
            const sellBtn = document.getElementById('sellBtn');
            const targetingOptions = document.getElementById('targetingOptions');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏
            document.querySelector(`input[name="targeting"][value="${tower.targeting}"]`).checked = true;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
            targetingOptions.querySelectorAll('input[name="targeting"]').forEach(input => {
                input.onchange = () => {
                    tower.targeting = input.value;
                };
            });
            
            if (tower.upgraded) {
                upgradeInfo.innerHTML = '<p>–ë–∞—à–Ω—è —É–∂–µ —É–ª—É—á—à–µ–Ω–∞ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è</p>';
                upgradeBtn.disabled = true;
            } else {
                let upgradeText = '';
                
                switch(tower.type) {
                    case 'pistol':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.fireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'swordsman':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.fireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'sniper':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.fireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'freezer':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ: ${tower.slowPercent}%</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ: ${tower.upgradeSlowPercent}%</li>
                            </ul>
                        `;
                        break;
                    case 'knight':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–í–Ω—É—Ç—Ä. —É—Ä–æ–Ω: ${tower.innerDamage}</li>
                                <li>–í–Ω—É—Ç—Ä. —Ä–∞–¥–∏—É—Å: ${tower.innerRadius/ST_TO_PX}st</li>
                                <li>–í–Ω—É—Ç—Ä. —Å–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.innerFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                                <li>–í–Ω–µ—à. —É—Ä–æ–Ω: ${tower.outerDamage}</li>
                                <li>–í–Ω–µ—à. —Ä–∞–¥–∏—É—Å: ${tower.outerRadius/ST_TO_PX}st</li>
                                <li>–í–Ω–µ—à. —Å–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.outerFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–í–Ω—É—Ç—Ä. —É—Ä–æ–Ω: ${tower.upgradeInnerDamage}</li>
                                <li>–í–Ω—É—Ç—Ä. —Ä–∞–¥–∏—É—Å: ${tower.upgradeInnerRadius/ST_TO_PX}st</li>
                                <li>–í–Ω—É—Ç—Ä. —Å–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeInnerFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                                <li>–í–Ω–µ—à. —É—Ä–æ–Ω: ${tower.upgradeOuterDamage}</li>
                                <li>–í–Ω–µ—à. —Ä–∞–¥–∏—É—Å: ${tower.upgradeOuterRadius/ST_TO_PX}st</li>
                                <li>–í–Ω–µ—à. —Å–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeOuterFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'farm':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–î–æ—Ö–æ–¥: ${tower.income} –º–æ–Ω–µ—Ç–∞/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–î–æ—Ö–æ–¥: ${tower.upgradeIncome} –º–æ–Ω–µ—Ç—ã/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'chance':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.minDamage}-${tower.maxDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.fireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeMinDamage}-${tower.upgradeMaxDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'atomic':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${tower.fireRate/60} —Å–µ–∫/–≤—ã—Å—Ç—Ä–µ–ª</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${tower.upgradeFireRate/60} —Å–µ–∫/–≤—ã—Å—Ç—Ä–µ–ª</li>
                            </ul>
                        `;
                        break;
                    case 'omega':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–í–Ω—É—Ç—Ä. —É—Ä–æ–Ω: ${tower.innerDamage}</li>
                                <li>–í–Ω—É—Ç—Ä. —Ä–∞–¥–∏—É—Å: ${tower.innerRadius/ST_TO_PX}st</li>
                                <li>–í–Ω—É—Ç—Ä. —Å–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.innerFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                                <li>–í–Ω–µ—à. —É—Ä–æ–Ω: ${tower.outerDamage}</li>
                                <li>–í–Ω–µ—à. —Ä–∞–¥–∏—É—Å: ${tower.outerRadius/ST_TO_PX}st</li>
                                <li>–í–Ω–µ—à. —Å–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.outerFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–í–Ω—É—Ç—Ä. —É—Ä–æ–Ω: ${tower.upgradeInnerDamage}</li>
                                <li>–í–Ω—É—Ç—Ä. —Ä–∞–¥–∏—É—Å: ${tower.upgradeInnerRadius/ST_TO_PX}st</li>
                                <li>–í–Ω—É—Ç—Ä. —Å–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeInnerFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                                <li>–í–Ω–µ—à. —É—Ä–æ–Ω: ${tower.upgradeOuterDamage}</li>
                                <li>–í–Ω–µ—à. —Ä–∞–¥–∏—É—Å: ${tower.upgradeOuterRadius/ST_TO_PX}st</li>
                                <li>–í–Ω–µ—à. —Å–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeOuterFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'doublepistol':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.fireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'bomb':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.fireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'toxic':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}/0.1—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}/0.1—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'turret':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.fireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–°–∫–æ—Ä–æ—Å—Ç—å: ${60/tower.upgradeFireRate} –≤—ã—Å—Ç—Ä/—Å–µ–∫</li>
                            </ul>
                        `;
                        break;
                    case 'empty':
                        upgradeText = `
                            <p>–¢–µ–∫—É—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.damage}/—Å–µ–∫</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.radius/ST_TO_PX}st</li>
                                <li>–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ: ${tower.slowPercent}%</li>
                            </ul>
                            <p>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</p>
                            <ul>
                                <li>–£—Ä–æ–Ω: ${tower.upgradeDamage}/—Å–µ–∫</li>
                                <li>–†–∞–¥–∏—É—Å: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ: ${tower.upgradeSlowPercent}%</li>
                            </ul>
                        `;
                        break;
                }
                
                upgradeInfo.innerHTML = upgradeText + `<p>–°—Ç–æ–∏–º–æ—Å—Ç—å: ${tower.upgradeCost} –º–æ–Ω–µ—Ç</p>`;
                
                upgradeBtn.disabled = money < tower.upgradeCost;
                upgradeBtn.onclick = function() {
                    if (money >= tower.upgradeCost) {
                        money -= tower.upgradeCost;
                        tower.upgrade();
                        updateStats();
                        menu.style.display = 'none';
                    }
                };
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–¥–∞–∂–∏
            const sellPrice = tower.getSellPrice();
            sellBtn.textContent = `–ü—Ä–æ–¥–∞—Ç—å (${sellPrice} –º–æ–Ω–µ—Ç)`;
            sellBtn.onclick = function() {
                money += sellPrice;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∞—à–µ–Ω
                if (tower.type === 'farm') farmCount--;
                if (tower.type === 'atomic') atomicCount--;
                if (tower.type === 'omega') omegaCount--;
                if (tower.type === 'goodfarm') goodFarmCount--;
                if (tower.type === 'toxic') toxicCount--;
                if (tower.type === 'turret') turretCount--;
                if (tower.type === 'empty') emptyCount--;
                
                towers.splice(towers.indexOf(tower), 1);
                updateStats();
                menu.style.display = 'none';
                
                // –£–¥–∞–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–¥–∏—É—Å–∞, –µ—Å–ª–∏ –æ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
                if (rangeIndicator) {
                    document.body.removeChild(rangeIndicator);
                    rangeIndicator = null;
                }
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ–µ–≤—ã—Ö –±–∞—à–µ–Ω
            if (tower.type === 'farm' || tower.type === 'goodfarm' || tower.type === 'toxic') {
                targetingOptions.style.display = 'none';
            } else {
                targetingOptions.style.display = 'block';
            }
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –º–µ–Ω—é —Ä—è–¥–æ–º —Å –±–∞—à–Ω–µ–π
            const rect = menu.getBoundingClientRect();
            let left = x + 20;
            let top = y - 150;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –º–µ–Ω—é –Ω–µ –≤—ã—Ö–æ–¥–∏–ª–æ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞
            if (left + rect.width > window.innerWidth) {
                left = x - rect.width - 20;
            }
            
            if (top + rect.height > window.innerHeight) {
                top = window.innerHeight - rect.height - 20;
            }
            
            if (top < 20) {
                top = 20;
            }
            
            menu.style.left = left + 'px';
            menu.style.top = top + 'px';
            menu.style.display = 'block';
        }
        
        // –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–¥–∏—É—Å–∞
        function createRangeIndicator(radius) {
            if (rangeIndicator) {
                document.body.removeChild(rangeIndicator);
            }
            
            rangeIndicator = document.createElement('div');
            rangeIndicator.className = 'range-indicator';
            rangeIndicator.style.width = radius * 2 + 'px';
            rangeIndicator.style.height = radius * 2 + 'px';
            document.body.appendChild(rangeIndicator);
            
            return rangeIndicator;
        }
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameActive) return;
            
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –ø—É—Ç—å
            drawPath();
            
            // –†–∏—Å—É–µ–º –ª—É–∂–∏
            for (const puddle of puddles) {
                puddle.draw();
            }
            
            // –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤
            spawnEnemy();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
            for (let i = enemies.length - 1; i >= 0; i--) {
                if (!enemies[i].update()) {
                    enemies.splice(i, 1);
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞—à–µ–Ω
            for (const tower of towers) {
                tower.update();
                tower.draw();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å
            updateBullets();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª—É–∂
            updatePuddles();
            
            // –†–∏—Å—É–µ–º –ø—É–ª–∏
            for (const bullet of bullets) {
                ctx.fillStyle = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // –†–∏—Å—É–µ–º –≤—Ä–∞–≥–æ–≤
            for (const enemy of enemies) {
                enemy.draw();
            }
            
            // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–π –≤–æ–ª–Ω—ã
            if (wave === 0 && !waveActive) {
                startWave();
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ canvas
        canvas.addEventListener('click', (e) => {
            if (!gameActive) return;
            
            const mousePos = getMousePos(canvas, e);
            const x = mousePos.x;
            const y = mousePos.y;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é —É–ª—É—á—à–µ–Ω–∏–π –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –±–∞—à–Ω–∏
            let clickedOnTower = false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞—à–Ω–µ
            for (const tower of towers) {
                const dx = tower.x - x;
                const dy = tower.y - y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < tower.size) {
                    clickedOnTower = true;
                    selectedTower = tower;
                    selectedTowerType = null;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é —É–ª—É—á—à–µ–Ω–∏—è
                    showUpgradeMenu(tower, e.clientX, e.clientY);
                    
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–æ–∫ –º–∞–≥–∞–∑–∏–Ω–∞
                    document.querySelectorAll('.tower-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // –£–¥–∞–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–¥–∏—É—Å–∞
                    if (rangeIndicator) {
                        document.body.removeChild(rangeIndicator);
                        rangeIndicator = null;
                    }
                    
                    break;
                }
            }
            
            // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–µ –ø–æ –±–∞—à–Ω–µ, —Å–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é —É–ª—É—á—à–µ–Ω–∏–π
            if (!clickedOnTower) {
                document.getElementById('upgradeMenu').style.display = 'none';
                
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –±–∞—à–Ω—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏
                if (selectedTowerType) {
                    const price = parseInt(document.querySelector(`.tower-item[data-type="${selectedTowerType}"]`).getAttribute('data-price'));
                    
                    if (money >= price) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –±–∞—à–µ–Ω
                        if (selectedTowerType === 'farm' && farmCount >= 5) {
                            alert('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ñ–µ—Ä–º (5)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'atomic' && atomicCount >= 2) {
                            alert('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∞—Ç–æ–º–Ω—ã—Ö –±–∞—à–µ–Ω (2)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'omega' && omegaCount >= 2) {
                            alert('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –û–ú–ï–ì–ê –±–∞—à–µ–Ω (2)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'goodfarm' && goodFarmCount >= 2) {
                            alert('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ö–æ—Ä–æ—à–∏—Ö —Ñ–µ—Ä–º (2)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'toxic' && toxicCount >= 3) {
                            alert('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ç–æ–∫—Å–∏—á–Ω—ã—Ö –±–∞—à–µ–Ω (3)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'turret' && turretCount >= 8) {
                            alert('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ç—É—Ä–µ–ª–µ–π (8)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'empty') {
                            const limit = (difficulty === "extreme") ? 2 : 1;
                            if (emptyCount >= limit) {
                                alert(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—É—Å—Ç—ã—Ö –±–∞—à–µ–Ω (${limit})!`);
                                return;
                            }
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ –∑–¥–µ—Å—å —É–∂–µ –±–∞—à–Ω–∏
                        let canPlace = true;
                        for (const tower of towers) {
                            const dx = tower.x - x;
                            const dy = tower.y - y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < TOWER_SIZE * 2) {
                                canPlace = false;
                                break;
                            }
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞ –ø—É—Ç–∏ –ª–∏ –±–∞—à–Ω—è –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –¥–∞–ª–µ–∫–æ –æ—Ç –ø—É—Ç–∏
                        const onPath = isOnPath(x, y);
                        
                        if (canPlace && !onPath) {
                            towers.push(new Tower(x, y, selectedTowerType));
                            money -= price;
                            updateStats();
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∞—à–µ–Ω
                            if (selectedTowerType === 'farm') farmCount++;
                            if (selectedTowerType === 'atomic') atomicCount++;
                            if (selectedTowerType === 'omega') omegaCount++;
                            if (selectedTowerType === 'goodfarm') goodFarmCount++;
                            if (selectedTowerType === 'toxic') toxicCount++;
                            if (selectedTowerType === 'turret') turretCount++;
                            if (selectedTowerType === 'empty') emptyCount++;
                            
                            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∏
                            document.querySelectorAll('.tower-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                            
                            // –£–¥–∞–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–¥–∏—É—Å–∞
                            if (rangeIndicator) {
                                document.body.removeChild(rangeIndicator);
                                rangeIndicator = null;
                            }
                            
                            selectedTowerType = null;
                        }
                    } else {
                        alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
                    }
                }
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–æ—á–∫–∞ –Ω–∞ –ø—É—Ç–∏
        function isOnPath(x, y) {
            for (let i = 0; i < PATH.length - 1; i++) {
                const p1 = PATH[i];
                const p2 = PATH[i + 1];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–æ—á–∫–∞ —Ä—è–¥–æ–º —Å –æ—Ç—Ä–µ–∑–∫–æ–º –ø—É—Ç–∏
                const dist = pointToLineDistance(x, y, p1.x, p1.y, p2.x, p2.y);
                if (dist < 25) { // –®–∏—Ä–∏–Ω–∞ –ø—É—Ç–∏ + –∑–∞–ø–∞—Å
                    return true;
                }
            }
            return false;
        }
        
        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç —Ç–æ—á–∫–∏ –¥–æ –æ—Ç—Ä–µ–∑–∫–∞
        function pointToLineDistance(px, py, x1, y1, x2, y2) {
            const A = px - x1;
            const B = py - y1;
            const C = x2 - x1;
            const D = y2 - y1;
            
            const dot = A * C + B * D;
            const len_sq = C * C + D * D;
            let param = -1;
            
            if (len_sq !== 0) {
                param = dot / len_sq;
            }
            
            let xx, yy;
            
            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }
            
            const dx = px - xx;
            const dy = py - yy;
            
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –±–∞—à–Ω–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        document.querySelectorAll('.tower-item').forEach(item => {
            item.addEventListener('click', function() {
                selectedTowerType = this.getAttribute('data-type');
                selectedTower = null;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é —É–ª—É—á—à–µ–Ω–∏–π
                document.getElementById('upgradeMenu').style.display = 'none';
                
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –±–∞—à–Ω—é
                document.querySelectorAll('.tower-item').forEach(i => {
                    i.classList.remove('selected');
                });
                this.classList.add('selected');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–¥–∏—É—Å–∞ (–∫—Ä–æ–º–µ —Ñ–µ—Ä–º—ã)
                if (selectedTowerType !== 'farm' && selectedTowerType !== 'goodfarm' && selectedTowerType !== 'toxic') {
                    let radius;
                    switch(selectedTowerType) {
                        case 'pistol': radius = 10 * ST_TO_PX; break;
                        case 'swordsman': radius = 4 * ST_TO_PX; break;
                        case 'sniper': radius = 100 * ST_TO_PX; break;
                        case 'freezer': radius = 25 * ST_TO_PX; break;
                        case 'knight': radius = 28 * ST_TO_PX; break;
                        case 'chance': radius = 17 * ST_TO_PX; break;
                        case 'atomic': radius = 100 * ST_TO_PX; break;
                        case 'omega': radius = 30 * ST_TO_PX; break;
                        case 'doublepistol': radius = 10 * ST_TO_PX; break;
                        case 'bomb': radius = 8 * ST_TO_PX; break;
                        case 'turret': radius = 15 * ST_TO_PX; break;
                        case 'empty': radius = 10 * ST_TO_PX; break;
                    }
                    
                    createRangeIndicator(radius);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –º—ã—à–∏
                    const moveHandler = (e) => {
                        rangeIndicator.style.left = e.clientX + 'px';
                        rangeIndicator.style.top = e.clientY + 'px';
                    };
                    
                    document.addEventListener('mousemove', moveHandler);
                    
                    // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –¥—Ä—É–≥–æ–π –±–∞—à–Ω–∏ –∏–ª–∏ –æ—Ç–º–µ–Ω–µ –≤—ã–±–æ—Ä–∞
                    const clearHandler = () => {
                        document.removeEventListener('mousemove', moveHandler);
                        document.removeEventListener('click', clearHandler);
                    };
                    
                    document.addEventListener('click', clearHandler, { once: true });
                }
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–¥–∏—É—Å–∞
        document.getElementById('toggleRadius').addEventListener('click', function() {
            showRadius = !showRadius;
            this.textContent = showRadius ? '–°–∫—Ä—ã—Ç—å —Ä–∞–¥–∏—É—Å' : '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–¥–∏—É—Å';
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –≤—Ä–∞–≥–æ–≤
        document.getElementById('toggleIndex').addEventListener('click', function() {
            const index = document.getElementById('enemyIndex');
            if (index.style.display === 'block') {
                index.style.display = 'none';
                this.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å';
            } else {
                index.style.display = 'block';
                this.textContent = '–°–∫—Ä—ã—Ç—å –∏–Ω–¥–µ–∫—Å';
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
        document.getElementById('restartGame').addEventListener('click', function() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('setupScreen').style.display = 'flex';
            this.style.display = 'none';
            document.getElementById('gameOverlay').style.display = 'none';
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        document.querySelectorAll('.difficulty-options .option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-options .option-btn').forEach(b => {
                    b.classList.remove('selected');
                });
                this.classList.add('selected');
                difficulty = this.getAttribute('data-difficulty');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∂–∏–∑–Ω–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                if (difficulty === "extreme") {
                    lives = 1;
                } else {
                    lives = 20;
                }
                updateStats();
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–∞—Ä—Ç—ã
        document.querySelectorAll('.map-options .option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.map-options .option-btn').forEach(b => {
                    b.classList.remove('selected');
                });
                this.classList.add('selected');
                mapType = this.getAttribute('data-map');
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
        document.getElementById('startGame').addEventListener('click', function() {
            // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('setupScreen').style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä—É
            money = 200;
            lives = (difficulty === "extreme") ? 1 : 20;
            wave = 0;
            diamonds = 0;
            enemies = [];
            towers = [];
            bullets = [];
            puddles = [];
            selectedTowerType = null;
            selectedTower = null;
            gameActive = true;
            waveActive = false;
            enemiesToSpawn = 0;
            farmCount = 0;
            atomicCount = 0;
            omegaCount = 0;
            goodFarmCount = 0;
            toxicCount = 0;
            turretCount = 0;
            emptyCount = 0;
            waveRewardMultiplier = 1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞–≥—Ä–∞–¥—ã
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã
            setPath();
            
            // –°–±—Ä–æ—Å –∑–Ω–∞–Ω–∏–π –æ –≤—Ä–∞–≥–∞—Ö
            for (const type in enemyKnowledge) {
                enemyKnowledge[type].discovered = false;
            }
            updateEnemyIndex();
            
            // –£–¥–∞–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–¥–∏—É—Å–∞
            if (rangeIndicator) {
                document.body.removeChild(rangeIndicator);
                rangeIndicator = null;
            }
            
            // –£–¥–∞–ª—è–µ–º –∞—É—Ä—É –±–æ—Å—Å–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (bossAura) {
                document.body.removeChild(bossAura);
                bossAura = null;
            }
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tower-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            updateStats();
            gameLoop();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        document.getElementById('diamondShopBtn').addEventListener('click', function() {
            document.getElementById('shopScreen').style.display = 'flex';
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        document.getElementById('closeShop').addEventListener('click', function() {
            document.getElementById('shopScreen').style.display = 'none';
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        document.querySelectorAll('.shop-category').forEach(category => {
            category.addEventListener('click', function() {
                document.querySelectorAll('.shop-category').forEach(c => {
                    c.classList.remove('active');
                });
                this.classList.add('active');
                
                const categoryName = this.getAttribute('data-category');
                document.querySelectorAll('.shop-item').forEach(item => {
                    if (item.getAttribute('data-category') === categoryName) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∫—É–ø–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        document.getElementById('buyExtremeBtn').addEventListener('click', function() {
            const price = parseInt(this.getAttribute('data-price'));
            
            if (totalDiamonds >= price) {
                totalDiamonds -= price;
                document.getElementById('diamondTotal').textContent = totalDiamonds;
                this.disabled = true;
                this.textContent = '–ö—É–ø–ª–µ–Ω–æ';
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
                document.getElementById('extremeDifficultyBtn').classList.remove('option-btn');
                document.getElementById('extremeDifficultyBtn').classList.add('option-btn');
                
                saveGameData();
                alert('–†–µ–∂–∏–º –≠–∫—Å—Ç—Ä–∏–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∫—É–ø–∫–∏ –∫–∞—Ä—Ç—ã
        document.getElementById('buyMountainsBtn').addEventListener('click', function() {
            const price = parseInt(this.getAttribute('data-price'));
            
            if (totalDiamonds >= price) {
                totalDiamonds -= price;
                document.getElementById('diamondTotal').textContent = totalDiamonds;
                this.disabled = true;
                this.textContent = '–ö—É–ø–ª–µ–Ω–æ';
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
                document.getElementById('mountainsMapBtn').classList.remove('option-btn');
                document.getElementById('mountainsMapBtn').classList.add('option-btn');
                
                saveGameData();
                alert('–ö–∞—Ä—Ç–∞ –ì–æ—Ä–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞!');
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–µ–π—Å–µ
        document.querySelectorAll('.case-info-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const content = this.nextElementSibling;
                if (content.style.display === 'block') {
                    content.style.display = 'none';
                } else {
                    content.style.display = 'block';
                }
            });
        });
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
        function openCase(caseType, price) {
            if (totalDiamonds >= price) {
                totalDiamonds -= price;
                document.getElementById('diamondTotal').textContent = totalDiamonds;
                
                let random = Math.random() * 100;
                let towerType = '';
                
                if (caseType === 'normal') {
                    // –û–±—ã—á–Ω—ã–π –∫–µ–π—Å
                    if (random < 45) {
                        towerType = 'doublepistol';
                    } else if (random < 75) {
                        towerType = 'bomb';
                    } else if (random < 95) {
                        towerType = 'goodfarm';
                    } else if (random < 99) {
                        towerType = 'toxic';
                    } else if (random < 99.6) {
                        towerType = 'turret';
                    } else {
                        towerType = 'empty';
                    }
                } else {
                    // –ü—Ä–µ–º–∏—É–º –∫–µ–π—Å
                    if (random < 40) {
                        towerType = 'bomb';
                    } else if (random < 65) {
                        towerType = 'goodfarm';
                    } else if (random < 85) {
                        towerType = 'toxic';
                    } else if (random < 97.5) {
                        towerType = 'turret';
                    } else {
                        towerType = 'empty';
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è –±–∞—à–Ω—è
                if (ownedTowers.includes(towerType)) {
                    // –ï—Å–ª–∏ –±–∞—à–Ω—è —É–∂–µ –µ—Å—Ç—å, –¥–∞–µ–º 35 –∞–ª–º–∞–∑–æ–≤
                    totalDiamonds += 35;
                    document.getElementById('diamondTotal').textContent = totalDiamonds;
                    saveGameData();
                    alert(`–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å ${getTowerName(towerType)}! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 35 –∞–ª–º–∞–∑–æ–≤ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏.`);
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –±–∞—à–Ω—é –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö
                    ownedTowers.push(towerType);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞—à–Ω—é –≤ –º–∞–≥–∞–∑–∏–Ω–µ
                    document.getElementById(`${towerType}Tower`).style.display = 'flex';
                    
                    saveGameData();
                    alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏: ${getTowerName(towerType)}`);
                }
            } else {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–±—ã—á–Ω–æ–≥–æ –∫–µ–π—Å–∞
        document.getElementById('openNormalCaseBtn').addEventListener('click', function() {
            const price = parseInt(this.getAttribute('data-price'));
            openCase('normal', price);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–º–∏—É–º –∫–µ–π—Å–∞
        document.getElementById('openPremiumCaseBtn').addEventListener('click', function() {
            const price = parseInt(this.getAttribute('data-price'));
            openCase('premium', price);
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setPath(); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        loadGameData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        updateStats();
        updateEnemyIndex();
    </script>
</body>
</html>
