<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Defense Game</title>
    <style>
      * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Arial', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #2c3e50;
    padding: 20px;
    color: #ecf0f1;
    min-height: 100vh;
    overflow-x: hidden;
}

h1 {
    color: #f1c40f;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    margin-bottom: 20px;
    text-align: center;
}

.game-container {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    position: relative;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 1400px;
}

#gameCanvas {
    background-color: #27ae60;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    width: 800px;
    height: 500px;
}

.shop {
    background-color: #34495e;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    padding: 15px;
    width: 280px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    max-height: 500px;
    overflow-y: auto;
}

.shop h2 {
    margin-top: 0;
    text-align: center;
    color: #f1c40f;
    border-bottom: 2px solid #f1c40f;
    padding-bottom: 10px;
    position: sticky;
    top: 0;
    background-color: #34495e;
    z-index: 1;
}

.tower-item {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s;
    background-color: #2c3e50;
}

.tower-item:hover {
    background-color: #3d566e;
    transform: translateY(-2px);
}

.tower-preview {
    width: 24px;
    height: 24px;
    margin-right: 10px;
    border: 1px solid #777;
    flex-shrink: 0;
}

.tower-info {
    flex-grow: 1;
    min-width: 0;
}

.tower-name {
    font-weight: bold;
    color: #f1c40f;
}

.tower-stats {
    font-size: 0.8em;
    color: #bdc3c7;
}

.tower-price {
    font-weight: bold;
    color: #2ecc71;
    background-color: rgba(0, 0, 0, 0.3);
    padding: 3px 6px;
    border-radius: 4px;
    flex-shrink: 0;
    margin-left: 5px;
}

.info-panel {
    display: flex;
    justify-content: space-between;
    width: 100%;
    max-width: 1400px;
    margin-bottom: 15px;
    background-color: #34495e;
    padding: 10px 20px;
    border-radius: 8px;
    border: 2px solid #f1c40f;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}

.stats {
    font-weight: bold;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.stats span {
    color: #f1c40f;
}

.controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

button {
    padding: 8px 15px;
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s;
    white-space: nowrap;
}

button:hover {
    background-color: #c0392b;
}

#toggleRadius {
    background-color: #3498db;
}

#toggleRadius:hover {
    background-color: #2980b9;
}

#toggleIndex {
    background-color: #9b59b6;
}

#toggleIndex:hover {
    background-color: #8e44ad;
}

#restartGame {
    display: none;
    background-color: #e74c3c;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 15px 30px;
    font-size: 1.2em;
    z-index: 100;
}

.game-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 99;
}

.upgrade-option {
    margin-top: 5px;
    padding-top: 5px;
    border-top: 1px dashed #555;
    font-size: 0.8em;
    color: #e67e22;
}

.selected {
    box-shadow: 0 0 10px #f1c40f;
    border-color: #f1c40f;
}

.upgrade-menu {
    display: none;
    position: fixed;
    background-color: #34495e;
    border: 2px solid #f1c40f;
    border-radius: 8px;
    padding: 15px;
    width: 300px;
    z-index: 10;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    max-height: 80vh;
    overflow-y: auto;
}

.upgrade-menu h3 {
    margin-top: 0;
    color: #f1c40f;
    border-bottom: 1px solid #f1c40f;
    padding-bottom: 5px;
}

.upgrade-btn {
    width: 100%;
    margin-top: 10px;
    padding: 8px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.upgrade-btn:hover {
    background-color: #27ae60;
}

.upgrade-btn:disabled {
    background-color: #7f8c8d;
    cursor: not-allowed;
}

.sell-btn {
    width: 100%;
    margin-top: 10px;
    padding: 8px;
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.sell-btn:hover {
    background-color: #c0392b;
}

.range-indicator {
    position: absolute;
    pointer-events: none;
    border: 2px dashed rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 5;
}

.enemy-index {
    background-color: #34495e;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    padding: 15px;
    width: 280px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    max-height: 500px;
    overflow-y: auto;
    display: none;
}

.enemy-index h2 {
    margin-top: 0;
    text-align: center;
    color: #f1c40f;
    border-bottom: 2px solid #f1c40f;
    padding-bottom: 10px;
    position: sticky;
    top: 0;
    background-color: #34495e;
    z-index: 1;
}

.enemy-item {
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 5px;
    background-color: #2c3e50;
}

.enemy-name {
    font-weight: bold;
    color: #f1c40f;
    margin-bottom: 5px;
}

.enemy-stats {
    font-size: 0.8em;
    color: #bdc3c7;
}

.unknown {
    color: #7f8c8d;
    font-style: italic;
}

.targeting-options {
    margin-top: 10px;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.targeting-options label {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9em;
}

.setup-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 200;
}

.setup-container {
    background-color: #34495e;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    padding: 30px;
    width: 500px;
    max-width: 90%;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
}

.setup-container h2 {
    text-align: center;
    color: #f1c40f;
    margin-bottom: 20px;
}

.difficulty-options, .map-options {
    margin-bottom: 25px;
}

.difficulty-options h3, .map-options h3 {
    color: #f1c40f;
    margin-bottom: 10px;
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
}

.option-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.option-btn {
    padding: 10px 15px;
    background-color: #2c3e50;
    color: #ecf0f1;
    border: 2px solid #555;
    border-radius: 5px;
    cursor: pointer;
    flex-grow: 1;
    text-align: center;
    transition: all 0.2s;
}

.option-btn:hover {
    background-color: #3d566e;
    border-color: #f1c40f;
}

.option-btn.selected {
    background-color: #f1c40f;
    color: #2c3e50;
    border-color: #f1c40f;
}

.start-btn {
    padding: 12px 25px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: bold;
    width: 100%;
    transition: background-color 0.2s;
}

.start-btn:hover {
    background-color: #27ae60;
}

.boss-aura {
    position: absolute;
    pointer-events: none;
    border: 2px dashed rgba(255, 0, 0, 0.7);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    z-index: 4;
}

.diamond-shop-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 10px 15px;
    background: linear-gradient(45deg, #2196F3, #21CBF3);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    z-index: 201;
    box-shadow: 0 0 10px rgba(33, 150, 243, 0.7);
}

.diamond-count {
    position: absolute;
    top: 20px;
    left: 20px;
    padding: 10px 15px;
    background-color: #34495e;
    color: #21CBF3;
    border: 2px solid #21CBF3;
    border-radius: 5px;
    font-weight: bold;
    z-index: 201;
    display: flex;
    align-items: center;
    gap: 5px;
}

.diamond-icon {
    color: #21CBF3;
    font-size: 1.2em;
}

.shop-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.95);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 300;
}

.shop-container {
    background-color: #34495e;
    border: 3px solid #f1c40f;
    border-radius: 8px;
    padding: 30px;
    width: 800px;
    max-width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
}

.shop-container h2 {
    text-align: center;
    color: #f1c40f;
    margin-bottom: 20px;
}

.shop-categories {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.shop-category {
    padding: 10px 15px;
    background-color: #2c3e50;
    color: #ecf0f1;
    border: 2px solid #555;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s;
}

.shop-category:hover, .shop-category.active {
    background-color: #f1c40f;
    color: #2c3e50;
    border-color: #f1c40f;
}

.shop-items {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
}

.shop-item {
    background-color: #2c3e50;
    border: 1px solid #555;
    border-radius: 5px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.shop-item h3 {
    color: #f1c40f;
    border-bottom: 1px solid #555;
    padding-bottom: 5px;
}

.shop-item p {
    font-size: 0.9em;
    color: #bdc3c7;
}

.shop-item-price {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
}

.shop-item-btn {
    padding: 8px 15px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}

.shop-item-btn:disabled {
    background-color: #7f8c8d;
    cursor: not-allowed;
}

.case-content {
    display: none;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px dashed #555;
}

.case-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    padding: 5px;
    border-radius: 4px;
    background-color: rgba(255, 255, 255, 0.1);
}

.case-item-chance {
    margin-left: auto;
    background-color: #9b59b6;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.8em;
}

.close-shop {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    color: #e74c3c;
    font-size: 2em;
    cursor: pointer;
}

.inventory-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 5px;
    margin-bottom: 10px;
    background-color: #2c3e50;
}

.inventory-preview {
    width: 20px;
    height: 20px;
    border: 1px solid #777;
}

@media (max-width: 1400px) {
    .game-container {
        flex-direction: column;
        align-items: center;
    }
    
    #gameCanvas {
        width: 100%;
        max-width: 800px;
        height: 400px;
    }
    
    .shop, .enemy-index {
        width: 100%;
        max-width: 800px;
    }
}

@media (max-width: 900px) {
    .info-panel {
        flex-direction: column;
        gap: 10px;
    }
    
    .stats, .controls {
        justify-content: center;
    }
    
    #gameCanvas {
        height: 350px;
    }
    
    .shop-items {
        grid-template-columns: 1fr;
    }
}

/* Р”РѕР±Р°РІР»СЏРµРј СЃС‚РёР»СЊ РґР»СЏ РєРЅРѕРїРєРё РёРЅС„РѕСЂРјР°С†РёРё Рѕ РєРµР№СЃРµ */
.case-info-btn {
    padding: 5px 10px;
    background-color: #9b59b6;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-bottom: 10px;
    font-size: 0.9em;
}

.case-info-btn:hover {
    background-color: #8e44ad;
}

.case-info-content {
    display: none;
    margin-top: 10px;
    padding: 10px;
    background-color: #2c3e50;
    border-radius: 5px;
    border: 1px solid #555;
}
        
        /* Р”РѕР±Р°РІР»СЏРµРј СЃС‚РёР»СЊ РґР»СЏ РєРЅРѕРїРєРё РёРЅС„РѕСЂРјР°С†РёРё Рѕ РєРµР№СЃРµ */
        .case-info-btn {
            padding: 5px 10px;
            background-color: #9b59b6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        .case-info-btn:hover {
            background-color: #8e44ad;
        }
        
        .case-info-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #2c3e50;
            border-radius: 5px;
            border: 1px solid #555;
        }
        /* РЎС‚РёР»Рё РґР»СЏ СЃРїРµС†РёР°Р»СЊРЅС‹С… Р±Р°С€РµРЅ РёР· РєРµР№СЃРѕРІ */
#doublePistolTower,
#bombTower,
#goodFarmTower,
#toxicTower,
#turretTower,
#emptyTower {
    display: flex !important;
}

/* РЎС‚РёР»Рё РґР»СЏ РїСЂРµРІСЊСЋ Р±Р°С€РµРЅ */
.tower-preview[style*="linear-gradient(to right, blue, lightblue)"] {
    background: linear-gradient(to right, blue, lightblue) !important;
    border-radius: 50% !important;
}

.tower-preview[style*="background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%)"] {
    background-color: black !important;
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%) !important;
}

.tower-preview[style*="background-color: gold"] {
    background-color: gold !important;
}

.tower-preview[style*="background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%)"] {
    background-color: green !important;
    clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%) !important;
}

.tower-preview[style*="background-color: gray"] {
    background-color: gray !important;
}

.tower-preview[style*="linear-gradient(to right, purple, black)"] {
    background: linear-gradient(to right, purple, black) !important;
}

/* РЈР±РµРґРёРјСЃСЏ, С‡С‚Рѕ РІСЃРµ Р±Р°С€РЅРё РІРёРґРЅС‹ РІ РјР°РіР°Р·РёРЅРµ */
.tower-item {
    display: flex !important;
    opacity: 1 !important;
    visibility: visible !important;
}
       /* РџРѕРєР°Р·С‹РІР°РµРј РІСЃРµ Р±Р°С€РЅРё РІ РјР°РіР°Р·РёРЅРµ */
.tower-item {
    display: flex !important;
}

/* РџРѕРєР°Р·С‹РІР°РµРј РІСЃСЋ РёРЅС„РѕСЂРјР°С†РёСЋ РІ РёРЅРґРµРєСЃРµ РІСЂР°РіРѕРІ */
.enemy-stats .unknown {
    color: #bdc3c7 !important;
    font-style: normal !important;
}
.enemy-stats .unknown:after {
    content: " (Р”Р°РЅРЅС‹Рµ РїРѕСЏРІСЏС‚СЃСЏ РїРѕСЃР»Рµ РІСЃС‚СЂРµС‡Рё)" !important;
} 
        
    </style>
</head>
<body>
    <div class="setup-screen" id="setupScreen">
        <div class="setup-container">
            <h2>РќР°СЃС‚СЂРѕР№РєР° РёРіСЂС‹</h2>
            
            <div class="diamond-count" id="diamondCount">
                <span class="diamond-icon">рџ’Ћ</span>
                <span id="diamondTotal">0</span>
            </div>
            
            <button class="diamond-shop-btn" id="diamondShopBtn">РњР°РіР°Р·РёРЅ</button>
            
            <div class="difficulty-options">
                <h3>Р’С‹Р±РµСЂРёС‚Рµ СЃР»РѕР¶РЅРѕСЃС‚СЊ:</h3>
                <div class="option-group">
                    <div class="option-btn selected" data-difficulty="normal">РљР»Р°СЃСЃРёРєР°</div>
                    <div class="option-btn" data-difficulty="hard">РЎР»РѕР¶РЅС‹Р№ СЂРµР¶РёРј</div>
                    <div class="option-btn" data-difficulty="extreme" id="extremeDifficultyBtn">Р­РєСЃС‚СЂРёРј</div>
                </div>
            </div>
            
            <div class="map-options">
                <h3>Р’С‹Р±РµСЂРёС‚Рµ РєР°СЂС‚Сѓ:</h3>
                <div class="option-group">
                    <div class="option-btn selected" data-map="hills">РҐРѕР»РјС‹</div>
                    <div class="option-btn" data-map="flat">Р РѕРІРЅР°СЏ РґРѕСЂРѕРіР°</div>
                    <div class="option-btn" data-map="mountains" id="mountainsMapBtn">Р“РѕСЂРєРё</div>
                </div>
            </div>
            
            <!-- РЈР±РёСЂР°РµРј СЃРµРєС†РёСЋ РёРЅРІРµРЅС‚Р°СЂСЏ -->
            
            <button class="start-btn" id="startGame">РќР°С‡Р°С‚СЊ РёРіСЂСѓ</button>
        </div>
    </div>
    
    <div class="shop-screen" id="shopScreen">
        <button class="close-shop" id="closeShop">Г—</button>
        <div class="shop-container">
            <h2>РњР°РіР°Р·РёРЅ Р°Р»РјР°Р·РѕРІ</h2>
            
            <div class="shop-categories">
                <div class="shop-category active" data-category="difficulties">РЎР»РѕР¶РЅРѕСЃС‚Рё</div>
                <div class="shop-category" data-category="maps">РљР°СЂС‚С‹</div>
                <div class="shop-category" data-category="cases">РљРµР№СЃС‹</div>
            </div>
            
            <div class="shop-items">
                <div class="shop-item" data-category="difficulties">
                    <h3>Р РµР¶РёРј Р­РєСЃС‚СЂРёРј</h3>
                    <p>РћС‚РєСЂРѕР№С‚Рµ СЌРєСЃС‚СЂРµРјР°Р»СЊРЅС‹Р№ СЂРµР¶РёРј СЃР»РѕР¶РЅРѕСЃС‚Рё: +1% Рє СЃРєРѕСЂРѕСЃС‚Рё РІСЂР°РіРѕРІ, x2 Р·РґРѕСЂРѕРІСЊСЏ, РІСЃРµРіРѕ 1 Р¶РёР·РЅСЊ</p>
                    <div class="shop-item-price">
                        <span class="diamond-icon">рџ’Ћ</span>
                        <span>25</span>
                        <button class="shop-item-btn" data-item="extreme" data-price="25" id="buyExtremeBtn">РљСѓРїРёС‚СЊ</button>
                    </div>
                </div>
                
                <div class="shop-item" data-category="maps">
                    <h3>РљР°СЂС‚Р° Р“РѕСЂРєРё</h3>
                    <p>РћС‚РєСЂРѕР№С‚Рµ РєР°СЂС‚Сѓ СЃ РјРЅРѕР¶РµСЃС‚РІРѕРј РїРѕРІРѕСЂРѕС‚РѕРІ Рё РёР·РІРёР»РёСЃС‚С‹Рј РїСѓС‚РµРј</p>
                    <div class="shop-item-price">
                        <span class="diamond-icon">рџ’Ћ</span>
                        <span>20</span>
                        <button class="shop-item-btn" data-item="mountains" data-price="20" id="buyMountainsBtn">РљСѓРїРёС‚СЊ</button>
                    </div>
                </div>
                
                <div class="shop-item" data-category="cases">
                    <h3>РћР±С‹С‡РЅС‹Р№ РєРµР№СЃ</h3>
                    <p>РЁР°РЅСЃ РїРѕР»СѓС‡РёС‚СЊ РѕРґРЅСѓ РёР· СЃРїРµС†РёР°Р»СЊРЅС‹С… Р±Р°С€РµРЅ</p>
                    <button class="case-info-btn" data-case="normal">?</button>
                    <div class="case-info-content">
                        <div class="case-item">
                            <div class="inventory-preview" style="background: linear-gradient(to right, blue, lightblue);"></div>
                            <span>Р”РІРѕР№РЅРѕР№ РїРёСЃС‚РѕР»РµС‚</span>
                            <span class="case-item-chance">45%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
                            <span>Р‘РѕРјР±С‹</span>
                            <span class="case-item-chance">30%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: gold;"></div>
                            <span>РҐРѕСЂРѕС€Р°СЏ С„РµСЂРјР°</span>
                            <span class="case-item-chance">20%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%);"></div>
                            <span>РўРѕРєСЃРёС‡РЅС‹Р№</span>
                            <span class="case-item-chance">4%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: gray;"></div>
                            <span>РўСѓСЂРµР»СЊ</span>
                            <span class="case-item-chance">0.6%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background: linear-gradient(to right, purple, black);"></div>
                            <span>РџСѓСЃС‚РѕР№</span>
                            <span class="case-item-chance">0.4%</span>
                        </div>
                    </div>
                    <button class="shop-item-btn" data-case="normal" data-price="50" id="openNormalCaseBtn">РћС‚РєСЂС‹С‚СЊ Р·Р° рџ’Ћ50</button>
                </div>
                
                <div class="shop-item" data-category="cases">
                    <h3>РџСЂРµРјРёСѓРј РєРµР№СЃ</h3>
                    <p>РЈР»СѓС‡С€РµРЅРЅС‹Р№ С€Р°РЅСЃ РїРѕР»СѓС‡РёС‚СЊ СЂРµРґРєРёРµ Р±Р°С€РЅРё</p>
                    <button class="case-info-btn" data-case="premium">?</button>
                    <div class="case-info-content">
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
                            <span>Р‘РѕРјР±С‹</span>
                            <span class="case-item-chance">40%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: gold;"></div>
                            <span>РҐРѕСЂРѕС€Р°СЏ С„РµСЂРјР°</span>
                            <span class="case-item-chance">25%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%);"></div>
                            <span>РўРѕРєСЃРёС‡РЅС‹Р№</span>
                            <span class="case-item-chance">20%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background-color: gray;"></div>
                            <span>РўСѓСЂРµР»СЊ</span>
                            <span class="case-item-chance">12.5%</span>
                        </div>
                        <div class="case-item">
                            <div class="inventory-preview" style="background: linear-gradient(to right, purple, black);"></div>
                            <span>РџСѓСЃС‚РѕР№</span>
                            <span class="case-item-chance">2.5%</span>
                        </div>
                    </div>
                    <button class="shop-item-btn" data-case="premium" data-price="200" id="openPremiumCaseBtn">РћС‚РєСЂС‹С‚СЊ Р·Р° рџ’Ћ200</button>
                </div>
            </div>
        </div>
    </div>
    
    <h1>Tower Defense</h1>
    
    <div class="info-panel">
        <div class="stats">
            Р”РµРЅСЊРіРё: <span id="money">200</span> | 
            Р–РёР·РЅРё: <span id="lives">20</span> | 
            Р’РѕР»РЅР°: <span id="wave">0</span> |
            РђР»РјР°Р·С‹: <span id="diamonds">0</span>
        </div>
        <div class="controls">
            <button id="toggleRadius">РЎРєСЂС‹С‚СЊ СЂР°РґРёСѓСЃ</button>
            <button id="toggleIndex">РџРѕРєР°Р·Р°С‚СЊ РёРЅРґРµРєСЃ</button>
        </div>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        
     <div class="shop">
    <h2>РњР°РіР°Р·РёРЅ</h2>
    
    <!-- РћРЎРќРћР’РќР«Р• Р‘РђРЁРќР -->
    <div class="tower-item" data-type="pistol" data-price="50">
        <div class="tower-preview" style="background-color: blue; border-radius: 50%;"></div>
        <div class="tower-info">
            <div class="tower-name">РџРёСЃС‚РѕР»РµС‚</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 1/СЃРµРє | Р Р°РґРёСѓСЃ: 100px</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 150 РјРѕРЅРµС‚ в†’ 2 СѓСЂРѕРЅР°/СЃРµРє, СЂР°РґРёСѓСЃ 120px</div>
        </div>
        <div class="tower-price">50</div>
    </div>
    
    <div class="tower-item" data-type="swordsman" data-price="125">
        <div class="tower-preview" style="background-color: red; transform: rotate(45deg);"></div>
        <div class="tower-info">
            <div class="tower-name">РњРµС‡РЅРёРє</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 1/0.5СЃРµРє | Р Р°РґРёСѓСЃ: 40px</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 300 РјРѕРЅРµС‚ в†’ 2 СѓСЂРѕРЅР°/0.5СЃРµРє</div>
        </div>
        <div class="tower-price">125</div>
    </div>
    
    <div class="tower-item" data-type="sniper" data-price="250">
        <div class="tower-preview" style="background-color: purple;"></div>
        <div class="tower-info">
            <div class="tower-name">РЎРЅР°Р№РїРµСЂ</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 10/5СЃРµРє | Р Р°РґРёСѓСЃ: 1000px</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 1000 РјРѕРЅРµС‚ в†’ 25 СѓСЂРѕРЅР°/2.5СЃРµРє</div>
        </div>
        <div class="tower-price">250</div>
    </div>
    
    <div class="tower-item" data-type="freezer" data-price="600">
        <div class="tower-preview" style="background-color: lightblue; border-radius: 50%;"></div>
        <div class="tower-info">
            <div class="tower-name">РҐРѕР»РѕРґРёР»СЊРЅРёРє</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 1/5СЃРµРє | Р Р°РґРёСѓСЃ: 250px | Р—Р°РјРµРґР»РµРЅРёРµ: 10%</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 1250 РјРѕРЅРµС‚ в†’ Р·Р°РјРµРґР»РµРЅРёРµ 35%</div>
        </div>
        <div class="tower-price">600</div>
    </div>
    
    <div class="tower-item" data-type="knight" data-price="1000">
        <div class="tower-preview" style="background: gray; clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);"></div>
        <div class="tower-info">
            <div class="tower-name">Р С‹С†Р°СЂСЊ</div>
            <div class="tower-stats">Р’РЅСѓС‚СЂ: 5СѓСЂ/0.6СЃРµРє/50px | Р’РЅРµС€: 5СѓСЂ/1.9СЃРµРє/280px</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 2500 РјРѕРЅРµС‚ в†’ СѓСЃРёР»РµРЅРёРµ Р°С‚Р°РєРё</div>
        </div>
        <div class="tower-price">1000</div>
    </div>
    
    <div class="tower-item" data-type="farm" data-price="450">
        <div class="tower-preview" style="background-color: brown; border-radius: 50%;"></div>
        <div class="tower-info">
            <div class="tower-name">Р¤РµСЂРјР°</div>
            <div class="tower-stats">Р”РѕС…РѕРґ: 1 РјРѕРЅРµС‚Р°/СЃРµРє | Р›РёРјРёС‚: 5</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 900 РјРѕРЅРµС‚ в†’ 3 РјРѕРЅРµС‚С‹/СЃРµРє</div>
        </div>
        <div class="tower-price">450</div>
    </div>
    
    <div class="tower-item" data-type="chance" data-price="777">
        <div class="tower-preview" style="background-color: pink; clip-path: polygon(50% 0%, 90% 20%, 100% 60%, 75% 100%, 25% 100%, 0% 60%, 10% 20%);"></div>
        <div class="tower-info">
            <div class="tower-name">РЁР°РЅСЃ</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 7-17/0.7СЃРµРє | Р Р°РґРёСѓСЃ: 170px</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 7777 РјРѕРЅРµС‚ в†’ 17-37 СѓСЂРѕРЅР°/0.77СЃРµРє</div>
        </div>
        <div class="tower-price">777</div>
    </div>
    
    <div class="tower-item" data-type="atomic" data-price="10000">
        <div class="tower-preview" style="background-color: darkgreen; clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);"></div>
        <div class="tower-info">
            <div class="tower-name">РђС‚РѕРјРЅС‹Р№</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 200/60СЃРµРє | Р Р°РґРёСѓСЃ: 1000px | Р›РёРјРёС‚: 2</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 30000 РјРѕРЅРµС‚ в†’ 250 СѓСЂРѕРЅР°/50СЃРµРє</div>
        </div>
        <div class="tower-price">10000</div>
    </div>
    
    <div class="tower-item" data-type="omega" data-price="12500">
        <div class="tower-preview" style="background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);"></div>
        <div class="tower-info">
            <div class="tower-name">РћРњР•Р“Рђ</div>
            <div class="tower-stats">Р’РЅСѓС‚СЂ: 10СѓСЂ/0.5СЃРµРє/90px | Р’РЅРµС€: 25СѓСЂ/3СЃРµРє/300px | Р›РёРјРёС‚: 2</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 40000 РјРѕРЅРµС‚ в†’ 15СѓСЂ/0.4СЃРµРє/150px Рё 20СѓСЂ/1СЃРµРє/300px</div>
        </div>
        <div class="tower-price">12500</div>
    </div>
    
    <!-- Р‘РђРЁРќР РР— РљР•Р™РЎРћР’ -->
    <div class="tower-item" data-type="doublepistol" data-price="75">
        <div class="tower-preview" style="background: linear-gradient(to right, blue, lightblue); border-radius: 50%;"></div>
        <div class="tower-info">
            <div class="tower-name">Р”РІРѕР№РЅРѕР№ РїРёСЃС‚РѕР»РµС‚</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 2/СЃРµРє | Р Р°РґРёСѓСЃ: 100px</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 150 РјРѕРЅРµС‚ в†’ 4 СѓСЂРѕРЅР°/СЃРµРє, СЂР°РґРёСѓСЃ 120px</div>
        </div>
        <div class="tower-price">75</div>
    </div>
    
    <div class="tower-item" data-type="bomb" data-price="325">
        <div class="tower-preview" style="background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
        <div class="tower-info">
            <div class="tower-name">Р‘РѕРјР±С‹</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 5/2.5СЃРµРє | Р Р°РґРёСѓСЃ: 80px | AoE</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 650 РјРѕРЅРµС‚ в†’ 5 СѓСЂРѕРЅР°/1.5СЃРµРє, СЂР°РґРёСѓСЃ 130px</div>
        </div>
        <div class="tower-price">325</div>
    </div>
    
    <div class="tower-item" data-type="goodfarm" data-price="450">
        <div class="tower-preview" style="background-color: gold;"></div>
        <div class="tower-info">
            <div class="tower-name">РҐРѕСЂРѕС€Р°СЏ С„РµСЂРјР°</div>
            <div class="tower-stats">Р”РѕС…РѕРґ: 5 РјРѕРЅРµС‚/СЃРµРє | Р›РёРјРёС‚: 2</div>
            <div class="upgrade-option">РќРµС‚ СѓР»СѓС‡С€РµРЅРёР№</div>
        </div>
        <div class="tower-price">450</div>
    </div>
    
    <div class="tower-item" data-type="toxic" data-price="1250">
        <div class="tower-preview" style="background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%);"></div>
        <div class="tower-info">
            <div class="tower-name">РўРѕРєСЃРёС‡РЅС‹Р№</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 1/0.1СЃРµРє | Р›СѓР¶Р° РЅР° РїРѕР»Рµ | Р›РёРјРёС‚: 3</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 2500 РјРѕРЅРµС‚ в†’ 2 СѓСЂРѕРЅР°/0.1СЃРµРє</div>
        </div>
        <div class="tower-price">1250</div>
    </div>
    
    <div class="tower-item" data-type="turret" data-price="2500">
        <div class="tower-preview" style="background-color: gray;"></div>
        <div class="tower-info">
            <div class="tower-name">РўСѓСЂРµР»СЊ</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 2/0.2СЃРµРє | Р Р°РґРёСѓСЃ: 150px | Р›РёРјРёС‚: 8</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 5000 РјРѕРЅРµС‚ в†’ 2 СѓСЂРѕРЅР°/0.1СЃРµРє, СЂР°РґРёСѓСЃ 160px</div>
        </div>
        <div class="tower-price">2500</div>
    </div>
    
    <div class="tower-item" data-type="empty" data-price="7500">
        <div class="tower-preview" style="background: linear-gradient(to right, purple, black);"></div>
        <div class="tower-info">
            <div class="tower-name">РџСѓСЃС‚РѕР№</div>
            <div class="tower-stats">РЈСЂРѕРЅ: 10/СЃРµРє | Р Р°РґРёСѓСЃ: 100px | Р—Р°РјРµРґР»РµРЅРёРµ 50% | Р›РёРјРёС‚: 1</div>
            <div class="upgrade-option">РЈР»СѓС‡С€РµРЅРёРµ: 17500 РјРѕРЅРµС‚ в†’ 20 СѓСЂРѕРЅР°/СЃРµРє, СЂР°РґРёСѓСЃ 200px, Р·Р°РјРµРґР»РµРЅРёРµ 65%</div>
        </div>
        <div class="tower-price">7500</div>
    </div>
</div>

<!-- РРќР”Р•РљРЎ Р’Р РђР“РћР’ -->
<div class="enemy-index" id="enemyIndex">
    <h2>РРЅРґРµРєСЃ РІСЂР°РіРѕРІ</h2>
    
    <div class="enemy-item" id="red-enemy">
        <div class="enemy-name">РљСЂР°СЃРЅС‹Р№ С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 3 + РІРѕР»РЅР°/3</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 1.0</div>
            <div>РќР°РіСЂР°РґР°: 10 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="purple-enemy">
        <div class="enemy-name">Р¤РёРѕР»РµС‚РѕРІС‹Р№ С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 15</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 0.5</div>
            <div>РќР°РіСЂР°РґР°: 25 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="golden-enemy">
        <div class="enemy-name">Р—РѕР»РѕС‚РѕР№ С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 35</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 2.0</div>
            <div>РќР°РіСЂР°РґР°: 50 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="pink-enemy">
        <div class="enemy-name">Р РѕР·РѕРІС‹Р№ С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 11</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 5.0</div>
            <div>РќР°РіСЂР°РґР°: 30 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="green-enemy">
        <div class="enemy-name">Р—РµР»РµРЅС‹Р№ С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 100</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 0.32</div>
            <div>РќР°РіСЂР°РґР°: 75 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="white-enemy">
        <div class="enemy-name">Р‘РµР»С‹Р№ С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 120</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: РїРµСЂРµРјРµРЅРЅР°СЏ (0.32-2.0)</div>
            <div>РќР°РіСЂР°РґР°: 100 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="boss-enemy">
        <div class="enemy-name">Р‘РћРЎРЎ (Р§РµСЂРЅС‹Р№ С€Р°СЂ)</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 250 + 250 Р·Р° РєР°Р¶РґС‹Рµ 50 РІРѕР»РЅ</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 1.0</div>
            <div>РћСЃРѕР±РµРЅРЅРѕСЃС‚СЊ: РЈРјРµРЅСЊС€Р°РµС‚ СѓСЂРѕРЅ Р±Р°С€РµРЅ РІ СЂР°РґРёСѓСЃРµ 40px</div>
            <div>РќР°РіСЂР°РґР°: 500 + РІРѕР»РЅР°Г—10 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="blue-enemy">
        <div class="enemy-name">Р“РѕР»СѓР±РѕР№ С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 200</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 0.2</div>
            <div>РћСЃРѕР±РµРЅРЅРѕСЃС‚СЊ: Р›РµС‡РёС‚ РґСЂСѓРіРёС… РІСЂР°РіРѕРІ РєР°Р¶РґС‹Рµ 10 СЃРµРєСѓРЅРґ</div>
            <div>РќР°РіСЂР°РґР°: 150 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="sonic-enemy">
        <div class="enemy-name">РЎРѕРЅРёРє С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 10</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 10.0</div>
            <div>РћСЃРѕР±РµРЅРЅРѕСЃС‚СЊ: РћС‡РµРЅСЊ Р±С‹СЃС‚СЂС‹Р№</div>
            <div>РќР°РіСЂР°РґР°: 200 РјРѕРЅРµС‚</div>
        </div>
    </div>
    
    <div class="enemy-item" id="void-enemy">
        <div class="enemy-name">РџСѓСЃС‚РѕС‚РЅС‹Р№ С€Р°СЂ</div>
        <div class="enemy-stats">
            <div>Р—РґРѕСЂРѕРІСЊРµ: 1000</div>
            <div>РЎРєРѕСЂРѕСЃС‚СЊ: 0.33</div>
            <div>РћСЃРѕР±РµРЅРЅРѕСЃС‚СЊ: РЈРґР°Р»СЏРµС‚ СЃР»СѓС‡Р°Р№РЅСѓСЋ Р±Р°С€РЅСЋ РєР°Р¶РґС‹Рµ 60 СЃРµРєСѓРЅРґ</div>
            <div>РќР°РіСЂР°РґР°: 1000 РјРѕРЅРµС‚</div>
        </div>
    </div>
</div>

<!-- РњР•РќР® РЈР›РЈР§РЁР•РќРРЇ -->
<div class="upgrade-menu" id="upgradeMenu">
    <h3>РЈР»СѓС‡С€РµРЅРёРµ Р±Р°С€РЅРё</h3>
    <div id="upgradeInfo">
        <p>Р’С‹Р±РµСЂРёС‚Рµ Р±Р°С€РЅСЋ РґР»СЏ РїСЂРѕСЃРјРѕС‚СЂР° РёРЅС„РѕСЂРјР°С†РёРё РѕР± СѓР»СѓС‡С€РµРЅРёРё</p>
    </div>
    <div class="targeting-options" id="targetingOptions">
        <label>
            <input type="radio" name="targeting" value="first" checked> РџРµСЂРІР°СЏ С†РµР»СЊ (Р±Р»РёР¶Р°Р№С€Р°СЏ Рє РєРѕРЅС†Сѓ)
        </label>
        <label>
            <input type="radio" name="targeting" value="random"> РЎР»СѓС‡Р°Р№РЅР°СЏ С†РµР»СЊ
        </label>
    </div>
    <button class="upgrade-btn" id="upgradeBtn">РЈР»СѓС‡С€РёС‚СЊ</button>
    <button class="sell-btn" id="sellBtn">РџСЂРѕРґР°С‚СЊ (50% СЃС‚РѕРёРјРѕСЃС‚Рё)</button>
</div>
    
    <button id="restartGame">РќР°С‡Р°С‚СЊ Р·Р°РЅРѕРІРѕ</button>
    <div class="game-overlay" id="gameOverlay"></div>
    
    <script>
        // РџРѕР»СѓС‡Р°РµРј СЌР»РµРјРµРЅС‚С‹ canvas Рё РєРѕРЅС‚РµРєСЃС‚
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // РРіСЂРѕРІС‹Рµ РїРµСЂРµРјРµРЅРЅС‹Рµ
        let money = 200;
        let lives = 20;
        let wave = 0;
        let diamonds = 0;
        let totalDiamonds = 0;
        let enemies = [];
        let towers = [];
        let bullets = [];
        let puddles = [];
        let selectedTowerType = null;
        let selectedTower = null;
        let gameActive = true;
        let enemySpawnTimer = 0;
        let enemiesToSpawn = 0;
        let showRadius = true;
        let waveActive = false;
        let redCount = 0;
        let purpleCount = 0;
        let goldenCount = 0;
        let pinkCount = 0;
        let greenCount = 0;
        let whiteCount = 0;
        let bossCount = 0;
        let blueCount = 0;
        let sonicCount = 0;
        let voidCount = 0;
        let rangeIndicator = null;
        let bossAura = null;
        let difficulty = "normal";
        let mapType = "hills";
        let farmCount = 0;
        let atomicCount = 0;
        let omegaCount = 0;
        let goodFarmCount = 0;
        let toxicCount = 0;
        let turretCount = 0;
        let emptyCount = 0;
        let waveRewardMultiplier = 1; // РњРЅРѕР¶РёС‚РµР»СЊ РЅР°РіСЂР°РґС‹ Р·Р° РІРѕР»РЅС‹
        let ownedTowers = []; // РњР°СЃСЃРёРІ РґР»СЏ С…СЂР°РЅРµРЅРёСЏ РїРѕР»СѓС‡РµРЅРЅС‹С… Р±Р°С€РµРЅ

        // Р¤СѓРЅРєС†РёСЏ РґР»СЏ РїРѕР»СѓС‡РµРЅРёСЏ С‚РѕС‡РЅС‹С… РєРѕРѕСЂРґРёРЅР°С‚ РјС‹С€Рё РѕС‚РЅРѕСЃРёС‚РµР»СЊРЅРѕ canvas
        function getMousePos(canvas, evt) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            return {
                x: (evt.clientX - rect.left) * scaleX,
                y: (evt.clientY - rect.top) * scaleY
            };
        }
        
        // Р—Р°РіСЂСѓР·РєР° РґР°РЅРЅС‹С… РёР· localStorage
        function loadGameData() {
            const savedData = localStorage.getItem('tdGameData');
            if (savedData) {
                const data = JSON.parse(savedData);
                totalDiamonds = data.totalDiamonds || 0;
                ownedTowers = data.ownedTowers || [];
                document.getElementById('diamondTotal').textContent = totalDiamonds;
                
                // Р Р°Р·Р±Р»РѕРєРёСЂСѓРµРј РєСѓРїР»РµРЅРЅС‹Рµ СЃР»РѕР¶РЅРѕСЃС‚Рё Рё РєР°СЂС‚С‹
                if (data.unlockedExtreme) {
                    document.getElementById('extremeDifficultyBtn').classList.remove('option-btn');
                    document.getElementById('extremeDifficultyBtn').classList.add('option-btn');
                    document.getElementById('buyExtremeBtn').disabled = true;
                    document.getElementById('buyExtremeBtn').textContent = 'РљСѓРїР»РµРЅРѕ';
                }
                
                if (data.unlockedMountains) {
                    document.getElementById('mountainsMapBtn').classList.remove('option-btn');
                    document.getElementById('mountainsMapBtn').classList.add('option-btn');
                    document.getElementById('buyMountainsBtn').disabled = true;
                    document.getElementById('buyMountainsBtn').textContent = 'РљСѓРїР»РµРЅРѕ';
                }
                
                // РџРѕРєР°Р·С‹РІР°РµРј РІСЃРµ РїРѕР»СѓС‡РµРЅРЅС‹Рµ Р±Р°С€РЅРё РІ РјР°РіР°Р·РёРЅРµ
                ownedTowers.forEach(towerType => {
                    document.getElementById(`${towerType}Tower`).style.display = 'flex';
                });
            }
        }
        
        // РЎРѕС…СЂР°РЅРµРЅРёРµ РґР°РЅРЅС‹С… РІ localStorage
        function saveGameData() {
            const data = {
                totalDiamonds: totalDiamonds,
                unlockedExtreme: document.getElementById('buyExtremeBtn').disabled,
                unlockedMountains: document.getElementById('buyMountainsBtn').disabled,
                ownedTowers: ownedTowers
            };
            
            localStorage.setItem('tdGameData', JSON.stringify(data));
        }
        
        // РџРѕР»СѓС‡РµРЅРёРµ СЃС‚РёР»СЏ РґР»СЏ Р±Р°С€РЅРё
        function getTowerStyle(type) {
            switch(type) {
                case 'doublepistol': return 'background: linear-gradient(to right, blue, lightblue); border-radius: 50%;';
                case 'bomb': return 'background-color: black; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);';
                case 'goodfarm': return 'background-color: gold;';
                case 'toxic': return 'background-color: green; clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 90% 70%, 50% 100%, 10% 70%, 0% 35%, 20% 10%);';
                case 'turret': return 'background-color: gray;';
                case 'empty': return 'background: linear-gradient(to right, purple, black);';
                default: return '';
            }
        }
        
        // РџРѕР»СѓС‡РµРЅРёРµ РёРјРµРЅРё Р±Р°С€РЅРё
        function getTowerName(type) {
            switch(type) {
                case 'doublepistol': return 'Р”РІРѕР№РЅРѕР№ РїРёСЃС‚РѕР»РµС‚';
                case 'bomb': return 'Р‘РѕРјР±С‹';
                case 'goodfarm': return 'РҐРѕСЂРѕС€Р°СЏ С„РµСЂРјР°';
                case 'toxic': return 'РўРѕРєСЃРёС‡РЅС‹Р№';
                case 'turret': return 'РўСѓСЂРµР»СЊ';
                case 'empty': return 'РџСѓСЃС‚РѕР№';
                default: return '';
            }
        }
        
        let enemyKnowledge = {
            'red': { health: 0, speed: 0, discovered: false },
            'purple': { health: 0, speed: 0, discovered: false },
            'golden': { health: 0, speed: 0, discovered: false },
            'pink': { health: 0, speed: 0, discovered: false },
            'green': { health: 0, speed: 0, discovered: false },
            'white': { health: 0, speed: 0, discovered: false },
            'boss': { health: 0, speed: 0, discovered: false, special: "" },
            'blue': { health: 0, speed: 0, discovered: false, special: "" },
            'sonic': { health: 0, speed: 0, discovered: false, special: "" },
            'void': { health: 0, speed: 0, discovered: false, special: "" }
        };
        
        // РљРѕРЅСЃС‚Р°РЅС‚С‹
        const ENEMY_BASE_SPEED = 1;
        const ENEMY_SIZE = 10;
        const TOWER_SIZE = 15;
        const BULLET_SIZE = 5;
        const ST_TO_PX = 10; // 1st = 10px
        
        // РџСѓС‚СЊ РґР»СЏ РІСЂР°РіРѕРІ (Р¶РµР»С‚Р°СЏ С‚СЂРѕРїРёРЅРєР°)
        let PATH = [];
        
        // Р¤СѓРЅРєС†РёСЏ СѓСЃС‚Р°РЅРѕРІРєРё РїСѓС‚Рё РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ РєР°СЂС‚С‹
        function setPath() {
            if (mapType === "hills") {
                PATH = [
                    {x: -20, y: 250},
                    {x: 150, y: 250},
                    {x: 150, y: 150},
                    {x: 400, y: 150},
                    {x: 400, y: 350},
                    {x: 650, y: 350},
                    {x: 650, y: 250},
                    {x: 820, y: 250}
                ];
            } else if (mapType === "flat") {
                PATH = [
                    {x: -20, y: 250},
                    {x: 820, y: 250}
                ];
            } else if (mapType === "mountains") {
                PATH = [
                    {x: -20, y: 250},
                    {x: 100, y: 250},
                    {x: 100, y: 100},
                    {x: 200, y: 100},
                    {x: 200, y: 400},
                    {x: 300, y: 400},
                    {x: 300, y: 150},
                    {x: 500, y: 150},
                    {x: 500, y: 350},
                    {x: 700, y: 350},
                    {x: 700, y: 200},
                    {x: 820, y: 200}
                ];
            }
        }
        
        // РљР»Р°СЃСЃ РІСЂР°РіР°
        class Enemy {
            constructor(type, health, speed, size, color) {
                this.type = type;
                this.health = health;
                this.maxHealth = health;
                this.baseSpeed = speed;
                this.speed = speed;
                this.size = size;
                this.color = color;
                this.x = PATH[0].x;
                this.y = PATH[0].y;
                this.pathIndex = 0;
                this.slowPercent = 0;
                this.speedChangeTimer = 0;
                this.auraRadius = 0;
                this.healTimer = 0;
                this.deleteTimer = 0;
                
                // РџСЂРёРјРµРЅСЏРµРј РјРѕРґРёС„РёРєР°С‚РѕСЂС‹ СЃР»РѕР¶РЅРѕСЃС‚Рё
                if (difficulty === "hard") {
                    this.health *= 1.5; // Р’ 1.5 СЂР°Р· Р±РѕР»СЊС€Рµ Р·РґРѕСЂРѕРІСЊСЏ
                    this.maxHealth = this.health;
                    this.baseSpeed *= 1.05;
                    this.speed = this.baseSpeed;
                } else if (difficulty === "extreme") {
                    this.health *= 2; // Р’ 2 СЂР°Р·Р° Р±РѕР»СЊС€Рµ Р·РґРѕСЂРѕРІСЊСЏ
                    this.maxHealth = this.health;
                    this.baseSpeed *= 1.01;
                    this.speed = this.baseSpeed;
                }
                
                // РЈСЃС‚Р°РЅР°РІР»РёРІР°РµРј РѕСЃРѕР±С‹Рµ СЃРІРѕР№СЃС‚РІР° РІСЂР°РіРѕРІ
                if (type === 'boss') {
                    this.auraRadius = 4 * ST_TO_PX; // 4st = 40px (РєР°Рє Сѓ РјРµС‡РЅРёРєР°)
                } else if (type === 'blue') {
                    this.healTimer = 600; // 10 СЃРµРєСѓРЅРґ РїСЂРё 60 FPS
                } else if (type === 'void') {
                    this.deleteTimer = 3600; // 60 СЃРµРєСѓРЅРґ РїСЂРё 60 FPS
                }
                
                // Р—Р°РїРёСЃС‹РІР°РµРј РёРЅС„РѕСЂРјР°С†РёСЋ Рѕ РІСЂР°РіРµ, РµСЃР»Рё РѕРЅ РµС‰Рµ РЅРµ Р±С‹Р» РѕР±РЅР°СЂСѓР¶РµРЅ
                if (!enemyKnowledge[type].discovered) {
                    enemyKnowledge[type].health = health;
                    enemyKnowledge[type].speed = speed;
                    
                    if (type === 'boss') {
                        enemyKnowledge[type].special = "РЈРјРµРЅСЊС€Р°РµС‚ СѓСЂРѕРЅ Р±Р°С€РµРЅ РІ СЂР°РґРёСѓСЃРµ";
                    } else if (type === 'blue') {
                        enemyKnowledge[type].special = "Р›РµС‡РёС‚ РґСЂСѓРіРёС… РІСЂР°РіРѕРІ";
                    } else if (type === 'sonic') {
                        enemyKnowledge[type].special = "РћС‡РµРЅСЊ Р±С‹СЃС‚СЂС‹Р№";
                    } else if (type === 'void') {
                        enemyKnowledge[type].special = "РЈРґР°Р»СЏРµС‚ Р±Р°С€РЅРё СЂР°Р· РІ РјРёРЅСѓС‚Сѓ";
                    }
                    
                    enemyKnowledge[type].discovered = true;
                    updateEnemyIndex();
                }
            }
            
            update() {
                // Р”Р»СЏ Р±РµР»РѕРіРѕ РІСЂР°РіР° - РјРµРЅСЏРµРј СЃРєРѕСЂРѕСЃС‚СЊ РєР°Р¶РґСѓСЋ СЃРµРєСѓРЅРґСѓ
                if (this.type === 'white') {
                    this.speedChangeTimer++;
                    if (this.speedChangeTimer >= 60) {
                        this.speedChangeTimer = 0;
                        // РњРµРЅСЏРµРј СЃРєРѕСЂРѕСЃС‚СЊ СЃР»СѓС‡Р°Р№РЅС‹Рј РѕР±СЂР°Р·РѕРј РѕС‚ СЃРєРѕСЂРѕСЃС‚Рё Р·РµР»РµРЅРѕРіРѕ РґРѕ Р·РѕР»РѕС‚РѕРіРѕ
                        const greenSpeed = ENEMY_BASE_SPEED / 3.15675434;
                        const goldenSpeed = ENEMY_BASE_SPEED * 2;
                        this.speed = greenSpeed + Math.random() * (goldenSpeed - greenSpeed);
                    }
                }
                
                // Р”Р»СЏ РіРѕР»СѓР±РѕРіРѕ РІСЂР°РіР° - Р»РµС‡РµРЅРёРµ РєР°Р¶РґС‹Рµ 10 СЃРµРєСѓРЅРґ
                if (this.type === 'blue') {
                    this.healTimer--;
                    if (this.healTimer <= 0) {
                        this.healTimer = 600; // РЎР±СЂРѕСЃ С‚Р°Р№РјРµСЂР°
                        
                        // Р›РµС‡РёРј РІСЃРµС… РІСЂР°РіРѕРІ РЅР° 50% РѕС‚ РёС… РјР°РєСЃРёРјР°Р»СЊРЅРѕРіРѕ Р·РґРѕСЂРѕРІСЊСЏ
                        for (const enemy of enemies) {
                            if (enemy !== this) {
                                enemy.health = Math.min(enemy.maxHealth, enemy.health + enemy.maxHealth * 0.5);
                            }
                        }
                    }
                }
                
                // Р”Р»СЏ РїСѓСЃС‚РѕС‚РЅРѕРіРѕ РІСЂР°РіР° - СѓРґР°Р»РµРЅРёРµ Р±Р°С€РЅРё РєР°Р¶РґС‹Рµ 60 СЃРµРєСѓРЅРґ
                if (this.type === 'void') {
                    this.deleteTimer--;
                    if (this.deleteTimer <= 0) {
                        this.deleteTimer = 3600; // РЎР±СЂРѕСЃ С‚Р°Р№РјРµСЂР°
                        
                        // РЈРґР°Р»СЏРµРј СЃР»СѓС‡Р°Р№РЅСѓСЋ Р±Р°С€РЅСЋ (РєСЂРѕРјРµ РћРњР•Р“Р)
                        const nonOmegaTowers = towers.filter(tower => tower.type !== 'omega');
                        if (nonOmegaTowers.length > 0) {
                            const randomIndex = Math.floor(Math.random() * nonOmegaTowers.length);
                            const towerToRemove = nonOmegaTowers[randomIndex];
                            
                            // РћР±РЅРѕРІР»СЏРµРј СЃС‡РµС‚С‡РёРєРё Р»РёРјРёС‚РёСЂРѕРІР°РЅРЅС‹С… Р±Р°С€РµРЅ
                            if (towerToRemove.type === 'farm') farmCount--;
                            if (towerToRemove.type === 'atomic') atomicCount--;
                            if (towerToRemove.type === 'omega') omegaCount--;
                            if (towerToRemove.type === 'goodfarm') goodFarmCount--;
                            if (towerToRemove.type === 'toxic') toxicCount--;
                            if (towerToRemove.type === 'turret') turretCount--;
                            if (towerToRemove.type === 'empty') emptyCount--;
                            
                            towers.splice(towers.indexOf(towerToRemove), 1);
                        }
                    }
                }
                
                // РџСЂРѕРІРµСЂСЏРµРј, РЅР°С…РѕРґРёС‚СЃСЏ Р»Рё РІСЂР°Рі РІ Р»СѓР¶Рµ
                let inPuddle = false;
                for (const puddle of puddles) {
                    const dx = this.x - puddle.x;
                    const dy = this.y - puddle.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < puddle.radius) {
                        inPuddle = true;
                        this.takeDamage(puddle.damage);
                        break;
                    }
                }
                
                // РџСЂРёРјРµРЅСЏРµРј Р·Р°РјРµРґР»РµРЅРёРµ, РµСЃР»Рё РµСЃС‚СЊ
                this.speed = this.baseSpeed * (1 - this.slowPercent / 100);
                
                // Р”РІРёР¶РµРЅРёРµ РїРѕ РїСѓС‚Рё
                const targetX = PATH[this.pathIndex].x;
                const targetY = PATH[this.pathIndex].y;
                
                const dx = targetX - this.x;
                const dy = targetY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < this.speed) {
                    this.x = targetX;
                    this.y = targetY;
                    this.pathIndex++;
                    
                    // Р•СЃР»Рё РІСЂР°Рі РґРѕС€РµР» РґРѕ РєРѕРЅС†Р° РїСѓС‚Рё
                    if (this.pathIndex >= PATH.length) {
                        lives--;
                        updateStats();
                        
                        // РџСЂРѕРІРµСЂРєР° РЅР° РїСЂРѕРёРіСЂС‹С€
                        if (lives <= 0) {
                            gameOver();
                        }
                        
                        return false;
                    }
                } else {
                    this.x += (dx / distance) * this.speed;
                    this.y += (dy / distance) * this.speed;
                }
                
                return true;
            }
            
            draw() {
                // Р РёСЃСѓРµРј РІСЂР°РіР°
                ctx.fillStyle = this.color;
                
                if (this.type === 'red' || this.type === 'purple' || this.type === 'pink' || 
                    this.type === 'green' || this.type === 'white' || this.type === 'blue') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.type === 'golden') {
                    // Р—РѕР»РѕС‚РѕР№ РІСЂР°Рі СЃ СЌС„С„РµРєС‚РѕРј СЃРёСЏРЅРёСЏ
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    
                    // Р“СЂР°РґРёРµРЅС‚ РґР»СЏ Р·РѕР»РѕС‚РѕРіРѕ РІСЂР°РіР°
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0, 
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, '#FFD700');
                    gradient.addColorStop(1, '#DAA520');
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // Р­С„С„РµРєС‚ СЃРёСЏРЅРёСЏ
                    ctx.strokeStyle = 'rgba(255, 215, 0, 0.6)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 3, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (this.type === 'boss') {
                    // Р‘РѕСЃСЃ - С‡РµСЂРЅС‹Р№ С€Р°СЂ СЃ РєСЂР°СЃРЅРѕР№ Р°СѓСЂР°
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // РђСѓСЂР° Р±РѕСЃСЃР°
                    ctx.strokeStyle = 'rgba(255, 0, 0, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.auraRadius, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // РћР±РЅРѕРІР»СЏРµРј РёРЅРґРёРєР°С‚РѕСЂ Р°СѓСЂС‹
                    if (bossAura) {
                        bossAura.style.left = this.x + 'px';
                        bossAura.style.top = this.y + 'px';
                        bossAura.style.width = this.auraRadius * 2 + 'px';
                        bossAura.style.height = this.auraRadius * 2 + 'px';
                    }
                } else if (this.type === 'sonic') {
                    // РЎРѕРЅРёРє С€Р°СЂ (Р¶РµР»С‚С‹Р№ + СЃРёРЅРёР№)
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    
                    // Р“СЂР°РґРёРµРЅС‚ РґР»СЏ СЃРѕРЅРёРє С€Р°СЂР°
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0, 
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, '#FFFF00');
                    gradient.addColorStop(1, '#0000FF');
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // Р­С„С„РµРєС‚ СЃРєРѕСЂРѕСЃС‚Рё
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.6)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 3, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (this.type === 'void') {
                    // РџСѓСЃС‚РѕС‚РЅС‹Р№ С€Р°СЂ (С„РёРѕР»РµС‚РѕРІС‹Р№ + С‡РµСЂРЅС‹Р№)
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    
                    // Р“СЂР°РґРёРµРЅС‚ РґР»СЏ РїСѓСЃС‚РѕС‚РЅРѕРіРѕ С€Р°СЂР°
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0, 
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, '#8A2BE2');
                    gradient.addColorStop(1, '#000000');
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // Р­С„С„РµРєС‚ РїСѓСЃС‚РѕС‚С‹
                    ctx.strokeStyle = 'rgba(75, 0, 130, 0.6)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 3, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                // Р РёСЃСѓРµРј РїРѕР»РѕСЃРєСѓ Р·РґРѕСЂРѕРІСЊСЏ
                const healthWidth = (this.health / this.maxHealth) * (this.size * 2);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(this.x - this.size, this.y - this.size - 8, this.size * 2, 4);
                ctx.fillStyle = this.type === 'golden' ? '#00ff00' : 'red';
                ctx.fillRect(this.x - this.size, this.y - this.size - 8, healthWidth, 4);
                
                // Р”Р»СЏ Р·Р°РјРµРґР»РµРЅРЅС‹С… РІСЂР°РіРѕРІ РґРѕР±Р°РІР»СЏРµРј СЌС„С„РµРєС‚ Р»СЊРґР°
                if (this.slowPercent > 0) {
                    ctx.strokeStyle = 'rgba(100, 200, 255, 0.7)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 2, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
            
            takeDamage(damage) {
                // Р”Р»СЏ Р±РѕСЃСЃР° - СѓРјРµРЅСЊС€Р°РµРј СѓСЂРѕРЅ РѕС‚ Р±Р°С€РµРЅ РІ РµРіРѕ Р°СѓСЂРµ
                if (this.type === 'boss') {
                    let actualDamage = damage;
                    
                    // РџСЂРѕРІРµСЂСЏРµРј, РЅР°С…РѕРґРёС‚СЃСЏ Р»Рё Р°С‚Р°РєСѓСЋС‰Р°СЏ Р±Р°С€РЅСЏ РІ Р°СѓСЂРµ Р±РѕСЃСЃР°
                    for (const tower of towers) {
                        const dx = tower.x - this.x;
                        const dy = tower.y - this.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < this.auraRadius) {
                            actualDamage = damage * 0.5; // РЈРјРµРЅСЊС€Р°РµРј СѓСЂРѕРЅ РІРґРІРѕРµ
                            break;
                        }
                    }
                    
                    this.health -= actualDamage;
                } else {
                    this.health -= damage;
                }
                
                if (this.health <= 0) {
                    let reward = 0;
                    
                    switch(this.type) {
                        case 'red': reward = 10; break;
                        case 'purple': reward = 25; break;
                        case 'golden': reward = 50; break;
                        case 'pink': reward = 30; break;
                        case 'green': reward = 75; break;
                        case 'white': reward = 100; break;
                        case 'boss': reward = 500 + wave * 10; break;
                        case 'blue': reward = 150; break;
                        case 'sonic': reward = 200; break;
                        case 'void': reward = 1000; break;
                    }
                    
                    money += reward;
                    updateStats();
                    
                    // РЈРґР°Р»СЏРµРј Р°СѓСЂСѓ Р±РѕСЃСЃР°, РµСЃР»Рё СЌС‚Рѕ Р±РѕСЃСЃ
                    if (this.type === 'boss' && bossAura) {
                        document.body.removeChild(bossAura);
                        bossAura = null;
                    }
                    
                    return true;
                }
                return false;
            }
            
            slowDown(percent) {
                this.slowPercent = Math.max(this.slowPercent, percent);
            }
        }
        
        // РљР»Р°СЃСЃ Р»СѓР¶Рё (РґР»СЏ С‚РѕРєСЃРёС‡РЅРѕР№ Р±Р°С€РЅРё)
        class Puddle {
            constructor(x, y, damage, radius, duration) {
                this.x = x;
                this.y = y;
                this.damage = damage;
                this.radius = radius;
                this.duration = duration; // РІ РєР°РґСЂР°С…
                this.timer = 0;
            }
            
            update() {
                this.timer++;
                return this.timer < this.duration;
            }
            
            draw() {
                ctx.fillStyle = 'rgba(0, 255, 0, 0.3)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = 'rgba(0, 200, 0, 0.7)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
        
        // РљР»Р°СЃСЃ Р±Р°С€РЅРё
        class Tower {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.upgraded = false;
                this.targeting = 'first'; // 'first' РёР»Рё 'random'
                this.incomeTimer = 0;
                this.puddleTimer = 0;
                this.specialTimer = 0;
                
                // РЈСЃС‚Р°РЅРѕРІРєР° РїР°СЂР°РјРµС‚СЂРѕРІ РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ С‚РёРїР°
                switch(type) {
                    case 'pistol':
                        this.radius = 10 * ST_TO_PX; // 10st = 100px
                        this.damage = 1;
                        this.fireRate = 60; // 1 РІС‹СЃС‚СЂРµР» РІ СЃРµРєСѓРЅРґСѓ (60 FPS)
                        this.color = 'blue';
                        this.shape = 'circle';
                        this.upgradeCost = 150;
                        this.upgradeDamage = 2;
                        this.upgradeRadius = 12 * ST_TO_PX; // 12st = 120px
                        this.upgradeFireRate = 60;
                        break;
                    case 'swordsman':
                        this.radius = 4 * ST_TO_PX; // 4st = 40px
                        this.damage = 1;
                        this.fireRate = 30; // 2 РІС‹СЃС‚СЂРµР»Р° РІ СЃРµРєСѓРЅРґСѓ
                        this.color = 'red';
                        this.shape = 'diamond';
                        this.upgradeCost = 300;
                        this.upgradeDamage = 2;
                        this.upgradeRadius = 4 * ST_TO_PX;
                        this.upgradeFireRate = 30;
                        break;
                    case 'sniper':
                        this.radius = 100 * ST_TO_PX; // 100st = 1000px
                        this.damage = 10;
                        this.fireRate = 300; // 1 РІС‹СЃС‚СЂРµР» РІ 5 СЃРµРєСѓРЅРґ
                        this.color = 'purple';
                        this.shape = 'square';
                        this.upgradeCost = 1000;
                        this.upgradeDamage = 25;
                        this.upgradeRadius = 100 * ST_TO_PX;
                        this.upgradeFireRate = 150; // 1 РІС‹СЃС‚СЂРµР» РІ 2.5 СЃРµРєСѓРЅРґС‹
                        break;
                    case 'freezer':
                        this.radius = 25 * ST_TO_PX; // 25st = 250px
                        this.damage = 1;
                        this.fireRate = 300; // 1 РІС‹СЃС‚СЂРµР» РІ 5 СЃРµРєСѓРЅРґ
                        this.slowPercent = 10;
                        this.color = 'lightblue';
                        this.shape = 'circle';
                        this.upgradeCost = 1250;
                        this.upgradeDamage = 1;
                        this.upgradeRadius = 25 * ST_TO_PX;
                        this.upgradeFireRate = 300;
                        this.upgradeSlowPercent = 35;
                        break;
                    case 'knight':
                        this.innerRadius = 5 * ST_TO_PX; // 5st = 50px
                        this.outerRadius = 28 * ST_TO_PX; // 28st = 280px
                        this.innerDamage = 5;
                        this.outerDamage = 5;
                        this.innerFireRate = 36; // 0.6СЃРµРє = 36 РєР°РґСЂРѕРІ
                        this.outerFireRate = 114; // 1.9СЃРµРє = 114 РєР°РґСЂРѕРІ
                        this.color = 'gray';
                        this.innerColor = 'red';
                        this.shape = 'pentagon';
                        this.upgradeCost = 2500;
                        this.upgradeInnerRadius = 8 * ST_TO_PX; // 8st = 80px
                        this.upgradeOuterRadius = 30 * ST_TO_PX; // 30st = 300px
                        this.upgradeInnerDamage = 5;
                        this.upgradeOuterDamage = 10;
                        this.upgradeInnerFireRate = 20; // 0.33СЃРµРє = 20 РєР°РґСЂРѕРІ
                        this.upgradeOuterFireRate = 90; // 1.5СЃРµРє = 90 РєР°РґСЂРѕРІ
                        break;
                    case 'farm':
                        this.radius = 0;
                        this.damage = 0;
                        this.income = 1;
                        this.incomeRate = 60; // 1 РјРѕРЅРµС‚Р° РІ СЃРµРєСѓРЅРґСѓ
                        this.color = 'brown';
                        this.shape = 'circle';
                        this.upgradeCost = 900;
                        this.upgradeIncome = 3;
                        break;
                    case 'chance':
                        this.radius = 17 * ST_TO_PX; // 17st = 170px
                        this.minDamage = 7;
                        this.maxDamage = 17;
                        this.fireRate = 42; // 0.7СЃРµРє = 42 РєР°РґСЂР°
                        this.color = 'pink';
                        this.shape = 'hexagon';
                        this.upgradeCost = 7777;
                        this.upgradeMinDamage = 17;
                        this.upgradeMaxDamage = 37;
                        this.upgradeFireRate = 46; // 0.77СЃРµРє = 46 РєР°РґСЂРѕРІ
                        break;
                    case 'atomic':
                        this.radius = 100 * ST_TO_PX; // 100st = 1000px
                        this.damage = 200;
                        this.fireRate = 3600; // 60СЃРµРє = 3600 РєР°РґСЂРѕРІ
                        this.color = 'darkgreen';
                        this.shape = 'octagon';
                        this.upgradeCost = 30000;
                        this.upgradeDamage = 250;
                        this.upgradeFireRate = 3000; // 50СЃРµРє = 3000 РєР°РґСЂРѕРІ
                        break;
                    case 'omega':
                        this.innerRadius = 9 * ST_TO_PX; // 9st = 90px
                        this.outerRadius = 30 * ST_TO_PX; // 30st = 300px
                        this.innerDamage = 10;
                        this.outerDamage = 25;
                        this.innerFireRate = 30; // 0.5СЃРµРє = 30 РєР°РґСЂРѕРІ
                        this.outerFireRate = 180; // 3СЃРµРє = 180 РєР°РґСЂРѕРІ
                        this.color = 'rainbow';
                        this.innerColor = 'cyan';
                        this.shape = 'square';
                        this.upgradeCost = 40000;
                        this.upgradeInnerRadius = 15 * ST_TO_PX; // 15st = 150px
                        this.upgradeOuterRadius = 30 * ST_TO_PX; // 30st = 300px
                        this.upgradeInnerDamage = 15;
                        this.upgradeOuterDamage = 20;
                        this.upgradeInnerFireRate = 24; // 0.4СЃРµРє = 24 РєР°РґСЂР°
                        this.upgradeOuterFireRate = 60; // 1СЃРµРє = 60 РєР°РґСЂРѕРІ
                        break;
                    case 'doublepistol':
                        this.radius = 10 * ST_TO_PX; // 10st = 100px
                        this.damage = 2;
                        this.fireRate = 60; // 1 РІС‹СЃС‚СЂРµР» РІ СЃРµРєСѓРЅРґСѓ (60 FPS)
                        this.color = 'blue';
                        this.secondColor = 'lightblue';
                        this.shape = 'circle';
                        this.upgradeCost = 150;
                        this.upgradeDamage = 4;
                        this.upgradeRadius = 12 * ST_TO_PX; // 12st = 120px
                        this.upgradeFireRate = 60;
                        break;
                    case 'bomb':
                        this.radius = 8 * ST_TO_PX; // 8st = 80px
                        this.damage = 5;
                        this.fireRate = 150; // 2.5СЃРµРє = 150 РєР°РґСЂРѕРІ
                        this.aoe = true;
                        this.color = 'black';
                        this.shape = 'triangle';
                        this.upgradeCost = 650;
                        this.upgradeDamage = 5;
                        this.upgradeRadius = 13 * ST_TO_PX; // 13st = 130px
                        this.upgradeFireRate = 90; // 1.5СЃРµРє = 90 РєР°РґСЂРѕРІ
                        break;
                    case 'goodfarm':
                        this.radius = 0;
                        this.damage = 0;
                        this.income = 5;
                        this.incomeRate = 60; // 5 РјРѕРЅРµС‚ РІ СЃРµРєСѓРЅРґСѓ
                        this.color = 'gold';
                        this.shape = 'square';
                        this.size = 20; // Р‘РѕР»СЊС€РѕР№ СЂР°Р·РјРµСЂ
                        break;
                    case 'toxic':
                        this.radius = 0;
                        this.damage = 1;
                        this.fireRate = 6; // 0.1СЃРµРє = 6 РєР°РґСЂРѕРІ
                        this.puddleRate = 180; // 3СЃРµРє = 180 РєР°РґСЂРѕРІ
                        this.puddleDamage = 1;
                        this.puddleRadius = 5 * ST_TO_PX; // 5st = 50px
                        this.puddleDuration = 300; // 5СЃРµРє = 300 РєР°РґСЂРѕРІ
                        this.color = 'green';
                        this.shape = 'decagon';
                        this.upgradeCost = 2500;
                        this.upgradeDamage = 2;
                        break;
                    case 'turret':
                        this.radius = 15 * ST_TO_PX; // 15st = 150px
                        this.damage = 2;
                        this.fireRate = 12; // 0.2СЃРµРє = 12 РєР°РґСЂРѕРІ
                        this.color = 'gray';
                        this.shape = 'square';
                        this.size = 20; // Р‘РѕР»СЊС€РѕР№ СЂР°Р·РјРµСЂ
                        this.upgradeCost = 5000;
                        this.upgradeDamage = 2;
                        this.upgradeRadius = 16 * ST_TO_PX; // 16st = 160px
                        this.upgradeFireRate = 6; // 0.1СЃРµРє = 6 РєР°РґСЂРѕРІ
                        break;
                    case 'empty':
                        this.radius = 10 * ST_TO_PX; // 10st = 100px
                        this.damage = 10;
                        this.fireRate = 60; // 1СЃРµРє = 60 РєР°РґСЂРѕРІ
                        this.slowPercent = 50;
                        this.color = 'purple';
                        this.auraColor = 'black';
                        this.shape = 'diamond';
                        this.specialChance = 0.041; // 4.1%
                        this.specialDamage = 25;
                        this.specialRate = 600; // 10СЃРµРє = 600 РєР°РґСЂРѕРІ
                        this.upgradeCost = 17500;
                        this.upgradeDamage = 20;
                        this.upgradeRadius = 20 * ST_TO_PX; // 20st = 200px
                        this.upgradeSlowPercent = 65;
                        break;
                }
                
                this.cooldown = 0;
                this.outerCooldown = 0;
                this.size = this.size || TOWER_SIZE;
            }
            
            upgrade() {
                if (this.upgraded) return false;
                
                switch(this.type) {
                    case 'pistol':
                        this.damage = this.upgradeDamage;
                        this.radius = this.upgradeRadius;
                        break;
                    case 'swordsman':
                        this.damage = this.upgradeDamage;
                        break;
                    case 'sniper':
                        this.damage = this.upgradeDamage;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'freezer':
                        this.slowPercent = this.upgradeSlowPercent;
                        break;
                    case 'knight':
                        this.innerRadius = this.upgradeInnerRadius;
                        this.outerRadius = this.upgradeOuterRadius;
                        this.innerDamage = this.upgradeInnerDamage;
                        this.outerDamage = this.upgradeOuterDamage;
                        this.innerFireRate = this.upgradeInnerFireRate;
                        this.outerFireRate = this.upgradeOuterFireRate;
                        break;
                    case 'farm':
                        this.income = this.upgradeIncome;
                        break;
                    case 'chance':
                        this.minDamage = this.upgradeMinDamage;
                        this.maxDamage = this.upgradeMaxDamage;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'atomic':
                        this.damage = this.upgradeDamage;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'omega':
                        this.innerRadius = this.upgradeInnerRadius;
                        this.outerRadius = this.upgradeOuterRadius;
                        this.innerDamage = this.upgradeInnerDamage;
                        this.outerDamage = this.upgradeOuterDamage;
                        this.innerFireRate = this.upgradeInnerFireRate;
                        this.outerFireRate = this.upgradeOuterFireRate;
                        break;
                    case 'doublepistol':
                        this.damage = this.upgradeDamage;
                        this.radius = this.upgradeRadius;
                        break;
                    case 'bomb':
                        this.radius = this.upgradeRadius;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'toxic':
                        this.damage = this.upgradeDamage;
                        break;
                    case 'turret':
                        this.radius = this.upgradeRadius;
                        this.fireRate = this.upgradeFireRate;
                        break;
                    case 'empty':
                        this.damage = this.upgradeDamage;
                        this.radius = this.upgradeRadius;
                        this.slowPercent = this.upgradeSlowPercent;
                        break;
                }
                
                this.upgraded = true;
                return true;
            }
            
            update() {
                // Р”Р»СЏ С„РµСЂРјС‹ - РіРµРЅРµСЂРёСЂСѓРµРј РґРѕС…РѕРґ
                if (this.type === 'farm' || this.type === 'goodfarm') {
                    this.incomeTimer++;
                    if (this.incomeTimer >= this.incomeRate) {
                        this.incomeTimer = 0;
                        money += this.income;
                        updateStats();
                    }
                    return;
                }
                
                // Р”Р»СЏ С‚РѕРєСЃРёС‡РЅРѕР№ Р±Р°С€РЅРё - СЃРѕР·РґР°РµРј Р»СѓР¶Рё
                if (this.type === 'toxic') {
                    this.puddleTimer++;
                    if (this.puddleTimer >= this.puddleRate) {
                        this.puddleTimer = 0;
                        puddles.push(new Puddle(this.x, this.y, this.puddleDamage, this.puddleRadius, this.puddleDuration));
                    }
                    return;
                }
                
                // Р”Р»СЏ РїСѓСЃС‚РѕР№ Р±Р°С€РЅРё - СЃРїРµС†РёР°Р»СЊРЅР°СЏ Р°С‚Р°РєР°
                if (this.type === 'empty') {
                    this.specialTimer++;
                    if (this.specialTimer >= this.specialRate) {
                        this.specialTimer = 0;
                        if (Math.random() < this.specialChance) {
                            // РќР°РЅРѕСЃРёРј СѓСЂРѕРЅ РІСЃРµРј РІСЂР°РіР°Рј РЅР° РїРѕР»Рµ
                            for (const enemy of enemies) {
                                enemy.takeDamage(this.specialDamage);
                            }
                        }
                    }
                }
                
                // Р”Р»СЏ Р°С‚РѕРјРЅРѕР№ Р±Р°С€РЅРё - РѕСЃРѕР±С‹Р№ С‚РёРї Р°С‚Р°РєРё
                if (this.type === 'atomic' && this.cooldown <= 0) {
                    // РђС‚РѕРјРЅР°СЏ Р±Р°С€РЅСЏ РЅР°РЅРѕСЃРёС‚ СѓСЂРѕРЅ РІСЃРµРј РІСЂР°РіР°Рј РЅР° РєР°СЂС‚Рµ
                    for (const enemy of enemies) {
                        enemy.takeDamage(this.damage);
                    }
                    this.cooldown = this.fireRate;
                    return;
                }
                
                // РќР°С…РѕРґРёРј РІСЂР°РіРѕРІ РІ СЂР°РґРёСѓСЃРµ
                let enemiesInRange = [];
                
                for (const enemy of enemies) {
                    const dx = enemy.x - this.x;
                    const dy = enemy.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (this.type === 'knight' || this.type === 'omega') {
                        if (distance < this.outerRadius) {
                            enemiesInRange.push(enemy);
                        }
                    } else if (this.type !== 'toxic') {
                        if (distance < this.radius) {
                            enemiesInRange.push(enemy);
                        }
                    }
                }
                
                if (enemiesInRange.length > 0) {
                    // Р’С‹Р±РёСЂР°РµРј С†РµР»СЊ РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ СЃС‚СЂР°С‚РµРіРёРё
                    let target;
                    if (this.targeting === 'first') {
                        // РџРµСЂРІР°СЏ С†РµР»СЊ (Р±Р»РёР¶Р°Р№С€Р°СЏ Рє РєРѕРЅС†Сѓ РїСѓС‚Рё)
                        target = enemiesInRange[0];
                        for (const enemy of enemiesInRange) {
                            if (enemy.pathIndex > target.pathIndex) {
                                target = enemy;
                            }
                        }
                    } else {
                        // РЎР»СѓС‡Р°Р№РЅР°СЏ С†РµР»СЊ
                        target = enemiesInRange[Math.floor(Math.random() * enemiesInRange.length)];
                    }
                    
                    // РЎС‚СЂРµР»СЊР±Р° РїРѕ РІСЂР°РіСѓ
                    if ((this.type === 'knight' || this.type === 'omega') && target) {
                        const dx = target.x - this.x;
                        const dy = target.y - this.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        // Р’РЅСѓС‚СЂРµРЅРЅСЏСЏ Р°С‚Р°РєР°
                        if (distance < this.innerRadius && this.cooldown <= 0) {
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.innerDamage,
                                speed: 8,
                                size: BULLET_SIZE,
                                color: this.innerColor,
                                instant: false
                            });
                            this.cooldown = this.innerFireRate;
                        }
                        
                        // Р’РЅРµС€РЅСЏСЏ Р°С‚Р°РєР°
                        if (distance >= this.innerRadius && this.outerCooldown <= 0) {
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.outerDamage,
                                speed: 5,
                                size: BULLET_SIZE,
                                color: this.color,
                                instant: false
                            });
                            this.outerCooldown = this.outerFireRate;
                        }
                    } else if (this.cooldown <= 0 && target) {
                        if (this.type === 'freezer') {
                            // РҐРѕР»РѕРґРёР»СЊРЅРёРє Р·Р°РјРµРґР»СЏРµС‚ РІСЂР°РіРѕРІ
                            for (const enemy of enemiesInRange) {
                                enemy.slowDown(this.slowPercent);
                            }
                            
                            // Р РЅР°РЅРѕСЃРёС‚ СѓСЂРѕРЅ С†РµР»Рё
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 5,
                                size: BULLET_SIZE,
                                color: 'lightblue',
                                instant: false
                            });
                        } else if (this.type === 'chance') {
                            // Р‘Р°С€РЅСЏ С€Р°РЅСЃР° - СЃР»СѓС‡Р°Р№РЅС‹Р№ СѓСЂРѕРЅ РІ РґРёР°РїР°Р·РѕРЅРµ
                            const randomDamage = this.minDamage + Math.random() * (this.maxDamage - this.minDamage);
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: randomDamage,
                                speed: 6,
                                size: BULLET_SIZE,
                                color: 'magenta',
                                instant: false
                            });
                        } else if (this.type === 'sniper') {
                            // РЎРЅР°Р№РїРµСЂ - РјРіРЅРѕРІРµРЅРЅС‹Рµ РїСѓР»Рё
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 1000, // РћС‡РµРЅСЊ РІС‹СЃРѕРєР°СЏ СЃРєРѕСЂРѕСЃС‚СЊ РґР»СЏ РјРіРЅРѕРІРµРЅРЅРѕРіРѕ РїРѕРїР°РґР°РЅРёСЏ
                                size: BULLET_SIZE,
                                color: 'yellow',
                                instant: true
                            });
                        } else if (this.type === 'bomb') {
                            // Р‘РѕРјР±Р° - AoE СѓСЂРѕРЅ
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 5,
                                size: BULLET_SIZE * 1.5,
                                color: 'black',
                                instant: false,
                                aoe: true,
                                aoeRadius: this.radius / 2
                            });
                        } else if (this.type === 'empty') {
                            // РџСѓСЃС‚Р°СЏ Р±Р°С€РЅСЏ - Р·Р°РјРµРґР»РµРЅРёРµ РІСЂР°РіРѕРІ РІ СЂР°РґРёСѓСЃРµ
                            for (const enemy of enemiesInRange) {
                                enemy.slowDown(this.slowPercent);
                            }
                            
                            // Р РЅР°РЅРѕСЃРёС‚ СѓСЂРѕРЅ С†РµР»Рё
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 5,
                                size: BULLET_SIZE,
                                color: 'purple',
                                instant: false
                            });
                        } else {
                            // РћР±С‹С‡РЅР°СЏ Р±Р°С€РЅСЏ
                            bullets.push({
                                x: this.x,
                                y: this.y,
                                target: target,
                                damage: this.damage,
                                speed: 5,
                                size: BULLET_SIZE,
                                color: this.type === 'pistol' ? 'cyan' : 
                                       this.type === 'swordsman' ? 'orange' : 
                                       this.type === 'doublepistol' ? 'lightblue' : 'yellow',
                                instant: false
                            });
                        }
                        this.cooldown = this.fireRate;
                    }
                }
                
                if (this.cooldown > 0) {
                    this.cooldown--;
                }
                
                if (this.outerCooldown > 0) {
                    this.outerCooldown--;
                }
            }
            
            draw() {
                // Р РёСЃСѓРµРј Р±Р°С€РЅСЋ
                if (this.type === 'omega') {
                    // РћРњР•Р“Рђ Р±Р°С€РЅСЏ СЃ РіСЂР°РґРёРµРЅС‚РѕРј
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0,
                        this.x, this.y, this.size
                    );
                    gradient.addColorStop(0, 'red');
                    gradient.addColorStop(0.2, 'orange');
                    gradient.addColorStop(0.4, 'yellow');
                    gradient.addColorStop(0.6, 'green');
                    gradient.addColorStop(0.8, 'blue');
                    gradient.addColorStop(1, 'violet');
                    
                    ctx.fillStyle = gradient;
                } else if (this.type === 'doublepistol') {
                    // Р”РІРѕР№РЅС‹Р№ РїРёСЃС‚РѕР»РµС‚ СЃ РіСЂР°РґРёРµРЅС‚РѕРј
                    const gradient = ctx.createLinearGradient(
                        this.x - this.size, this.y,
                        this.x + this.size, this.y
                    );
                    gradient.addColorStop(0, 'blue');
                    gradient.addColorStop(1, 'lightblue');
                    
                    ctx.fillStyle = gradient;
                } else {
                    ctx.fillStyle = this.color;
                }
                
                if (this.shape === 'circle') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.shape === 'diamond') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(45 * Math.PI / 180);
                    ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                    ctx.restore();
                } else if (this.shape === 'square') {
                    ctx.fillRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
                } else if (this.shape === 'pentagon') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    for (let i = 0; i < 5; i++) {
                        const angle = (i * 2 * Math.PI / 5) - Math.PI / 2;
                        const x = Math.cos(angle) * this.size;
                        const y = Math.sin(angle) * this.size;
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.fill();
                    
                    // Р’РЅСѓС‚СЂРµРЅРЅСЏСЏ С‡Р°СЃС‚СЊ
                    ctx.fillStyle = this.innerColor;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size/2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                } else if (this.shape === 'hexagon') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    for (let i = 0; i < 6; i++) {
                        const angle = (i * 2 * Math.PI / 6) - Math.PI / 2;
                        const x = Math.cos(angle) * this.size;
                        const y = Math.sin(angle) * this.size;
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                } else if (this.shape === 'octagon') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    for (let i = 0; i < 8; i++) {
                        const angle = (i * 2 * Math.PI / 8) - Math.PI / 2;
                        const x = Math.cos(angle) * this.size;
                        const y = Math.sin(angle) * this.size;
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                } else if (this.shape === 'triangle') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    ctx.moveTo(0, -this.size);
                    ctx.lineTo(-this.size, this.size);
                    ctx.lineTo(this.size, this.size);
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                } else if (this.shape === 'decagon') {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.beginPath();
                    for (let i = 0; i < 10; i++) {
                        const angle = (i * 2 * Math.PI / 10) - Math.PI / 2;
                        const x = Math.cos(angle) * this.size;
                        const y = Math.sin(angle) * this.size;
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                }
                
                // Р”Р»СЏ С„РµСЂРјС‹ РїРѕРєР°Р·С‹РІР°РµРј Р·РЅР°С‡РѕРє РјРѕРЅРµС‚С‹
                if (this.type === 'farm' || this.type === 'goodfarm') {
                    ctx.fillStyle = 'gold';
                    ctx.font = '12px Arial';
                    ctx.fillText('$', this.x - 4, this.y + 4);
                }
                
                // Р”Р»СЏ РїСѓСЃС‚РѕР№ Р±Р°С€РЅРё РїРѕРєР°Р·С‹РІР°РµРј Р°СѓСЂСѓ
                if (this.type === 'empty') {
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                // Р РёСЃСѓРµРј СЂР°РґРёСѓСЃ (С‚РѕР»СЊРєРѕ РїСЂРё РІС‹Р±РѕСЂРµ Рё РµСЃР»Рё РІРєР»СЋС‡РµРЅРѕ РѕС‚РѕР±СЂР°Р¶РµРЅРёРµ)
                if ((selectedTower === this || selectedTowerType === this.type) && showRadius) {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.setLineDash([5, 5]);
                    
                    if (this.type === 'knight' || this.type === 'omega') {
                        // Р РёСЃСѓРµРј РґРІР° СЂР°РґРёСѓСЃР° РґР»СЏ СЂС‹С†Р°СЂСЏ Рё РћРњР•Р“Р
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.innerRadius, 0, Math.PI * 2);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.outerRadius, 0, Math.PI * 2);
                        ctx.stroke();
                    } else if (this.type !== 'farm' && this.type !== 'goodfarm' && this.type !== 'toxic') {
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                    
                    ctx.setLineDash([]);
                    
                    // РџРѕРєР°Р·С‹РІР°РµРј СѓСЂРѕРІРµРЅСЊ СѓР»СѓС‡С€РµРЅРёСЏ
                    if (this.upgraded) {
                        ctx.fillStyle = 'gold';
                        ctx.font = '10px Arial';
                        ctx.fillText('РЈР».', this.x - 7, this.y + 4);
                    }
                }
            }
            
            getSellPrice() {
                const price = parseInt(document.querySelector(`.tower-item[data-type="${this.type}"]`).getAttribute('data-price'));
                let sellPrice = Math.floor(price * 0.5);
                
                if (this.upgraded) {
                    switch(this.type) {
                        case 'pistol': sellPrice += Math.floor(150 * 0.5); break;
                        case 'swordsman': sellPrice += Math.floor(300 * 0.5); break;
                        case 'sniper': sellPrice += Math.floor(1000 * 0.5); break;
                        case 'freezer': sellPrice += Math.floor(1250 * 0.5); break;
                        case 'knight': sellPrice += Math.floor(2500 * 0.5); break;
                        case 'farm': sellPrice += Math.floor(900 * 0.5); break;
                        case 'chance': sellPrice += Math.floor(7777 * 0.5); break;
                        case 'atomic': sellPrice += Math.floor(30000 * 0.5); break;
                        case 'omega': sellPrice += Math.floor(40000 * 0.5); break;
                        case 'doublepistol': sellPrice += Math.floor(150 * 0.5); break;
                        case 'bomb': sellPrice += Math.floor(650 * 0.5); break;
                        case 'toxic': sellPrice += Math.floor(2500 * 0.5); break;
                        case 'turret': sellPrice += Math.floor(5000 * 0.5); break;
                        case 'empty': sellPrice += Math.floor(17500 * 0.5); break;
                    }
                }
                
                return sellPrice;
            }
        }
        
        // Р¤СѓРЅРєС†РёСЏ РѕР±РЅРѕРІР»РµРЅРёСЏ СЃС‚Р°С‚РёСЃС‚РёРєРё
        function updateStats() {
            document.getElementById('money').textContent = money;
            document.getElementById('lives').textContent = lives;
            document.getElementById('wave').textContent = wave;
            document.getElementById('diamonds').textContent = diamonds;
        }
        
        // Р¤СѓРЅРєС†РёСЏ РѕР±РЅРѕРІР»РµРЅРёСЏ РёРЅРґРµРєСЃР° РІСЂР°РіРѕРІ
        function updateEnemyIndex() {
            for (const type in enemyKnowledge) {
                if (enemyKnowledge[type].discovered) {
                    const enemyElement = document.getElementById(`${type}-enemy`);
                    if (enemyElement) {
                        const statsElement = enemyElement.querySelector('.enemy-stats');
                        
                        let specialHtml = '';
                        if (type === 'boss' || type === 'blue' || type === 'sonic' || type === 'void') {
                            specialHtml = `<div>РћСЃРѕР±РµРЅРЅРѕСЃС‚СЊ: ${enemyKnowledge[type].special}</div>`;
                        }
                        
                        statsElement.innerHTML = `
                            <div>Р—РґРѕСЂРѕРІСЊРµ: ${enemyKnowledge[type].health}</div>
                            <div>РЎРєРѕСЂРѕСЃС‚СЊ: ${enemyKnowledge[type].speed.toFixed(2)}</div>
                            ${specialHtml}
                        `;
                    }
                }
            }
        }
        
        // Р¤СѓРЅРєС†РёСЏ РЅР°С‡Р°Р»Р° РІРѕР»РЅС‹
        function startWave() {
            if (!gameActive || waveActive) return;
            
            wave++;
            waveActive = true;
            
            // РќР°С‡РёСЃР»СЏРµРј Р°Р»РјР°Р·С‹ Р·Р° РІРѕР»РЅСѓ РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ СЃР»РѕР¶РЅРѕСЃС‚Рё
            if (difficulty === "normal") {
                diamonds += 1;
                totalDiamonds += 1;
            } else if (difficulty === "hard") {
                diamonds += 2;
                totalDiamonds += 2;
            } else if (difficulty === "extreme") {
                diamonds += 3;
                totalDiamonds += 3;
            }
            
            // РќР°РіСЂР°РґР° Р·Р° РєР°Р¶РґС‹Рµ 5 РІРѕР»РЅ
            if (wave % 5 === 0) {
                let reward = 0;
                if (difficulty === "normal") {
                    reward = 5 * waveRewardMultiplier;
                } else if (difficulty === "hard") {
                    reward = 10 * waveRewardMultiplier;
                } else if (difficulty === "extreme") {
                    reward = 15 * waveRewardMultiplier;
                }
                
                diamonds += reward;
                totalDiamonds += reward;
                waveRewardMultiplier *= 2; // РЈРґРІР°РёРІР°РµРј РјРЅРѕР¶РёС‚РµР»СЊ РЅР°РіСЂР°РґС‹
                
                alert(`РџРѕР·РґСЂР°РІР»СЏРµРј! Р’С‹ РїСЂРѕС€Р»Рё ${wave} РІРѕР»РЅСѓ Рё РїРѕР»СѓС‡Р°РµС‚Рµ ${reward} Р°Р»РјР°Р·РѕРІ!`);
            }
            
            document.getElementById('diamondTotal').textContent = totalDiamonds;
            updateStats();
            saveGameData();
            
            // РћРїСЂРµРґРµР»СЏРµРј РєРѕР»РёС‡РµСЃС‚РІРѕ Рё С‚РёРї РІСЂР°РіРѕРІ РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ РІРѕР»РЅС‹
            redCount = 2 + wave * 2; // +2 РєСЂР°СЃРЅС‹С… СЃ РєР°Р¶РґРѕР№ РІРѕР»РЅРѕР№
            purpleCount = 0;
            goldenCount = 0;
            pinkCount = 0;
            greenCount = 0;
            whiteCount = 0;
            bossCount = 0;
            blueCount = 0;
            sonicCount = 0;
            voidCount = 0;
            
            // Р”РѕР±Р°РІР»СЏРµРј С„РёРѕР»РµС‚РѕРІС‹С… РІСЂР°РіРѕРІ РїРѕСЃР»Рµ 5 РІРѕР»РЅС‹
            if (wave >= 5) {
                purpleCount = Math.floor((wave - 5) / 2) + 1;
            }
            
            // Р”РѕР±Р°РІР»СЏРµРј Р·РѕР»РѕС‚С‹С… РІСЂР°РіРѕРІ РїРѕСЃР»Рµ 25 РІРѕР»РЅС‹
            if (wave >= 25) {
                goldenCount = Math.floor((wave - 25) / 2) + 1;
            }
            
            // Р”РѕР±Р°РІР»СЏРµРј СЂРѕР·РѕРІС‹С… РІСЂР°РіРѕРІ РїРѕСЃР»Рµ 35 РІРѕР»РЅС‹
            if (wave >= 35) {
                pinkCount = Math.floor((wave - 35) / 3) + 1;
            }
            
            // Р”РѕР±Р°РІР»СЏРµРј Р·РµР»РµРЅС‹С… РІСЂР°РіРѕРІ РїРѕСЃР»Рµ 40 РІРѕР»РЅС‹
            if (wave >= 40) {
                greenCount = Math.floor((wave - 40) / 3) + 1;
            }
            
            // Р”РѕР±Р°РІР»СЏРµРј Р±РµР»С‹С… РІСЂР°РіРѕРІ РїРѕСЃР»Рµ 70 РІРѕР»РЅС‹
            if (wave >= 70) {
                whiteCount = Math.floor((wave - 70) / 5) + 1;
            }
            
            // Р”РѕР±Р°РІР»СЏРµРј Р±РѕСЃСЃР° РєР°Р¶РґС‹Рµ 50 РІРѕР»РЅ
            if (wave % 50 === 0) {
                bossCount = 1;
            }
            
            // Р”РѕР±Р°РІР»СЏРµРј РіРѕР»СѓР±С‹С… РІСЂР°РіРѕРІ РїРѕСЃР»Рµ 55 РІРѕР»РЅС‹
            if (wave >= 55) {
                blueCount = Math.floor((wave - 55) / 25) + 1;
            }
            
            // Р”РѕР±Р°РІР»СЏРµРј СЃРѕРЅРёРє РІСЂР°РіРѕРІ РїРѕСЃР»Рµ 90 РІРѕР»РЅС‹
            if (wave >= 90) {
                sonicCount = Math.floor((wave - 90) / 3) + 1;
            }
            
            // Р”РѕР±Р°РІР»СЏРµРј РїСѓСЃС‚РѕС‚РЅС‹С… РІСЂР°РіРѕРІ РїРѕСЃР»Рµ 125 РІРѕР»РЅС‹
            if (wave >= 125) {
                voidCount = Math.floor((wave - 125) / 25) + 1;
            }
            
            enemiesToSpawn = redCount + purpleCount + goldenCount + pinkCount + greenCount + whiteCount + 
                            bossCount + blueCount + sonicCount + voidCount;
            enemySpawnTimer = 30; // Р—Р°РґРµСЂР¶РєР° РїРµСЂРµРґ РїРµСЂРІС‹Рј РІСЂР°РіРѕРј
        }
        
        // Р¤СѓРЅРєС†РёСЏ СЃРїР°РІРЅР° РІСЂР°РіРѕРІ
        function spawnEnemy() {
            if (enemiesToSpawn > 0 && enemySpawnTimer <= 0) {
                let enemy;
                
                if (voidCount > 0) {
                    enemy = new Enemy('void', 1000, ENEMY_BASE_SPEED / 3, ENEMY_SIZE * 1.5, 'purple');
                    voidCount--;
                } else if (sonicCount > 0) {
                    enemy = new Enemy('sonic', 10, ENEMY_BASE_SPEED * 10, ENEMY_SIZE, 'cyan');
                    sonicCount--;
                } else if (blueCount > 0) {
                    enemy = new Enemy('blue', 200, ENEMY_BASE_SPEED / 5, ENEMY_SIZE * 1.2, 'blue');
                    blueCount--;
                } else if (bossCount > 0) {
                    enemy = new Enemy('boss', 250 + (Math.floor(wave / 50) * 250), ENEMY_BASE_SPEED, ENEMY_SIZE * 2, 'black');
                    bossCount--;
                    
                    // РЎРѕР·РґР°РµРј РёРЅРґРёРєР°С‚РѕСЂ Р°СѓСЂС‹ Р±РѕСЃСЃР°
                    bossAura = document.createElement('div');
                    bossAura.className = 'boss-aura';
                    bossAura.style.width = enemy.auraRadius * 2 + 'px';
                    bossAura.style.height = enemy.auraRadius * 2 + 'px';
                    document.body.appendChild(bossAura);
                } else if (whiteCount > 0) {
                    enemy = new Enemy('white', 120, ENEMY_BASE_SPEED, ENEMY_SIZE, 'white');
                    whiteCount--;
                } else if (greenCount > 0) {
                    enemy = new Enemy('green', 100, ENEMY_BASE_SPEED / 3.15675434, ENEMY_SIZE, 'green');
                    greenCount--;
                } else if (pinkCount > 0) {
                    enemy = new Enemy('pink', 11, ENEMY_BASE_SPEED * 5, ENEMY_SIZE, 'pink');
                    pinkCount--;
                } else if (goldenCount > 0) {
                    enemy = new Enemy('golden', 35, ENEMY_BASE_SPEED * 2, ENEMY_SIZE, 'gold');
                    goldenCount--;
                } else if (purpleCount > 0) {
                    enemy = new Enemy('purple', 15, ENEMY_BASE_SPEED * 0.5, ENEMY_SIZE, 'purple');
                    purpleCount--;
                } else {
                    enemy = new Enemy('red', 3 + Math.floor(wave / 3), ENEMY_BASE_SPEED, ENEMY_SIZE, 'red');
                    redCount--;
                }
                
                enemies.push(enemy);
                enemiesToSpawn--;
                enemySpawnTimer = 30; // Р—Р°РґРµСЂР¶РєР° РјРµР¶РґСѓ РІСЂР°РіР°РјРё
            }
            
            if (enemySpawnTimer > 0) {
                enemySpawnTimer--;
            }
            
            // Р•СЃР»Рё РІСЃРµ РІСЂР°РіРё СЃРѕР·РґР°РЅС‹ Рё РІСЃРµ СѓР±РёС‚С‹ - РЅР°С‡РёРЅР°РµРј СЃР»РµРґСѓСЋС‰СѓСЋ РІРѕР»РЅСѓ
            if (enemiesToSpawn === 0 && enemies.length === 0) {
                waveActive = false;
                // РђРІС‚РѕРјР°С‚РёС‡РµСЃРєРё РЅР°С‡РёРЅР°РµРј СЃР»РµРґСѓСЋС‰СѓСЋ РІРѕР»РЅСѓ
                setTimeout(startWave, 2000);
            }
        }
        
        // Р¤СѓРЅРєС†РёСЏ РѕР±РЅРѕРІР»РµРЅРёСЏ РїСѓР»СЊ
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                // Р•СЃР»Рё С†РµР»СЊ СѓР¶Рµ СѓРЅРёС‡С‚РѕР¶РµРЅР°, СѓРґР°Р»СЏРµРј РїСѓР»СЋ
                if (!enemies.includes(bullet.target)) {
                    bullets.splice(i, 1);
                    continue;
                }
                
                // Р”Р»СЏ РјРіРЅРѕРІРµРЅРЅС‹С… РїСѓР»СЊ (СЃРЅР°Р№РїРµСЂ) - СЃСЂР°Р·Сѓ РЅР°РЅРѕСЃРёРј СѓСЂРѕРЅ
                if (bullet.instant) {
                    if (bullet.target.takeDamage(bullet.damage)) {
                        enemies.splice(enemies.indexOf(bullet.target), 1);
                    }
                    bullets.splice(i, 1);
                    continue;
                }
                
                // Р”Р»СЏ AoE РїСѓР»СЊ (Р±РѕРјР±С‹) - РЅР°РЅРѕСЃРёРј СѓСЂРѕРЅ РІСЃРµРј РІСЂР°РіР°Рј РІ СЂР°РґРёСѓСЃРµ
                if (bullet.aoe && bullet.target) {
                    const dx = bullet.target.x - bullet.x;
                    const dy = bullet.target.y - bullet.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < bullet.speed) {
                        // РџРѕРїР°РґР°РЅРёРµ РїРѕ РІСЂР°РіСѓ - РЅР°РЅРѕСЃРёРј СѓСЂРѕРЅ РІСЃРµРј РІСЂР°РіР°Рј РІ СЂР°РґРёСѓСЃРµ
                        for (const enemy of enemies) {
                            const enemyDx = enemy.x - bullet.target.x;
                            const enemyDy = enemy.y - bullet.target.y;
                            const enemyDistance = Math.sqrt(enemyDx * enemyDx + enemyDy * enemyDy);
                            
                            if (enemyDistance < bullet.aoeRadius) {
                                if (enemy.takeDamage(bullet.damage)) {
                                    enemies.splice(enemies.indexOf(enemy), 1);
                                }
                            }
                        }
                        bullets.splice(i, 1);
                        continue;
                    }
                }
                
                // Р”РІРёР¶РµРЅРёРµ РїСѓР»Рё Рє С†РµР»Рё
                const dx = bullet.target.x - bullet.x;
                const dy = bullet.target.y - bullet.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < bullet.speed) {
                    // РџРѕРїР°РґР°РЅРёРµ РїРѕ РІСЂР°РіСѓ
                    if (bullet.target.takeDamage(bullet.damage)) {
                        enemies.splice(enemies.indexOf(bullet.target), 1);
                    }
                    bullets.splice(i, 1);
                } else {
                    bullet.x += (dx / distance) * bullet.speed;
                    bullet.y += (dy / distance) * bullet.speed;
                }
            }
        }
        
        // Р¤СѓРЅРєС†РёСЏ РѕР±РЅРѕРІР»РµРЅРёСЏ Р»СѓР¶
        function updatePuddles() {
            for (let i = puddles.length - 1; i >= 0; i--) {
                if (!puddles[i].update()) {
                    puddles.splice(i, 1);
                }
            }
        }
        
        // Р¤СѓРЅРєС†РёСЏ Р·Р°РІРµСЂС€РµРЅРёСЏ РёРіСЂС‹
        function gameOver() {
            gameActive = false;
            waveRewardMultiplier = 1; // РЎР±СЂР°СЃС‹РІР°РµРј РјРЅРѕР¶РёС‚РµР»СЊ РЅР°РіСЂР°РґС‹
            document.getElementById('restartGame').style.display = 'block';
            document.getElementById('gameOverlay').style.display = 'block';
        }
        
        // Р РёСЃСѓРµРј РїСѓС‚СЊ (Р¶РµР»С‚Р°СЏ С‚СЂРѕРїРёРЅРєР°)
        function drawPath() {
            ctx.strokeStyle = '#f1c40f'; // Р–РµР»С‚С‹Р№ С†РІРµС‚
            ctx.lineWidth = 30;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(PATH[0].x, PATH[0].y);
            
            for (let i = 1; i < PATH.length; i++) {
                ctx.lineTo(PATH[i].x, PATH[i].y);
            }
            
            ctx.stroke();
            
            // Р”РѕР±Р°РІР»СЏРµРј С‚РµРєСЃС‚СѓСЂСѓ С‚СЂРѕРїРёРЅРєРё
            ctx.strokeStyle = '#d35400';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 15]);
            ctx.beginPath();
            ctx.moveTo(PATH[0].x, PATH[0].y);
            
            for (let i = 1; i < PATH.length; i++) {
                ctx.lineTo(PATH[i].x, PATH[i].y);
            }
            
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        // РџРѕРєР°Р·Р°С‚СЊ РјРµРЅСЋ СѓР»СѓС‡С€РµРЅРёСЏ
        function showUpgradeMenu(tower, x, y) {
            const menu = document.getElementById('upgradeMenu');
            const upgradeInfo = document.getElementById('upgradeInfo');
            const upgradeBtn = document.getElementById('upgradeBtn');
            const sellBtn = document.getElementById('sellBtn');
            const targetingOptions = document.getElementById('targetingOptions');
            
            // РЈСЃС‚Р°РЅР°РІР»РёРІР°РµРј С‚РµРєСѓС‰СѓСЋ СЃС‚СЂР°С‚РµРіРёСЋ РІС‹Р±РѕСЂР° С†РµР»Рё
            document.querySelector(`input[name="targeting"][value="${tower.targeting}"]`).checked = true;
            
            // РћР±СЂР°Р±РѕС‚С‡РёРє РёР·РјРµРЅРµРЅРёСЏ СЃС‚СЂР°С‚РµРіРёРё
            targetingOptions.querySelectorAll('input[name="targeting"]').forEach(input => {
                input.onchange = () => {
                    tower.targeting = input.value;
                };
            });
            
            if (tower.upgraded) {
                upgradeInfo.innerHTML = '<p>Р‘Р°С€РЅСЏ СѓР¶Рµ СѓР»СѓС‡С€РµРЅР° РґРѕ РјР°РєСЃРёРјР°Р»СЊРЅРѕРіРѕ СѓСЂРѕРІРЅСЏ</p>';
                upgradeBtn.disabled = true;
            } else {
                let upgradeText = '';
                
                switch(tower.type) {
                    case 'pistol':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.fireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'swordsman':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.fireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'sniper':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.fireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'freezer':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>Р—Р°РјРµРґР»РµРЅРёРµ: ${tower.slowPercent}%</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>Р—Р°РјРµРґР»РµРЅРёРµ: ${tower.upgradeSlowPercent}%</li>
                            </ul>
                        `;
                        break;
                    case 'knight':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>Р’РЅСѓС‚СЂ. СѓСЂРѕРЅ: ${tower.innerDamage}</li>
                                <li>Р’РЅСѓС‚СЂ. СЂР°РґРёСѓСЃ: ${tower.innerRadius/ST_TO_PX}st</li>
                                <li>Р’РЅСѓС‚СЂ. СЃРєРѕСЂРѕСЃС‚СЊ: ${60/tower.innerFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                                <li>Р’РЅРµС€. СѓСЂРѕРЅ: ${tower.outerDamage}</li>
                                <li>Р’РЅРµС€. СЂР°РґРёСѓСЃ: ${tower.outerRadius/ST_TO_PX}st</li>
                                <li>Р’РЅРµС€. СЃРєРѕСЂРѕСЃС‚СЊ: ${60/tower.outerFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>Р’РЅСѓС‚СЂ. СѓСЂРѕРЅ: ${tower.upgradeInnerDamage}</li>
                                <li>Р’РЅСѓС‚СЂ. СЂР°РґРёСѓСЃ: ${tower.upgradeInnerRadius/ST_TO_PX}st</li>
                                <li>Р’РЅСѓС‚СЂ. СЃРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeInnerFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                                <li>Р’РЅРµС€. СѓСЂРѕРЅ: ${tower.upgradeOuterDamage}</li>
                                <li>Р’РЅРµС€. СЂР°РґРёСѓСЃ: ${tower.upgradeOuterRadius/ST_TO_PX}st</li>
                                <li>Р’РЅРµС€. СЃРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeOuterFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'farm':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>Р”РѕС…РѕРґ: ${tower.income} РјРѕРЅРµС‚Р°/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>Р”РѕС…РѕРґ: ${tower.upgradeIncome} РјРѕРЅРµС‚С‹/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'chance':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.minDamage}-${tower.maxDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.fireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeMinDamage}-${tower.upgradeMaxDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'atomic':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${tower.fireRate/60} СЃРµРє/РІС‹СЃС‚СЂРµР»</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${tower.upgradeFireRate/60} СЃРµРє/РІС‹СЃС‚СЂРµР»</li>
                            </ul>
                        `;
                        break;
                    case 'omega':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>Р’РЅСѓС‚СЂ. СѓСЂРѕРЅ: ${tower.innerDamage}</li>
                                <li>Р’РЅСѓС‚СЂ. СЂР°РґРёСѓСЃ: ${tower.innerRadius/ST_TO_PX}st</li>
                                <li>Р’РЅСѓС‚СЂ. СЃРєРѕСЂРѕСЃС‚СЊ: ${60/tower.innerFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                                <li>Р’РЅРµС€. СѓСЂРѕРЅ: ${tower.outerDamage}</li>
                                <li>Р’РЅРµС€. СЂР°РґРёСѓСЃ: ${tower.outerRadius/ST_TO_PX}st</li>
                                <li>Р’РЅРµС€. СЃРєРѕСЂРѕСЃС‚СЊ: ${60/tower.outerFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>Р’РЅСѓС‚СЂ. СѓСЂРѕРЅ: ${tower.upgradeInnerDamage}</li>
                                <li>Р’РЅСѓС‚СЂ. СЂР°РґРёСѓСЃ: ${tower.upgradeInnerRadius/ST_TO_PX}st</li>
                                <li>Р’РЅСѓС‚СЂ. СЃРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeInnerFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                                <li>Р’РЅРµС€. СѓСЂРѕРЅ: ${tower.upgradeOuterDamage}</li>
                                <li>Р’РЅРµС€. СЂР°РґРёСѓСЃ: ${tower.upgradeOuterRadius/ST_TO_PX}st</li>
                                <li>Р’РЅРµС€. СЃРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeOuterFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'doublepistol':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.fireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'bomb':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.fireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'toxic':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}/0.1СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}/0.1СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'turret':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.fireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>РЎРєРѕСЂРѕСЃС‚СЊ: ${60/tower.upgradeFireRate} РІС‹СЃС‚СЂ/СЃРµРє</li>
                            </ul>
                        `;
                        break;
                    case 'empty':
                        upgradeText = `
                            <p>РўРµРєСѓС‰РёРµ С…Р°СЂР°РєС‚РµСЂРёСЃС‚РёРєРё:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.damage}/СЃРµРє</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.radius/ST_TO_PX}st</li>
                                <li>Р—Р°РјРµРґР»РµРЅРёРµ: ${tower.slowPercent}%</li>
                            </ul>
                            <p>РџРѕСЃР»Рµ СѓР»СѓС‡С€РµРЅРёСЏ:</p>
                            <ul>
                                <li>РЈСЂРѕРЅ: ${tower.upgradeDamage}/СЃРµРє</li>
                                <li>Р Р°РґРёСѓСЃ: ${tower.upgradeRadius/ST_TO_PX}st</li>
                                <li>Р—Р°РјРµРґР»РµРЅРёРµ: ${tower.upgradeSlowPercent}%</li>
                            </ul>
                        `;
                        break;
                }
                
                upgradeInfo.innerHTML = upgradeText + `<p>РЎС‚РѕРёРјРѕСЃС‚СЊ: ${tower.upgradeCost} РјРѕРЅРµС‚</p>`;
                
                upgradeBtn.disabled = money < tower.upgradeCost;
                upgradeBtn.onclick = function() {
                    if (money >= tower.upgradeCost) {
                        money -= tower.upgradeCost;
                        tower.upgrade();
                        updateStats();
                        menu.style.display = 'none';
                    }
                };
            }
            
            // РќР°СЃС‚СЂРѕР№РєР° РєРЅРѕРїРєРё РїСЂРѕРґР°Р¶Рё
            const sellPrice = tower.getSellPrice();
            sellBtn.textContent = `РџСЂРѕРґР°С‚СЊ (${sellPrice} РјРѕРЅРµС‚)`;
            sellBtn.onclick = function() {
                money += sellPrice;
                
                // РћР±РЅРѕРІР»СЏРµРј СЃС‡РµС‚С‡РёРєРё Р»РёРјРёС‚РёСЂРѕРІР°РЅРЅС‹С… Р±Р°С€РµРЅ
                if (tower.type === 'farm') farmCount--;
                if (tower.type === 'atomic') atomicCount--;
                if (tower.type === 'omega') omegaCount--;
                if (tower.type === 'goodfarm') goodFarmCount--;
                if (tower.type === 'toxic') toxicCount--;
                if (tower.type === 'turret') turretCount--;
                if (tower.type === 'empty') emptyCount--;
                
                towers.splice(towers.indexOf(tower), 1);
                updateStats();
                menu.style.display = 'none';
                
                // РЈРґР°Р»СЏРµРј РёРЅРґРёРєР°С‚РѕСЂ СЂР°РґРёСѓСЃР°, РµСЃР»Рё РѕРЅ РѕС‚РѕР±СЂР°Р¶Р°РµС‚СЃСЏ
                if (rangeIndicator) {
                    document.body.removeChild(rangeIndicator);
                    rangeIndicator = null;
                }
            };
            
            // РџРѕРєР°Р·С‹РІР°РµРј РѕРїС†РёРё РІС‹Р±РѕСЂР° С†РµР»Рё С‚РѕР»СЊРєРѕ РґР»СЏ Р±РѕРµРІС‹С… Р±Р°С€РµРЅ
            if (tower.type === 'farm' || tower.type === 'goodfarm' || tower.type === 'toxic') {
                targetingOptions.style.display = 'none';
            } else {
                targetingOptions.style.display = 'block';
            }
            
            // РџРѕР·РёС†РёРѕРЅРёСЂСѓРµРј РјРµРЅСЋ СЂСЏРґРѕРј СЃ Р±Р°С€РЅРµР№
            const rect = menu.getBoundingClientRect();
            let left = x + 20;
            let top = y - 150;
            
            // РџСЂРѕРІРµСЂСЏРµРј, С‡С‚РѕР±С‹ РјРµРЅСЋ РЅРµ РІС‹С…РѕРґРёР»Рѕ Р·Р° РїСЂРµРґРµР»С‹ СЌРєСЂР°РЅР°
            if (left + rect.width > window.innerWidth) {
                left = x - rect.width - 20;
            }
            
            if (top + rect.height > window.innerHeight) {
                top = window.innerHeight - rect.height - 20;
            }
            
            if (top < 20) {
                top = 20;
            }
            
            menu.style.left = left + 'px';
            menu.style.top = top + 'px';
            menu.style.display = 'block';
        }
        
        // РЎРѕР·РґР°С‚СЊ РёРЅРґРёРєР°С‚РѕСЂ СЂР°РґРёСѓСЃР°
        function createRangeIndicator(radius) {
            if (rangeIndicator) {
                document.body.removeChild(rangeIndicator);
            }
            
            rangeIndicator = document.createElement('div');
            rangeIndicator.className = 'range-indicator';
            rangeIndicator.style.width = radius * 2 + 'px';
            rangeIndicator.style.height = radius * 2 + 'px';
            document.body.appendChild(rangeIndicator);
            
            return rangeIndicator;
        }
        
        // РћСЃРЅРѕРІРЅРѕР№ РёРіСЂРѕРІРѕР№ С†РёРєР»
        function gameLoop() {
            if (!gameActive) return;
            
            // РћС‡РёСЃС‚РєР° canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Р РёСЃСѓРµРј РїСѓС‚СЊ
            drawPath();
            
            // Р РёСЃСѓРµРј Р»СѓР¶Рё
            for (const puddle of puddles) {
                puddle.draw();
            }
            
            // РЎРїР°РІРЅ РІСЂР°РіРѕРІ
            spawnEnemy();
            
            // РћР±РЅРѕРІР»РµРЅРёРµ РІСЂР°РіРѕРІ
            for (let i = enemies.length - 1; i >= 0; i--) {
                if (!enemies[i].update()) {
                    enemies.splice(i, 1);
                }
            }
            
            // РћР±РЅРѕРІР»РµРЅРёРµ Р±Р°С€РµРЅ
            for (const tower of towers) {
                tower.update();
                tower.draw();
            }
            
            // РћР±РЅРѕРІР»РµРЅРёРµ РїСѓР»СЊ
            updateBullets();
            
            // РћР±РЅРѕРІР»РµРЅРёРµ Р»СѓР¶
            updatePuddles();
            
            // Р РёСЃСѓРµРј РїСѓР»Рё
            for (const bullet of bullets) {
                ctx.fillStyle = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Р РёСЃСѓРµРј РІСЂР°РіРѕРІ
            for (const enemy of enemies) {
                enemy.draw();
            }
            
            // РђРІС‚РѕР·Р°РїСѓСЃРє РїРµСЂРІРѕР№ РІРѕР»РЅС‹
            if (wave === 0 && !waveActive) {
                startWave();
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РєР»РёРєР° РїРѕ canvas
        canvas.addEventListener('click', (e) => {
            if (!gameActive) return;
            
            const mousePos = getMousePos(canvas, e);
            const x = mousePos.x;
            const y = mousePos.y;
            
            // РЎРєСЂС‹РІР°РµРј РјРµРЅСЋ СѓР»СѓС‡С€РµРЅРёР№ РїСЂРё РєР»РёРєРµ РІРЅРµ Р±Р°С€РЅРё
            let clickedOnTower = false;
            
            // РџСЂРѕРІРµСЂСЏРµРј, РєР»РёРєРЅСѓР»Рё Р»Рё РїРѕ СЃСѓС‰РµСЃС‚РІСѓСЋС‰РµР№ Р±Р°С€РЅРµ
            for (const tower of towers) {
                const dx = tower.x - x;
                const dy = tower.y - y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < tower.size) {
                    clickedOnTower = true;
                    selectedTower = tower;
                    selectedTowerType = null;
                    
                    // РџРѕРєР°Р·С‹РІР°РµРј РјРµРЅСЋ СѓР»СѓС‡С€РµРЅРёСЏ
                    showUpgradeMenu(tower, e.clientX, e.clientY);
                    
                    // РЎРЅРёРјР°РµРј РІС‹РґРµР»РµРЅРёРµ СЃ РєРЅРѕРїРѕРє РјР°РіР°Р·РёРЅР°
                    document.querySelectorAll('.tower-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // РЈРґР°Р»СЏРµРј РёРЅРґРёРєР°С‚РѕСЂ СЂР°РґРёСѓСЃР°
                    if (rangeIndicator) {
                        document.body.removeChild(rangeIndicator);
                        rangeIndicator = null;
                    }
                    
                    break;
                }
            }
            
            // Р•СЃР»Рё РєР»РёРєРЅСѓР»Рё РЅРµ РїРѕ Р±Р°С€РЅРµ, СЃРєСЂС‹РІР°РµРј РјРµРЅСЋ СѓР»СѓС‡С€РµРЅРёР№
            if (!clickedOnTower) {
                document.getElementById('upgradeMenu').style.display = 'none';
                
                // Р•СЃР»Рё РІС‹Р±СЂР°РЅР° Р±Р°С€РЅСЏ РґР»СЏ РїРѕРєСѓРїРєРё
                if (selectedTowerType) {
                    const price = parseInt(document.querySelector(`.tower-item[data-type="${selectedTowerType}"]`).getAttribute('data-price'));
                    
                    if (money >= price) {
                        // РџСЂРѕРІРµСЂСЏРµРј Р»РёРјРёС‚С‹ РґР»СЏ СЃРїРµС†РёР°Р»СЊРЅС‹С… Р±Р°С€РµРЅ
                        if (selectedTowerType === 'farm' && farmCount >= 5) {
                            alert('Р”РѕСЃС‚РёРіРЅСѓС‚ Р»РёРјРёС‚ С„РµСЂРј (5)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'atomic' && atomicCount >= 2) {
                            alert('Р”РѕСЃС‚РёРіРЅСѓС‚ Р»РёРјРёС‚ Р°С‚РѕРјРЅС‹С… Р±Р°С€РµРЅ (2)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'omega' && omegaCount >= 2) {
                            alert('Р”РѕСЃС‚РёРіРЅСѓС‚ Р»РёРјРёС‚ РћРњР•Р“Рђ Р±Р°С€РµРЅ (2)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'goodfarm' && goodFarmCount >= 2) {
                            alert('Р”РѕСЃС‚РёРіРЅСѓС‚ Р»РёРјРёС‚ С…РѕСЂРѕС€РёС… С„РµСЂРј (2)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'toxic' && toxicCount >= 3) {
                            alert('Р”РѕСЃС‚РёРіРЅСѓС‚ Р»РёРјРёС‚ С‚РѕРєСЃРёС‡РЅС‹С… Р±Р°С€РµРЅ (3)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'turret' && turretCount >= 8) {
                            alert('Р”РѕСЃС‚РёРіРЅСѓС‚ Р»РёРјРёС‚ С‚СѓСЂРµР»РµР№ (8)!');
                            return;
                        }
                        
                        if (selectedTowerType === 'empty') {
                            const limit = (difficulty === "extreme") ? 2 : 1;
                            if (emptyCount >= limit) {
                                alert(`Р”РѕСЃС‚РёРіРЅСѓС‚ Р»РёРјРёС‚ РїСѓСЃС‚С‹С… Р±Р°С€РµРЅ (${limit})!`);
                                return;
                            }
                        }
                        
                        // РџСЂРѕРІРµСЂСЏРµРј, РЅРµС‚ Р»Рё Р·РґРµСЃСЊ СѓР¶Рµ Р±Р°С€РЅРё
                        let canPlace = true;
                        for (const tower of towers) {
                            const dx = tower.x - x;
                            const dy = tower.y - y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < TOWER_SIZE * 2) {
                                canPlace = false;
                                break;
                            }
                        }
                        
                        // РџСЂРѕРІРµСЂСЏРµРј, РЅРµ РЅР° РїСѓС‚Рё Р»Рё Р±Р°С€РЅСЏ Рё РґРѕСЃС‚Р°С‚РѕС‡РЅРѕ Р»Рё РґР°Р»РµРєРѕ РѕС‚ РїСѓС‚Рё
                        const onPath = isOnPath(x, y);
                        
                        if (canPlace && !onPath) {
                            towers.push(new Tower(x, y, selectedTowerType));
                            money -= price;
                            updateStats();
                            
                            // РћР±РЅРѕРІР»СЏРµРј СЃС‡РµС‚С‡РёРєРё Р»РёРјРёС‚РёСЂРѕРІР°РЅРЅС‹С… Р±Р°С€РµРЅ
                            if (selectedTowerType === 'farm') farmCount++;
                            if (selectedTowerType === 'atomic') atomicCount++;
                            if (selectedTowerType === 'omega') omegaCount++;
                            if (selectedTowerType === 'goodfarm') goodFarmCount++;
                            if (selectedTowerType === 'toxic') toxicCount++;
                            if (selectedTowerType === 'turret') turretCount++;
                            if (selectedTowerType === 'empty') emptyCount++;
                            
                            // РЎРЅРёРјР°РµРј РІС‹РґРµР»РµРЅРёРµ СЃ РєРЅРѕРїРєРё
                            document.querySelectorAll('.tower-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                            
                            // РЈРґР°Р»СЏРµРј РёРЅРґРёРєР°С‚РѕСЂ СЂР°РґРёСѓСЃР°
                            if (rangeIndicator) {
                                document.body.removeChild(rangeIndicator);
                                rangeIndicator = null;
                            }
                            
                            selectedTowerType = null;
                        }
                    } else {
                        alert('РќРµРґРѕСЃС‚Р°С‚РѕС‡РЅРѕ РґРµРЅРµРі!');
                    }
                }
            }
        });
        
        // РџСЂРѕРІРµСЂРєР°, РЅР°С…РѕРґРёС‚СЃСЏ Р»Рё С‚РѕС‡РєР° РЅР° РїСѓС‚Рё
        function isOnPath(x, y) {
            for (let i = 0; i < PATH.length - 1; i++) {
                const p1 = PATH[i];
                const p2 = PATH[i + 1];
                
                // РџСЂРѕРІРµСЂСЏРµРј, РЅР°С…РѕРґРёС‚СЃСЏ Р»Рё С‚РѕС‡РєР° СЂСЏРґРѕРј СЃ РѕС‚СЂРµР·РєРѕРј РїСѓС‚Рё
                const dist = pointToLineDistance(x, y, p1.x, p1.y, p2.x, p2.y);
                if (dist < 25) { // РЁРёСЂРёРЅР° РїСѓС‚Рё + Р·Р°РїР°СЃ
                    return true;
                }
            }
            return false;
        }
        
        // Р’С‹С‡РёСЃР»РµРЅРёРµ СЂР°СЃСЃС‚РѕСЏРЅРёСЏ РѕС‚ С‚РѕС‡РєРё РґРѕ РѕС‚СЂРµР·РєР°
        function pointToLineDistance(px, py, x1, y1, x2, y2) {
            const A = px - x1;
            const B = py - y1;
            const C = x2 - x1;
            const D = y2 - y1;
            
            const dot = A * C + B * D;
            const len_sq = C * C + D * D;
            let param = -1;
            
            if (len_sq !== 0) {
                param = dot / len_sq;
            }
            
            let xx, yy;
            
            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }
            
            const dx = px - xx;
            const dy = py - yy;
            
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РІС‹Р±РѕСЂР° Р±Р°С€РЅРё РІ РјР°РіР°Р·РёРЅРµ
        document.querySelectorAll('.tower-item').forEach(item => {
            item.addEventListener('click', function() {
                selectedTowerType = this.getAttribute('data-type');
                selectedTower = null;
                
                // РЎРєСЂС‹РІР°РµРј РјРµРЅСЋ СѓР»СѓС‡С€РµРЅРёР№
                document.getElementById('upgradeMenu').style.display = 'none';
                
                // Р’С‹РґРµР»СЏРµРј РІС‹Р±СЂР°РЅРЅСѓСЋ Р±Р°С€РЅСЋ
                document.querySelectorAll('.tower-item').forEach(i => {
                    i.classList.remove('selected');
                });
                this.classList.add('selected');
                
                // РџРѕРєР°Р·С‹РІР°РµРј РёРЅРґРёРєР°С‚РѕСЂ СЂР°РґРёСѓСЃР° (РєСЂРѕРјРµ С„РµСЂРјС‹)
                if (selectedTowerType !== 'farm' && selectedTowerType !== 'goodfarm' && selectedTowerType !== 'toxic') {
                    let radius;
                    switch(selectedTowerType) {
                        case 'pistol': radius = 10 * ST_TO_PX; break;
                        case 'swordsman': radius = 4 * ST_TO_PX; break;
                        case 'sniper': radius = 100 * ST_TO_PX; break;
                        case 'freezer': radius = 25 * ST_TO_PX; break;
                        case 'knight': radius = 28 * ST_TO_PX; break;
                        case 'chance': radius = 17 * ST_TO_PX; break;
                        case 'atomic': radius = 100 * ST_TO_PX; break;
                        case 'omega': radius = 30 * ST_TO_PX; break;
                        case 'doublepistol': radius = 10 * ST_TO_PX; break;
                        case 'bomb': radius = 8 * ST_TO_PX; break;
                        case 'turret': radius = 15 * ST_TO_PX; break;
                        case 'empty': radius = 10 * ST_TO_PX; break;
                    }
                    
                    createRangeIndicator(radius);
                    
                    // РћР±РЅРѕРІР»СЏРµРј РїРѕР·РёС†РёСЋ РёРЅРґРёРєР°С‚РѕСЂР° РїСЂРё РґРІРёР¶РµРЅРёРё РјС‹С€Рё
                    const moveHandler = (e) => {
                        rangeIndicator.style.left = e.clientX + 'px';
                        rangeIndicator.style.top = e.clientY + 'px';
                    };
                    
                    document.addEventListener('mousemove', moveHandler);
                    
                    // РЈРґР°Р»СЏРµРј РѕР±СЂР°Р±РѕС‚С‡РёРє РїСЂРё РІС‹Р±РѕСЂРµ РґСЂСѓРіРѕР№ Р±Р°С€РЅРё РёР»Рё РѕС‚РјРµРЅРµ РІС‹Р±РѕСЂР°
                    const clearHandler = () => {
                        document.removeEventListener('mousemove', moveHandler);
                        document.removeEventListener('click', clearHandler);
                    };
                    
                    document.addEventListener('click', clearHandler, { once: true });
                }
            });
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РєРЅРѕРїРєРё РїРµСЂРµРєР»СЋС‡РµРЅРёСЏ РѕС‚РѕР±СЂР°Р¶РµРЅРёСЏ СЂР°РґРёСѓСЃР°
        document.getElementById('toggleRadius').addEventListener('click', function() {
            showRadius = !showRadius;
            this.textContent = showRadius ? 'РЎРєСЂС‹С‚СЊ СЂР°РґРёСѓСЃ' : 'РџРѕРєР°Р·Р°С‚СЊ СЂР°РґРёСѓСЃ';
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РєРЅРѕРїРєРё РїРµСЂРµРєР»СЋС‡РµРЅРёСЏ РёРЅРґРµРєСЃР° РІСЂР°РіРѕРІ
        document.getElementById('toggleIndex').addEventListener('click', function() {
            const index = document.getElementById('enemyIndex');
            if (index.style.display === 'block') {
                index.style.display = 'none';
                this.textContent = 'РџРѕРєР°Р·Р°С‚СЊ РёРЅРґРµРєСЃ';
            } else {
                index.style.display = 'block';
                this.textContent = 'РЎРєСЂС‹С‚СЊ РёРЅРґРµРєСЃ';
            }
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РєРЅРѕРїРєРё РїРµСЂРµР·Р°РїСѓСЃРєР°
        document.getElementById('restartGame').addEventListener('click', function() {
            // РџРѕРєР°Р·С‹РІР°РµРј СЌРєСЂР°РЅ РЅР°СЃС‚СЂРѕР№РєРё
            document.getElementById('setupScreen').style.display = 'flex';
            this.style.display = 'none';
            document.getElementById('gameOverlay').style.display = 'none';
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РІС‹Р±РѕСЂР° СЃР»РѕР¶РЅРѕСЃС‚Рё
        document.querySelectorAll('.difficulty-options .option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-options .option-btn').forEach(b => {
                    b.classList.remove('selected');
                });
                this.classList.add('selected');
                difficulty = this.getAttribute('data-difficulty');
                
                // РЈСЃС‚Р°РЅР°РІР»РёРІР°РµРј Р¶РёР·РЅРё РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ СЃР»РѕР¶РЅРѕСЃС‚Рё
                if (difficulty === "extreme") {
                    lives = 1;
                } else {
                    lives = 20;
                }
                updateStats();
            });
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РІС‹Р±РѕСЂР° РєР°СЂС‚С‹
        document.querySelectorAll('.map-options .option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.map-options .option-btn').forEach(b => {
                    b.classList.remove('selected');
                });
                this.classList.add('selected');
                mapType = this.getAttribute('data-map');
            });
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РєРЅРѕРїРєРё РЅР°С‡Р°Р»Р° РёРіСЂС‹
        document.getElementById('startGame').addEventListener('click', function() {
            // РЎРєСЂС‹РІР°РµРј СЌРєСЂР°РЅ РЅР°СЃС‚СЂРѕР№РєРё
            document.getElementById('setupScreen').style.display = 'none';
            
            // РЎР±СЂР°СЃС‹РІР°РµРј РёРіСЂСѓ
            money = 200;
            lives = (difficulty === "extreme") ? 1 : 20;
            wave = 0;
            diamonds = 0;
            enemies = [];
            towers = [];
            bullets = [];
            puddles = [];
            selectedTowerType = null;
            selectedTower = null;
            gameActive = true;
            waveActive = false;
            enemiesToSpawn = 0;
            farmCount = 0;
            atomicCount = 0;
            omegaCount = 0;
            goodFarmCount = 0;
            toxicCount = 0;
            turretCount = 0;
            emptyCount = 0;
            waveRewardMultiplier = 1; // РЎР±СЂР°СЃС‹РІР°РµРј РјРЅРѕР¶РёС‚РµР»СЊ РЅР°РіСЂР°РґС‹
            
            // РЈСЃС‚Р°РЅР°РІР»РёРІР°РµРј РїСѓС‚СЊ РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ РІС‹Р±СЂР°РЅРЅРѕР№ РєР°СЂС‚С‹
            setPath();
            
            // РЎР±СЂРѕСЃ Р·РЅР°РЅРёР№ Рѕ РІСЂР°РіР°С…
            for (const type in enemyKnowledge) {
                enemyKnowledge[type].discovered = false;
            }
            updateEnemyIndex();
            
            // РЈРґР°Р»СЏРµРј РёРЅРґРёРєР°С‚РѕСЂ СЂР°РґРёСѓСЃР°
            if (rangeIndicator) {
                document.body.removeChild(rangeIndicator);
                rangeIndicator = null;
            }
            
            // РЈРґР°Р»СЏРµРј Р°СѓСЂСѓ Р±РѕСЃСЃР°, РµСЃР»Рё РµСЃС‚СЊ
            if (bossAura) {
                document.body.removeChild(bossAura);
                bossAura = null;
            }
            
            // РЎРЅРёРјР°РµРј РІС‹РґРµР»РµРЅРёРµ СЃ РєРЅРѕРїРѕРє
            document.querySelectorAll('.tower-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            updateStats();
            gameLoop();
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РєРЅРѕРїРєРё РѕС‚РєСЂС‹С‚РёСЏ РјР°РіР°Р·РёРЅР°
        document.getElementById('diamondShopBtn').addEventListener('click', function() {
            document.getElementById('shopScreen').style.display = 'flex';
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РєРЅРѕРїРєРё Р·Р°РєСЂС‹С‚РёСЏ РјР°РіР°Р·РёРЅР°
        document.getElementById('closeShop').addEventListener('click', function() {
            document.getElementById('shopScreen').style.display = 'none';
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РІС‹Р±РѕСЂР° РєР°С‚РµРіРѕСЂРёР№ РІ РјР°РіР°Р·РёРЅРµ
        document.querySelectorAll('.shop-category').forEach(category => {
            category.addEventListener('click', function() {
                document.querySelectorAll('.shop-category').forEach(c => {
                    c.classList.remove('active');
                });
                this.classList.add('active');
                
                const categoryName = this.getAttribute('data-category');
                document.querySelectorAll('.shop-item').forEach(item => {
                    if (item.getAttribute('data-category') === categoryName) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РїРѕРєСѓРїРєРё СЃР»РѕР¶РЅРѕСЃС‚Рё
        document.getElementById('buyExtremeBtn').addEventListener('click', function() {
            const price = parseInt(this.getAttribute('data-price'));
            
            if (totalDiamonds >= price) {
                totalDiamonds -= price;
                document.getElementById('diamondTotal').textContent = totalDiamonds;
                this.disabled = true;
                this.textContent = 'РљСѓРїР»РµРЅРѕ';
                
                // Р Р°Р·Р±Р»РѕРєРёСЂСѓРµРј СЃР»РѕР¶РЅРѕСЃС‚СЊ
                document.getElementById('extremeDifficultyBtn').classList.remove('option-btn');
                document.getElementById('extremeDifficultyBtn').classList.add('option-btn');
                
                saveGameData();
                alert('Р РµР¶РёРј Р­РєСЃС‚СЂРёРј СЂР°Р·Р±Р»РѕРєРёСЂРѕРІР°РЅ!');
            } else {
                alert('РќРµРґРѕСЃС‚Р°С‚РѕС‡РЅРѕ Р°Р»РјР°Р·РѕРІ!');
            }
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РїРѕРєСѓРїРєРё РєР°СЂС‚С‹
        document.getElementById('buyMountainsBtn').addEventListener('click', function() {
            const price = parseInt(this.getAttribute('data-price'));
            
            if (totalDiamonds >= price) {
                totalDiamonds -= price;
                document.getElementById('diamondTotal').textContent = totalDiamonds;
                this.disabled = true;
                this.textContent = 'РљСѓРїР»РµРЅРѕ';
                
                // Р Р°Р·Р±Р»РѕРєРёСЂСѓРµРј РєР°СЂС‚Сѓ
                document.getElementById('mountainsMapBtn').classList.remove('option-btn');
                document.getElementById('mountainsMapBtn').classList.add('option-btn');
                
                saveGameData();
                alert('РљР°СЂС‚Р° Р“РѕСЂРєРё СЂР°Р·Р±Р»РѕРєРёСЂРѕРІР°РЅР°!');
            } else {
                alert('РќРµРґРѕСЃС‚Р°С‚РѕС‡РЅРѕ Р°Р»РјР°Р·РѕРІ!');
            }
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РєРЅРѕРїРєРё РёРЅС„РѕСЂРјР°С†РёРё Рѕ РєРµР№СЃРµ
        document.querySelectorAll('.case-info-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const content = this.nextElementSibling;
                if (content.style.display === 'block') {
                    content.style.display = 'none';
                } else {
                    content.style.display = 'block';
                }
            });
        });
        
        // Р¤СѓРЅРєС†РёСЏ РѕС‚РєСЂС‹С‚РёСЏ РєРµР№СЃР°
        function openCase(caseType, price) {
            if (totalDiamonds >= price) {
                totalDiamonds -= price;
                document.getElementById('diamondTotal').textContent = totalDiamonds;
                
                let random = Math.random() * 100;
                let towerType = '';
                
                if (caseType === 'normal') {
                    // РћР±С‹С‡РЅС‹Р№ РєРµР№СЃ
                    if (random < 45) {
                        towerType = 'doublepistol';
                    } else if (random < 75) {
                        towerType = 'bomb';
                    } else if (random < 95) {
                        towerType = 'goodfarm';
                    } else if (random < 99) {
                        towerType = 'toxic';
                    } else if (random < 99.6) {
                        towerType = 'turret';
                    } else {
                        towerType = 'empty';
                    }
                } else {
                    // РџСЂРµРјРёСѓРј РєРµР№СЃ
                    if (random < 40) {
                        towerType = 'bomb';
                    } else if (random < 65) {
                        towerType = 'goodfarm';
                    } else if (random < 85) {
                        towerType = 'toxic';
                    } else if (random < 97.5) {
                        towerType = 'turret';
                    } else {
                        towerType = 'empty';
                    }
                }
                
                // РџСЂРѕРІРµСЂСЏРµРј, РµСЃС‚СЊ Р»Рё СѓР¶Рµ С‚Р°РєР°СЏ Р±Р°С€РЅСЏ
                if (ownedTowers.includes(towerType)) {
                    // Р•СЃР»Рё Р±Р°С€РЅСЏ СѓР¶Рµ РµСЃС‚СЊ, РґР°РµРј 35 Р°Р»РјР°Р·РѕРІ
                    totalDiamonds += 35;
                    document.getElementById('diamondTotal').textContent = totalDiamonds;
                    saveGameData();
                    alert(`РЈ РІР°СЃ СѓР¶Рµ РµСЃС‚СЊ ${getTowerName(towerType)}! Р’С‹ РїРѕР»СѓС‡Р°РµС‚Рµ 35 Р°Р»РјР°Р·РѕРІ РІ РєР°С‡РµСЃС‚РІРµ РєРѕРјРїРµРЅСЃР°С†РёРё.`);
                } else {
                    // Р”РѕР±Р°РІР»СЏРµРј Р±Р°С€РЅСЋ РІ СЃРїРёСЃРѕРє РїРѕР»СѓС‡РµРЅРЅС‹С…
                    ownedTowers.push(towerType);
                    
                    // РџРѕРєР°Р·С‹РІР°РµРј Р±Р°С€РЅСЋ РІ РјР°РіР°Р·РёРЅРµ
                    document.getElementById(`${towerType}Tower`).style.display = 'flex';
                    
                    saveGameData();
                    alert(`РџРѕР·РґСЂР°РІР»СЏРµРј! Р’С‹ РїРѕР»СѓС‡РёР»Рё: ${getTowerName(towerType)}`);
                }
            } else {
                alert('РќРµРґРѕСЃС‚Р°С‚РѕС‡РЅРѕ Р°Р»РјР°Р·РѕРІ!');
            }
        }
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РѕС‚РєСЂС‹С‚РёСЏ РѕР±С‹С‡РЅРѕРіРѕ РєРµР№СЃР°
        document.getElementById('openNormalCaseBtn').addEventListener('click', function() {
            const price = parseInt(this.getAttribute('data-price'));
            openCase('normal', price);
        });
        
        // РћР±СЂР°Р±РѕС‚С‡РёРє РѕС‚РєСЂС‹С‚РёСЏ РїСЂРµРјРёСѓРј РєРµР№СЃР°
        document.getElementById('openPremiumCaseBtn').addEventListener('click', function() {
            const price = parseInt(this.getAttribute('data-price'));
            openCase('premium', price);
        });
        
        // РРЅРёС†РёР°Р»РёР·Р°С†РёСЏ РїСЂРё Р·Р°РіСЂСѓР·РєРµ
        setPath(); // РЈСЃС‚Р°РЅР°РІР»РёРІР°РµРј РїСѓС‚СЊ РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ
        loadGameData(); // Р—Р°РіСЂСѓР¶Р°РµРј СЃРѕС…СЂР°РЅРµРЅРЅС‹Рµ РґР°РЅРЅС‹Рµ
        updateStats();
        updateEnemyIndex();
    </script>
</body>
</html>
